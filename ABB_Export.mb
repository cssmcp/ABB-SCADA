Include "MapBasic.def"
Declare Sub Main
Declare Sub GetDateTime
Declare Sub SetVariables
Declare Sub OpenTableForScada
Declare Sub EAccount
Declare Sub EAffectedSubId
Declare Sub ECapacitor
Declare Sub EDevice
Declare Sub EDistrict
Declare Sub EFeeder
Declare Sub ELine
Declare Sub ELoad
Declare Sub EMPoint
Declare Sub ENode
Declare Sub EPath
Declare Sub EPath2
Declare Sub ERegion
Declare Sub ESite
Declare Sub ESource
Declare Sub ESubstation
Declare Sub CreateABBTable
Declare Sub CreateCsvFiles
Declare Sub CreateCnode
Declare Sub CnodePath
Declare Sub LineNode
Declare Sub convertChar
Declare Sub ControlCsv
Declare Sub CloseSel
Declare Sub DeviceChr
Declare Sub GroundLine
Declare Sub ExternalUpdateDevice
Declare Sub TestKofra
Declare Sub UpdateSubId

dim ABBGithub as integer

Declare Sub StorePassword(ByVal newPassword as String)
Declare Function CheckPassword(ByVal checkPassword as String) as Logical
Declare Method CreateHash Class "Authentication.PasswordHash" Lib "LoginSecurity.dll" 
	(ByVal _password as String) as String
Declare Method ValidatePassword Class "Authentication.PasswordHash" Lib "LoginSecurity.dll" 
	(ByVal _password as String, ByVal correctHash as String) as Logical

Define PASS_STORE ApplicationDirectory$() & "pw_store.txt"

Declare Function RemoveSpecialChars(byval str as string) as String
Declare Function ReplaceCharAtPosition(ByVal sValue As String, ByVal iPosition As Integer, ByVal sReplaceWith As String) As String

Declare Function TableControl(byval tabloAdi as string) as logical
Declare Function ExportCsv(byval dosyaAdi as string, byval headerText as string) as logical
Declare Function SearchReplace(ByVal strInput as String, ByVal strReplace as String, ByVal strReplacement as String) as String

Declare Sub GenerateUID
Declare Function GetStringUID(ByVal iStrLength as Integer) as String
Declare Function GetReallyRandomNumber() as Float

Declare Function KolonMevcutMu(Byval tablename_ as string,Byval colname_ as string ) as logical

'general definitions
dim TargetPath,SourcePath,ZeroGisId,ZeroCnodeId,HalfZeroGisId,completeTime,TextHeader,HatGisId,xnewId,ynewId,cnodeNewId,NodeGisId,_nextp,_linePathId,cmd_string,newEngChr,_tablename,subName,NFTime as string
Dim bDummy as logical
dim icn,ip,i,j,objectcount,kalan,_lineabbId,nodenum,lineGroupId,_linetype,cnodeNfpos,rowid,_id,_pafpos,_rowid,xxx,SITE_W,SITE_H,sifirla,siteABB,maxNfpos,pos,maxABB,_nodeDup,_nodeRow,_nid as integer
dim p1,p2,hatobj,_cnodeObj,_cnodeObj2,gndObj,gndobjT as object
dim rndvar as float

'device definitions - ogkesici
dim deviceOK_alttip,deviceOK_montajyeri,deviceOK_ScadaDef,deviceOK_kublajNo,deviceOK_hucreNo as string
dim deviceOK_gerilim as float
dim deviceOK_tmNo,ic,deviceOK_abbIntId,deviceOK_subArea,deviceOK_status,deviceOK_normState,deviceOK_typeCode,deviceOK_subId,deviceOK_X,deviceOK_Y,_devcat  as integer
dim deviceOK_obj as object

'device definitions -TR
dim deviceTR_ScadaDef,anahtarlama,anahtarDurum as string
dim itr,deviceTR_tmNo, deviceTR_trNo,deviceTR_abbIntId,deviceTR_typeCode,deviceTR_subId,deviceTR_subArea,deviceTR_X,deviceTR_Y as integer
dim deviceTR_obj as object

'device definitions -og ayirici
dim deviceOA_alttip,deviceOA_montajyeri,deviceOA_ScadaDef,deviceOA_kublajNo,deviceOA_hucreNo,deviceOA_baraNo as string

dim deviceOA_tmNo,ioa,deviceOA_abbIntId,deviceOA_subArea,deviceOA_status,deviceOA_normState,deviceOA_typeCode,deviceOA_subId,deviceOA_X,deviceOA_Y,deviceOA_gerilim,deviceOA_akim as integer
dim deviceOA_obj as object

'device definitions - agayirici
dim deviceAA_tip,deviceAA_montajyeri,deviceAA_ScadaDef,deviceAA_kublajNo,deviceAA_hucreNo as string
dim deviceAA_gerilim as float
dim deviceAA_tmNo,deviceAA_trNo,iaa,deviceAA_abbIntId,deviceAA_subArea,deviceAA_status,deviceAA_normState,deviceAA_typeCode,deviceAA_deparNo,deviceAA_subId,deviceAA_load,deviceAA_X,deviceAA_Y,deviceAA_akim,deviceAA_loadX,deviceAA_loadY as integer
dim deviceAA_obj as object

'device definitions - sdkayirici
dim deviceSA_montajyeri,deviceSA_ScadaDef as string
dim deviceSA_gerilim as float
dim deviceSA_sdkNo,deviceSA_sdkDeparNo,isa,deviceSA_abbIntId,deviceSA_subArea,deviceSA_status,deviceSA_normState,deviceSA_typeCode,deviceSA_subId,deviceSA_X,deviceSA_Y,deviceSA_load,deviceSA_akim,deviceSA_LOADX,deviceSA_LOADY as integer
dim deviceSA_obj as object

'device definitions - d_direk_ayirici
dim deviceDA_montajyeri,deviceDA_ScadaDef as string
dim deviceDA_gerilim as float
dim deviceDA_tmNo,ida,deviceDA_abbIntId,deviceDA_subArea,deviceDA_typeCode,deviceDA_subId,deviceDA_X,deviceDA_Y as integer
dim deviceDA_obj as object

'device definitions - sigorta
dim deviceOS_montajyeri,deviceOS_ScadaDef as string
dim deviceOS_gerilim as float
dim deviceOS_sdkNo,deviceOS_tmNo, deviceOS_sdkDeparNo,ios,deviceOS_abbIntId,deviceOS_subArea,deviceOS_status,deviceOS_normState,deviceOS_typeCode,deviceOS_hucreNo,deviceOS_subId,deviceOS_X,deviceOS_Y as integer
dim deviceOS_obj as object

'device definitions - AGTECHIZAT(KONDANSATOR)
dim deviceAT_ScadaDef as string
dim deviceAT_gerilim as float
dim deviceAT_kondansatorNo,deviceAT_tmNo,iat,deviceAT_abbIntId,deviceAT_subArea,deviceAT_typeCode,deviceAT_subId,deviceAT_X,deviceAT_Y as integer
dim deviceAT_obj as object

'line definitions - Og bara
dim lineOB_ScadaDef,lineOB_baraNo as string
dim iob,lineOB_tmNo,lineOB_abbIntId,lineOB_typeCode,lineOB_subArea,lineOB_X,lineOB_Y,lineOb_len as integer
dim lineOB_obj as object
dim lineOB_gerilim as float

'line definitions - Og Kablo Baglantýsý
dim lineOKB_ScadaDef as string
dim iokb,lineOKB_tmNo, lineOKB_objectId, lineOKB_abbIntId,lineOKB_typeCode,lineOKB_subArea,lineOKB_len as integer
dim lineOKB_obj as object

'line definitions - Ag bara
dim lineAB_ScadaDef,lineAB_baraNo as string
dim iab,lineAB_tmNo, lineAB_trNo, lineAB_abbIntId,lineAB_typeCode,lineAB_subArea,lineAB_len as integer
dim lineAB_obj as object
dim lineAB_gerilim as float

'line definitions - Ag Kablo Baglantýsý
dim lineAKB_ScadaDef as string
dim iakb,lineAKB_tmNo, lineAKB_objectId, lineAKB_abbIntId,lineAKB_typeCode,lineAKB_subArea,lineAKB_len as integer
dim lineAKB_obj as object

'line definitions - SDK bara
dim lineSB_ScadaDef,lineSB_baraNo as string
dim isb, lineSB_sdkNo, lineSB_abbIntId,lineSB_typeCode,lineSB_subArea,lineSB_len as integer
dim lineSB_obj as object
dim lineSB_gerilim as float

'line definitions - SDK Kablo Baglantýsý
dim lineSKB_ScadaDef as string
dim iskb,lineSKB_sdkNo, lineSKB_objectId, lineSKB_abbIntId,lineSKB_typeCode,lineSKB_subArea,lineSKB_len as integer
dim lineSKB_obj as object

'line definitions - dagýtým hattý
dim lineDH_ScadaDef,lineDH_tip as string
dim idh,lineDH_tm1, lineDH_tm2,lineDH_gerilim, lineDH_abbIntId,lineDH_typeCode,lineDH_subArea,lineDH_len as integer
dim lineDH_obj as object


'line definitions - enerji nakil hattý
dim lineENH_ScadaDef as string
dim ieh,lineENH_tm1, lineENH_tm2,lineENH_gerilim, lineENH_abbIntId,lineENH_typeCode,lineENH_fiderNo,lineENH_nfPos,lineENH_subArea,lineENH_len as integer
dim lineENH_obj as object

'line definitions - abone hatti
dim lineABH_ScadaDef as string
dim iabh,lineABH_tm1, lineABH_tm2,lineABH_gerilim, lineABH_abbIntId,lineABH_typeCode,lineABH_fiderNo,lineABH_nfPos,lineABH_subArea,lineABH_len,lineABH_tmno as integer
dim lineABH_obj as object

'line - ogload definitions - og load
dim lineOL_ScadaDef,lineOL_montajYeri as string
dim iol, lineOL_objectid, lineOL_abbIntId,lineOL_typeCode,lineOL_load,lineOL_tmNo,lineOL_gerilim,lineOL_hucreNo,lineOL_nfPos,lineOL_subArea,lineOL_subId,lineOL_X,lineOL_Y,lineOL_len,lineOL_akim,lineOL_rating1 as integer
dim lineOL_obj as object


'site definitions
dim site_ScadaDef,siteIl,siteIlce,siteMahalle,site_tmAdi,site_type as string
dim is,site_tmNo, site_trNo,site_abbIntId,site_typeCode,site_subAre,site_X,site_Y,newX,newY,nodeNewY,vLevel_site as integer
dim site_obj as object


'capacitor definitions
dim cap_ScadaDef as string
dim icap, cap_objectid, cap_abbIntId,cap_typeCode,cap_tmNo,cap_gerilim,cap_hucreNo,cap_KondansatorNo, cap_subArea,cap_X,cap_Y  as integer
dim cap_obj as object

dim kf_ScadaDef,kf_street,kf_serv,kf_city,kf_name as string
dim ikf,kf_accnokf_meterNo,kf_xfmrid,kf_abbIntId,kf_typeCode,kf_X,kf_Y as integer
dim kf_obj as object

'feeder definitions - dagýtým hattý
dim lineF_ScadaDef as string
dim ifd,lineF_tm1, lineF_tm2,lineF_gerilim, lineF_abbIntId,lineF_typeCode,lineF_subArea,lineF_len as integer
dim lineF_obj as object

dim _datetime as datetime
dim fNum as float

Sub Main()
	'bismillahirrahmanirrahim
		
'	Dim newPassword as String
'	Dim checkPW as String
'	
'	Dialog
'		Title "Validate Password"
'		Width 144 Height 59
'		Control StaticText
'			Id 0
'			Position 8, 8
'			Width 51 Height 8
'			Title "Check Password:"
'		Control EditText
'			Id 1
'			Position 8, 23
'			Width 128 Height 12
'			Into checkPW
'		Control OKButton
'			Title "OK"
'			Id 2
'			Position 85, 39
'			Width 51 Height 14
'	
'	If CommandInfo(CMD_INFO_DLG_OK) then
'		'// validate password
'		If CheckPassword(checkPW) then
'			Note "Password correct"
'		Else
'			Note "Incorrect password"
'			exit sub
'		End If
'	Else
'		Exit Sub
'	End If
	
	
	Set Format number   "Local"
	print chr$(12)
	call GetDateTime
	print "ABB Scada Export - Baþlatýldý " + completeTime	
	
	StatusBar Message "Uygulama Baþlatýlýyor..." 
	Set ProgressBars Off 
	StatusBar Message "Ortam Deðiþkenleri Belirleniyor..." 
	call SetVariables
	StatusBar Message "ABB Scada Tablolarý Oluþturuluyor..." 
	call OpenTableForScada
	call CreateABBTable
	call EDevice
	call GroundLine
	call CreateCnode	
	call ExternalUpdateDevice
	call ENode
	call ELine
	call EFeeder
	call EPath2
	call EAffectedSubId
	call ERegion
	call ESite
	call EDistrict
	call ESource
	call ELoad
	call EMpoint
	call ECapacitor
	call EAccount
	call Esubstation

	
	Run Application ApplicationDirectory$() +"\SCADACHR.MBX"
	call CreateCsvFiles
	
	'call CloseSel
	note "iþlem tamamlandý"
	
End Sub

Sub GetDateTime
	fNum = curdatetime()
	_datetime = NumbertoDateTime (fNum)
	completeTime = FormatDate$(_datetime) + "-" + FormatTime$(_datetime,"HH:mm:ss.fff tt")	
End Sub

Sub SetVariables
	TargetPath = ApplicationDirectory$() + "ABBScada\"
	SourcePath = ApplicationDirectory$() + "PM\"
	ZeroGisId = "00000000000000000000"
	ZeroCnodeId = "00000000000000000000"
	HalfZeroGisId = "0000000000"
End Sub

Sub OpenTableForScada
	Close all interactive 
	
	Open Table SourcePath + "abone.TAB" Interactive
	Open Table SourcePath + "kofra_result.TAB" Interactive
	Open Table SourcePath + "group_result.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_TRANSFORMATOR_INDIRICI.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_TRANSFORMATOR_DAGITIM.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_RTU.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_REAKTOR.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_OG_YARDIMCI_TECHIZAT.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_OG_TECHIZAT.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_OG_KESICI.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_OG_KAYNAK.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_OG_BAGLANTI_NOKTASI.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_AG_BAGLANTI_NOKTASI.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_OG_KABLO_BAGLANTISI.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_AG_KABLO_BAGLANTISI.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_OG_AYIRICI.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_ANALIZOR.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_AG_TECHIZAT.TAB" Interactive	
	Open Table SourcePath + "Elektrik_T_AG_AYIRICI.TAB" Interactive
	Open Table SourcePath + "Elektrik_K_SDK_BAGLANTI_NOKTASI.TAB" Interactive
	Open Table SourcePath + "Elektrik_K_SDK_AYIRICI.TAB" Interactive
	Open Table SourcePath + "Elektrik_K_SDK.TAB" Interactive	
	Open Table SourcePath + "Elektrik_K_SAYAC.TAB" Interactive
	Open Table SourcePath + "Elektrik_K_KOFRA.TAB" Interactive
	Open Table SourcePath + "Elektrik_D_DIREK_AYIRICI.TAB" Interactive	
	Open Table SourcePath + "Elektrik_T_AG_BARA.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_OG_BARA.TAB" Interactive
	'Open Table SourcePath + "Elektrik_T_KONDANSATOR_GRUBU.TAB" Interactive
	Open Table SourcePath + "Elektrik_K_SDK_KABLO_BAGLANTISI.TAB" Interactive
	Open Table SourcePath + "Elektrik_K_SDK_BARA.TAB" Interactive
	Open Table SourcePath + "Elektrik_H_ENERJI_NAKIL_HATTI.TAB" Interactive
	Open Table SourcePath + "Elektrik_H_DAGITIM_HATTI.TAB" Interactive
	Open Table SourcePath + "Elektrik_H_AYDINLATMA_HATTI.TAB" Interactive
	Open Table SourcePath + "Elektrik_H_ABONE_BAGLANTI_HATTI.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_AG_PANO.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_MERKEZ_BINA.TAB" Interactive
	Open Table SourcePath + "Elektrik_T_HUCRE.TAB" Interactive
	Open Table SourcePath + "Elektrik_LGC_SDK.TAB" Interactive
	Open Table SourcePath + "Elektrik_LGC_MERKEZ.TAB" Interactive
	Open Table SourcePath + "YALOVA_ILCE.TAB" Interactive
End Sub

Sub UpdateSubId

update TRF_DAGITIM set sub_id=abb_int_id
update OG_TECHIZAT set sub_id=abb_int_id
update OG_KESICI set sub_id=abb_int_id
update OG_KAYNAK set sub_id=abb_int_id
update OG_KABLO_NOKTASI set sub_id=abb_int_id
update AG_KABLO_NOKTASI set sub_id=abb_int_id
update OG_KABLO_BAGLANTISI set sub_id=abb_int_id
update AG_KABLO_BAGLANTISI set sub_id=abb_int_id
update OG_AYIRICI set sub_id=abb_int_id
update ANALIZOR set sub_id=abb_int_id
update AG_TECHIZAT set sub_id=abb_int_id
update AG_AYIRICI set sub_id=abb_int_id
update SDK_KABLO_NOKTASI set sub_id=abb_int_id
update SDK_AYIRICI set sub_id=abb_int_id
update SDK set sub_id=abb_int_id
update DIREK_AYIRICI set sub_id=abb_int_id
update AG_BARA set sub_id=abb_int_id
update OG_BARA set sub_id=abb_int_id
update SDK_KABLO_BAGLANTISI set sub_id=abb_int_id
update SDK_BARA set sub_id=abb_int_id
update ENERJI_NAKIL_HATTI set sub_id=abb_int_id
update DAGITIM_HATTI set sub_id=abb_int_id
update AYDINLATMA_HATTI set sub_id=abb_int_id
update ABONE_HATTI set sub_id=abb_int_id
update NODE set sub_id=abb_int_id
update LGC_MERKEZ set sub_id=abb_int_id
update LGC_SDK set sub_id=abb_int_id

commit table TRF_DAGITIM
commit table OG_TECHIZAT
commit table OG_KESICI
commit table OG_KAYNAK
commit table OG_KABLO_NOKTASI
commit table AG_KABLO_NOKTASI
commit table OG_KABLO_BAGLANTISI
commit table AG_KABLO_BAGLANTISI
commit table OG_AYIRICI
commit table ANALIZOR
commit table AG_TECHIZAT
commit table AG_AYIRICI
commit table SDK_KABLO_NOKTASI
commit table SDK
commit table DIREK_AYIRICI
commit table AG_BARA
commit table OG_BARA
commit table SDK_KABLO_BAGLANTISI
commit table SDK_BARA
commit table ENERJI_NAKIL_HATTI
commit table DAGITIM_HATTI
commit table AYDINLATMA_HATTI
commit table ABONE_HATTI
commit table NODE
commit table LGC_MERKEZ
commit table LGC_SDK

End sub

Sub EAccount

if KolonMevcutMu("abone","LOAD_ID2") =0 then
Alter Table "abone" ( add LOAD_ID2 Char(20) ) Interactive
end if
'Select abone.LOAD_ID2, KOFRA.LOAD_ID from abone, KOFRA where abone.KOFRANO__=KOFRA.KOFRANO into SelUpdateAbone
'update selUpdateAbone set col1=col2
'commit table abone

'SELECT LOAD_ID2,COUNT(*) FROM ABONE GROUP BY LOAD_ID INTO SELKOFRA
'Commit Table SELKOFRA As targetpath + "\KOFRARES.TAB" TYPE NATIVE Charset "WindowsTurkish" Interactive
'Open Table targetpath + "\KOFRARES.TAB" Interactive

'Add Column "LOAD" (CUSTNO_1 )From KOFRARES Set To _COL2 Where LOID = LOAD_ID2
'COMMIT TABLE LOAD
Add Column "abone" (LOAD_ID2 )From KOFRA_RESULT Set To "LOAD_" + AYIRICI_ID Where KOFRANO__ = KOFRANO
commit table abone

select * from abone where load_id2 in (select loid from load) into selLoadAbone

insert into  ACCOUNT(ACCNO,NAME,CITY,SERV,DISTR,PHASE,XFMR_ID,METER_NO,HOUSE_NO,STREET,HOUSE_NO2,XFMRMRSIZEIND,xcoor,ycoor) select aboneno,adsoyad,il_adi,il_adi + " " + ilce_adi + " " + mahalle_adi + " " + yol_adi + ",NO:" + kapino, aob_id,3, load_id2,sayacserino,kapino,yol_adi, "0","0.4 kV",STR$(kofra_x__),STR$(kofra_y) from selLoadAbone
commit table ACCOUNT

if KolonMevcutMu("LOAD","FEED") =0 then
Alter Table "LOAD" ( add FEED Integer ) Interactive
end if
commit table LOAD

End Sub

Sub EAffectedSubId
'affected sub id kýsmýna sub idlerin hepsi eklenmelidir.
'insert into  Affected_SubId(SUB_ID) values(201)
'insert into  Affected_SubId(SUB_ID) values(202)
'commit table Affected_SubId

	Insert Into Affected_SubId(sub_id)  select sub_id from TRF_DAGITIM
	Insert Into Affected_SubId(sub_id)  select sub_id from OG_TECHIZAT
	Insert Into Affected_SubId(sub_id)  select sub_id from OG_KESICI
	Insert Into Affected_SubId(sub_id)  select sub_id from OG_KAYNAK
	Insert Into Affected_SubId(sub_id)  select sub_id from OG_KABLO_NOKTASI
	Insert Into Affected_SubId(sub_id)  select sub_id from AG_KABLO_NOKTASI
	Insert Into Affected_SubId(sub_id)  select sub_id from OG_KABLO_BAGLANTISI
	Insert Into Affected_SubId(sub_id)  select sub_id from AG_KABLO_BAGLANTISI
	Insert Into Affected_SubId(sub_id)  select sub_id from OG_AYIRICI
	Insert Into Affected_SubId(sub_id)  select sub_id from ANALIZOR
	Insert Into Affected_SubId(sub_id)  select sub_id from AG_TECHIZAT	
	Insert Into Affected_SubId(sub_id)  select sub_id from AG_AYIRICI
	Insert Into Affected_SubId(sub_id)  select sub_id from SDK_KABLO_NOKTASI
	Insert Into Affected_SubId(sub_id)  select sub_id from SDK_AYIRICI
	Insert Into Affected_SubId(sub_id)  select sub_id from SDK
	Insert Into Affected_SubId(sub_id)  select sub_id from DIREK_AYIRICI	
	Insert Into Affected_SubId(sub_id)  select sub_id from AG_BARA
	Insert Into Affected_SubId(sub_id)  select sub_id from OG_BARA
	Insert Into Affected_SubId(sub_id)  select sub_id from SDK_KABLO_BAGLANTISI
	Insert Into Affected_SubId(sub_id)  select sub_id from SDK_BARA
	Insert Into Affected_SubId(sub_id)  select sub_id from ENERJI_NAKIL_HATTI
	Insert Into Affected_SubId(sub_id)  select sub_id from DAGITIM_HATTI
	Insert Into Affected_SubId(sub_id)  select sub_id from AYDINLATMA_HATTI
	'Insert Into Affected_SubId(sub_id)  select sub_id from ABONE_HATTI
	Insert Into Affected_SubId(sub_id)  select sub_id from NODE
	Insert Into Affected_SubId(sub_id)  select sub_id from LGC_MERKEZ
	Insert Into Affected_SubId(sub_id)  select sub_id from LGC_SDK
	
	'Insert Into Affected_SubId(sub_id) values(500)
	
	commit table Affected_SubId
	
End Sub

Sub ECapacitor
'kapasitor datasý gelmediðindne aktarýmý yapýlmayacaktýr.

'[TM_NO]_[ISLETME_GERILIMI]H[HUCRE_NO]_CAP-[KONDANSATOR_NO]


'select * from CAPACITOR where obj into selCap
'fetch first from selCap
'For icap = 0 To tableinfo(selCap,8)
'		
'	cap_tmNo 	 = selCap.tm_no
'	cap_abbIntId = selCap.abb_int_id
'	cap_obj      = selCap.obj	
'	cap_X        = centroidx(cap_obj)
'	cap_Y        = centroidy(cap_obj)
'	cap_typeCode = selCap.typecode
'	cap_gerilim  = val(selCap.isletme_gerilimi)
'	cap_hucreNo  = selCap.hucre_no
'	cap_kondansatorNo = selCap.kondansator_no
'	
'	cap_ScadaDef =cap_tmNo + "_" + cap_gerilim /1000 + "H"+  cap_hucreNo + "_CAP-"+	cap_kondansatorNo
'
'insert into CAPACITOR(OBJ,CAID,CANAME,CAFPOS,ABB_INT_ID,NO_KEY,DT_KEY,RATING_1,RATING_2,RATING_3,RATING_4,DESCRIPTIVE_LOC,PH3PRES,BITS,STATE,STATUS,ANNO_POS_1,ANNO_POS_2,SYM_POS_1,SYM_POS_2,REGULATING,REG_MODE,REG_NODE_KEY,REG_LINE_XFRM_KEY,REG_Q_COMP_TYPE,REG_V_SENS_PHASE,REG_Q_SENS_PHASE,REG_LINE_END,V_ON_LIMIT,V_OFF_LIMIT,Q_ON_LIMIT,Q_OFF_LIMIT) values(cap_obj,"CAP_"+cap_abbIntId,cap_ScadaDef,cap_abbIntId,cap_abbIntId,cap_abbIntId,0,1800,600,600,600,suha,111,0,1,111,3,6,0,0,1,1,abb_int_id,0,0,B,0,0,0.95,1.05,0,0)
'
'fetch next from selCap
'Next


select * from AG_TECHIZAT where tip="KONDANSATOR" into selDeviceAT
insert into CAPACITOR(OBJ,CAID,CANAME,CAFPOS,ABB_INT_ID,NO_KEY,DT_KEY,RATING_1,RATING_2,RATING_3,RATING_4,DESCRIPTIVE_LOC,PH3PRES,BITS,STATE,STATUS,ANNO_POS_1,ANNO_POS_2,SYM_POS_1,SYM_POS_2,REGULATING,REG_MODE,REG_NODE_KEY,REG_LINE_XFRM_KEY,REG_Q_COMP_TYPE,REG_V_SENS_PHASE,REG_Q_SENS_PHASE,REG_LINE_END,V_ON_LIMIT,V_OFF_LIMIT,Q_ON_LIMIT,Q_OFF_LIMIT) select obj,"CAP_"+abb_int_id,tm_no + "_" +  400/1000 + "kV_CAP-" + kondansator_No ,abb_int_id,abb_int_id,0,6156,5,1.67,1.67,1.67,"suha",111,0,1,111,3,6,0,0,1,1,0,0,0,"B",0,0,0.95,1.05,0,0 from selDeviceAT
commit table CAPACITOR

insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,CAFPOS,CAID,ABB_INT_ID,CANAME,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)) ,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)),12288,1,41,202,1,7,abb_int_id,3,6,0 from CAPACITOR
commit table NODE

Add Column "CAPACITOR" (REG_NODE_KEY )From NODE Set To NFPOS Where intersects
Add Column "CAPACITOR" (NO_KEY )From NODE Set To NFPOS Where intersects
commit table capacitor

End Sub

Sub EDevice

'tüm katmanlara sub_area olarak 1000 verilmiþtir.
'device katmanýnda ttype  eklenmiþtir. node a scada adýnýn kullanmak için kullanacagýz.

'LI_END üzerinde tekrar durulsun

'transformer indirici - 1
'transformer dagýtým - 2

'og ayýrýcý - 3
'og kesýcý - 4
'ag ayirici - 5
'sdk ayirici - 6
		
'devcat type = 6 
'T_TRANSFORMATOR_DAGITICI - T_TRANSFORMATOR_INDIRICI
'SCADA formul : [TM_NO]_TR-[TR_NO]

'devcat type - 4 
'T_OG_AYIRICI

'[TM_NO]_[GERILIM]H[HUCRE_NO]_ISO_BUSBAR[BARA_NO]_SW
'[TM_NO]_[GERILIM]H[HUCRE_NO]_ISO_LINE_SW
'[TM_NO]_[GERILIM]H[HUCRE_NO]_GND_ISO_SW
'[TM_NO]_[GERILIM]H[HUCRE_NO]_COUP-[KUBLAJ_NO]_SW
'[TM_NO]_[GERILIM][HUCRE_ONEKI][HUCRE_NO]_ISO_BUSBAR[BARA_NO]_SW
'[TM_NO]_[GERILIM][HUCRE_ONEKI][HUCRE_NO]_ISO_LINE_SW
'[TM_NO]_[GERILIM][HUCRE_ONEKI][HUCRE_NO]_GND_ISO_SW
'[TM_NO]_[GERILIM][HUCRE_ONEKI][HUCRE_NO]_COUP-[KUBLAJ_NO]_SW

'T_OG_KESICI

'[TM_NO]_[GERILIM]H[HUCRE_NO]_CB_SW
'[TM_NO]_[GERILIM]H[HUCRE_NO]_COUP_CB-[KUBLAJ_NO]_SW
'[TM_NO]_[GERILIM]H[HUCRE_NO]_RECLOSER_SW
'[TM_NO]_[GERILIM][HUCRE_ONEKI][HUCRE_NO]_CB_SW
'[TM_NO]_[GERILIM][HUCRE_ONEKI][HUCRE_NO]_COUP_CB-[KUBLAJ_NO]_SW
'[TM_NO]_[GERILIM][HUCRE_ONEKI][HUCRE_NO]_RECLOSER_SW

'T_AG_AYIRICI
'[TM_NO]_[GERILIM]TR-[TR_NO]_DTR_FUSE_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_DTR_FUSE_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_DTR_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_DTR_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_DTR_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_DTR_ISO_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_DTR_ISO_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_DTR_LBS_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_CAP_FUSE-[DEPAR_NO]_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_CAP_FUSE-[DEPAR_NO]_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_CAP_CB-[DEPAR_NO]_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_CAP_CB-[DEPAR_NO]_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_CAP_CB-[DEPAR_NO]_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_CAP_ISO-[DEPAR_NO]_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_CAP_ISO-[DEPAR_NO]_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_CAP_LBS-[DEPAR_NO]_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_D-[DEPAR_NO]_FUSE_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_D-[DEPAR_NO]_FUSE_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_D-[DEPAR_NO]_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_D-[DEPAR_NO]_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_D-[DEPAR_NO]_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_D-[DEPAR_NO]_ISO_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_D-[DEPAR_NO]_ISO_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_D-[DEPAR_NO]_LBS_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_FUSE_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_FUSE_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_FUSE_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_FUSE_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_CB_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_ISO_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_ISO_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_ISO_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_ISO_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_LBS_SW
'[TM_NO]_[GERILIM]TR-[TR_NO]_A-[DEPAR_NO]_LBS_SW
'IntSqr3*[GERILIM]kV*[ANMA_AKIMI]AkVA

'K_SDK_AYIRICI

'[SDK_NO]_[GERILIM]_IN-[SDK_DEPAR_NO]_SDK_FUSE
'[SDK_NO]_[GERILIM]_OUT-[SDK_DEPAR_NO]_SDK_FUSE
'[SDK_NO]_[GERILIM]_D-[SDK_DEPAR_NO]_SDK_FUSE
'[SDK_NO]_[GERILIM]_M-[SDK_DEPAR_NO]_SDK_FUSE
'IntSqr3*[GERILIM]kV*[ANMA_AKIMI]AkVA


'OG_TECHIZAT(SIGORTA)
'[TM_NO]_[GERILIM]H[HUCRE_NO]_FUSE_SW

'Ddirek ayirici
'[TM_NO]_[GERILIM]_SEKSIYONER_SW

'T_AG_TECHIZAT(KONDANSATOR)
'[TM_NO]_[GERILIM]_CAP-[KONDANSATOR_NO]

set coordsys table OG_KESICI

_devcat = 4
select * from DIREK_AYIRICI where obj and abb_int_id<>0 into selDeviceDA
fetch first from selDeviceDA

For ida = 0 To tableinfo(selDeviceDA,8)
	
	deviceDA_tmNo 		= selDeviceDA.tm_no
	deviceDA_gerilim 	= val(selDeviceDA.gerilim)
	deviceDA_abbIntId	= selDeviceDA.abb_int_id
	deviceDA_obj 		= selDeviceDA.obj
	deviceDA_X 			= val(left$(str$(format$(centroidx(deviceDA_obj),"##.###")) ,instr(1,str$(centroidx(deviceDA_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceDA_obj),"##.###")) ,instr(1,str$(centroidx(deviceDA_obj)), "." )+1,4))
	deviceDA_Y 			= val(left$(str$(format$(centroidy(deviceDA_obj),"##.###")) ,instr(1,str$(centroidy(deviceDA_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceDA_obj),"##.###")) ,instr(1,str$(centroidy(deviceDA_obj)), "." )+1,4))
	'deviceDA_X = centroidx(deviceDA_obj) * 1000
	'deviceDA_Y = centroidy(deviceDA_obj) * 1000
	deviceDA_typeCode 	= selDeviceDA.typecode
	deviceDA_subId 		= selDeviceDA.abb_int_id
	deviceDA_subArea	= selDeviceDA.sub_area
	anahtarDurum		= selDeviceDA.normal_anahtarlama_durumu
	'anahtarlama			= selDeviceDA.anahtarlama
	anahtarlama			= selDeviceDA.normal_anahtarlama_durumu
	
	Do Case anahtarlama
	case "ACIK"
		anahtarlama = "0"
	case "KAPALI"
		anahtarlama = "111"
	case else 
		anahtarlama = "111"
	end case
	
	Do Case anahtarDurum
	case "ACIK"
		anahtarDurum = "0"
	case "KAPALI"
		anahtarDurum = "111"
	case else 
		anahtarDurum = "111"
	end case
	
deviceDA_ScadaDef = deviceDA_tmNo + "_" +  deviceDA_gerilim/1000 + "kV_SEKSIYONER_SW"
insert into Device(obj,DID,DNAME,DFPOS,ABB_INT_ID,LI_KEY,LINE_END,SUB_AREA,XD_1,YD_1,XD_2,YD_2,DEVCAT,DT_KEY,PHASE,NORM_STATE,STATUS,DEVICESIZE,STATE,DESCRIPTIVE_LOC,ATO_KEY,PREFERRED,ANNOPOS_1,ANNOPOS_2,TAPSIDE,TAP_1,TAP_2,TAP_3,TAP_4,CONTROLLED,REQVOLTS,SENSING_PHASE,ASSET_ID,BREAKAMPS,ttype,SUB_ID,VLEVEL,SG_KEY1,DEVTABLETYPE) Values (deviceDA_obj,"DE_" + deviceDA_abbIntId,deviceDA_ScadaDef,deviceDA_abbIntId,deviceDA_abbIntId,0,1,deviceDA_subArea,deviceDA_X,deviceDA_Y,deviceDA_X,deviceDA_Y,_devcat,deviceDA_typeCode,111,val(anahtarDurum),val(anahtarlama),0,1,0,0,0,0,0,0,0,0,0,0,-1,0,0,deviceDA_abbIntId,0,2,deviceDA_subId,22,16,1)

fetch next from selDeviceDA
Next

_devcat = 18
select * from OG_TECHIZAT where tip="SIGORTA" and abb_int_id<>0 into selDeviceOS
fetch first from selDeviceOS

For ios = 0 To tableinfo(selDeviceOS,8)
	
	deviceOS_tmNo 		= selDeviceOS.tm_no
	deviceOS_hucreNo 	= selDeviceOS.hucre_no
	deviceOS_gerilim 	= val(selDeviceOS.gerilim)
	deviceOS_abbIntId	= selDeviceOS.abb_int_id
	deviceOS_obj 		= selDeviceOS.obj
	deviceOS_X 			= val(left$(str$(format$(centroidx(deviceOS_obj),"##.###")) ,instr(1,str$(centroidx(deviceOS_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceOS_obj),"##.###")) ,instr(1,str$(centroidx(deviceOS_obj)), "." )+1,4))
	deviceOS_Y 			= val(left$(str$(format$(centroidy(deviceOS_obj),"##.###")) ,instr(1,str$(centroidy(deviceOS_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceOS_obj),"##.###")) ,instr(1,str$(centroidy(deviceOS_obj)), "." )+1,4))
	
	deviceOS_typeCode 	= selDeviceOS.typecode
	deviceOS_subId 		= selDeviceOS.abb_int_id
	deviceOS_subArea 		= selDeviceOS.sub_area
	
deviceOS_ScadaDef = deviceOS_tmNo + "_" +  deviceOS_gerilim/1000 + "kVH" + deviceOS_hucreNo + "_FUSE_SW"
insert into Device(obj,DID,DNAME,DFPOS,ABB_INT_ID,LI_KEY,LINE_END,SUB_AREA,XD_1,YD_1,XD_2,YD_2,DEVCAT,DT_KEY,PHASE,NORM_STATE,STATUS,DEVICESIZE,STATE,DESCRIPTIVE_LOC,ATO_KEY,PREFERRED,ANNOPOS_1,ANNOPOS_2,TAPSIDE,TAP_1,TAP_2,TAP_3,TAP_4,CONTROLLED,REQVOLTS,SENSING_PHASE,ASSET_ID,BREAKAMPS,ttype,SUB_ID,VLEVEL,SG_KEY1,DEVTABLETYPE) Values (deviceOS_obj,"SP_" + deviceOS_abbIntId,deviceOS_ScadaDef,deviceOS_abbIntId,deviceOS_abbIntId,0,1,deviceOS_subArea,deviceOS_X,deviceOS_Y,deviceOS_X,deviceOS_Y,_devcat,deviceOS_typeCode,111,111,111,0,1,0,0,0,0,3,6,0,0,0,0,-1,0,0,deviceOS_abbIntId,0,2,deviceOS_subId,7,55,2)

fetch next from selDeviceOS
Next

select * from AG_TECHIZAT where tip="KONDANSATOR" and abb_int_id<>0 into selDeviceAT
fetch first from selDeviceAT

For iat = 0 To tableinfo(selDeviceAT,8)
	
	deviceAT_tmNo 		= selDeviceAT.tm_no
	deviceAT_kondansatorNo 	= selDeviceAT.kondansator_no
	deviceAT_gerilim 	= val(selDeviceAT.gerilim)
	deviceAT_abbIntId	= selDeviceAT.abb_int_id
	deviceAT_obj 		= selDeviceAT.obj
	deviceAT_X 			= val(left$(str$(format$(centroidx(deviceAT_obj),"##.###")) ,instr(1,str$(centroidx(deviceAT_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceAT_obj),"##.###")) ,instr(1,str$(centroidx(deviceAT_obj)), "." )+1,4))
	deviceAT_Y 			= val(left$(str$(format$(centroidy(deviceAT_obj),"##.###")) ,instr(1,str$(centroidy(deviceAT_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceAT_obj),"##.###")) ,instr(1,str$(centroidy(deviceAT_obj)), "." )+1,4))
	'deviceAT_X = centroidx(deviceAT_obj) * 1000
	'deviceAT_Y = centroidy(deviceAT_obj) * 1000
	deviceAT_typeCode 	= selDeviceAT.typecode
	deviceAT_subId 		= selDeviceAT.abb_int_id
	deviceAT_subArea	= selDeviceAT.sub_Area
	'[TM_NO]_[GERILIM]_CAP-[KONDANSATOR_NO]
deviceAT_ScadaDef = deviceAT_tmNo + "_" +  deviceAT_gerilim/1000 + "kV_CAP-" + deviceAT_kondansatorNo 
insert into Device(obj,DID,DNAME,DFPOS,ABB_INT_ID,LI_KEY,LINE_END,SUB_AREA,XD_1,YD_1,XD_2,YD_2,DEVCAT,DT_KEY,PHASE,NORM_STATE,STATUS,DEVICESIZE,STATE,DESCRIPTIVE_LOC,ATO_KEY,PREFERRED,ANNOPOS_1,ANNOPOS_2,TAPSIDE,TAP_1,TAP_2,TAP_3,TAP_4,CONTROLLED,REQVOLTS,SENSING_PHASE,ASSET_ID,BREAKAMPS,ttype,SUB_ID,VLEVEL,DEVTABLETYPE) Values (deviceAT_obj,"SP_" + deviceAT_abbIntId,deviceAT_ScadaDef,deviceAT_abbIntId,deviceAT_abbIntId,0,1,deviceAT_subArea,deviceAT_X,deviceAT_Y,deviceAT_X,deviceAT_Y,6,deviceAT_typeCode,111,111,111,0,1,0,0,0,0,3,6,0,0,0,0,-1,0,0,deviceAT_abbIntId,0,2,deviceAT_subId,7,3)

fetch next from selDeviceAT
Next

deviceOK_normState = 111
deviceOK_status = 111
_devcat = 4

Select * from OG_KESICI where obj and abb_int_id<>0 into seldeviceOK
fetch first from seldeviceOK

for	ic = 0 to tableinfo(seldeviceOK,8)

	deviceOK_alttip 	= seldeviceOK.alttip
	deviceOK_gerilim 	= val(seldeviceOK.gerilim)
	deviceOK_montajYeri = seldeviceOK.montaj_yeri
	deviceOK_kublajNo 	= seldeviceOK.kublaj_no
	deviceOK_tmNo 		= seldeviceOK.tm_no
	deviceOK_hucreNo 	= seldeviceOK.hucre_no
	deviceOK_abbIntId 	= seldeviceOK.abb_int_id
	deviceOK_typeCode 	= seldeviceOK.typecode
	deviceOK_subId 		= selDeviceOK.abb_int_id
	deviceOK_subArea 	= selDeviceOK.sub_area
	
	deviceOK_obj = seldeviceOK.obj
	deviceOK_X = val(left$(str$(format$(centroidx(deviceOK_obj),"##.###")) ,instr(1,str$(centroidx(deviceOK_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceOK_obj),"##.###")) ,instr(1,str$(centroidx(deviceOK_obj)), "." )+1,4))
	deviceOK_Y = val(left$(str$(format$(centroidy(deviceOK_obj),"##.###")) ,instr(1,str$(centroidy(deviceOK_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceOK_obj),"##.###")) ,instr(1,str$(centroidy(deviceOK_obj)), "." )+1,4))
	'deviceOK_X = centroidx(deviceOK_obj) * 1000
	'deviceOK_Y = centroidy(deviceOK_obj) * 1000
	
			if  deviceOK_alttip="" and deviceOK_montajYeri = ""  then
						deviceOK_ScadaDef  = deviceOK_tmNo +"_" +  deviceOK_gerilim /1000 + "kVH"  + deviceOK_hucreNo + "_" + "_CB_SW"	
						
			elseif  deviceOK_alttip="KUBLAJ KESICISI" and deviceOK_montajYeri = ""  then
						deviceOK_ScadaDef = deviceOK_tmNo +"_" +  deviceOK_gerilim /1000 + "kVH" + deviceOK_hucreNo + "_" + "_COUP_CB-" + deviceOK_kublajNo + "_SW"		
						
			elseif  deviceOK_alttip="TEKRAR KAPAMALI KESICI" and deviceOK_montajYeri = ""  then
						deviceOK_ScadaDef = deviceOK_tmNo +"_" +  deviceOK_gerilim /1000 + "kVH"  + deviceOK_hucreNo + "_" + "_RECLOSER_SW"		
						
			elseif  deviceOK_alttip="" and deviceOK_montajYeri = "TEIAS"  then
						deviceOK_ScadaDef = deviceOK_tmNo +"_" +  deviceOK_gerilim /1000 + "kV" + "H"  + deviceOK_hucreNo + "_" + "_CB_SW"		
						
			elseif  deviceOK_alttip="KUBLAJ KESICISI" and deviceOK_montajYeri = "TEIAS"  then
						deviceOK_ScadaDef = deviceOK_tmNo +"_" +  deviceOK_gerilim /1000 + "kV" +  "H" + deviceOK_hucreNo + "_" + "_COUP_CB-" + deviceOK_kublajNo + "_SW"							
						
			elseif  deviceOK_alttip="TEKRAR KAPAMALI KESICI" and deviceOK_montajYeri = "TEIAS"  then
						deviceOK_ScadaDef = deviceOK_tmNo +"_" +  deviceOK_gerilim /1000 + "kV" + "H"  + deviceOK_hucreNo + "_" + "_RECLOSER_SW"				
			
			else
					deviceOK_ScadaDef  = deviceOK_tmNo + "_" +  deviceOK_gerilim /1000 + "kVH"  + deviceOK_hucreNo +  "_CB_SW"			
			end if			

	anahtarDurum    = seldeviceOK.normal_anahtarlama_durumu
	'anahtarlama	= seldeviceOK.anahtarlama
	anahtarlama		= seldeviceOK.normal_anahtarlama_durumu
	Do Case anahtarlama
	case "ACIK"
		anahtarlama = "000"
	case "KAPALI"
		anahtarlama = "111"
	case else 
		anahtarlama = "111"
	end case
	
	
	Do Case anahtarDurum
	case "ACIK"
		anahtarDurum = 0
	case "KAPALI"
		anahtarDurum = 111
	case else 
		anahtarDurum = 111
	end case


'LI_END üzerinde tekrar durulsun
'DTKEY 2009 olarak basýldý, bu da sorulsun.
'Controlled katmaný ne iþe yarar?
'diðer alanlara 0 basýlmýþtýr, örneklerde ayný þekilde..


insert into Device(obj,DID,DNAME,DFPOS,ABB_INT_ID,LI_KEY,LINE_END,SUB_AREA,XD_1,YD_1,XD_2,YD_2,DEVCAT,DT_KEY,PHASE,NORM_STATE,STATUS,DEVICESIZE,STATE,DESCRIPTIVE_LOC,ATO_KEY,PREFERRED,ANNOPOS_1,ANNOPOS_2,TAPSIDE,TAP_1,TAP_2,TAP_3,TAP_4,CONTROLLED,REQVOLTS,SENSING_PHASE,ASSET_ID,BREAKAMPS,ttype,SUB_ID,VLEVEL,SG_KEY1,DEVTABLETYPE) Values (deviceOK_obj,"BR_" + deviceOK_abbIntId,deviceOK_ScadaDef,deviceOK_abbIntId,deviceOK_abbIntId,0,0,deviceOK_subArea,deviceOK_X,deviceOK_Y,deviceOK_X,deviceOK_Y,_devcat,deviceOK_typeCode,111,val(anahtarDurum),val(anahtarlama),0,1,0,0,0,3,6,0,0,0,0,0,-1,0,0,deviceOK_abbIntId,0,4,deviceOK_subId,22,15,4)

fetch next from seldeviceOK
next


'[TM_NO]_TR-[TR_NO]
_devcat = 6
select * from TRF_DAGITIM where obj and abb_int_id<>0 into selDeviceTR
fetch first from selDeviceTR

For itr = 0 To tableinfo(selDeviceTR,8)
	
	deviceTR_tmNo = selDeviceTR.tm_no
	deviceTR_trNo = selDeviceTR.tr_no
	deviceTR_abbIntId = selDeviceTR.abb_int_id
	deviceTR_obj = selDeviceTR.obj
	deviceTR_X = val(left$(str$(format$(centroidx(deviceTR_obj),"##.###")) ,instr(1,str$(centroidx(deviceTR_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceTR_obj),"##.###")) ,instr(1,str$(centroidx(deviceTR_obj)), "." )+1,4))
	deviceTR_Y =val(left$(str$(format$(centroidy(deviceTR_obj),"##.###")) ,instr(1,str$(centroidy(deviceTR_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceTR_obj),"##.###")) ,instr(1,str$(centroidy(deviceTR_obj)), "." )+1,4))
	'deviceTR_X = centroidx(deviceTR_obj) * 1000
	'deviceTR_Y = centroidy(deviceTR_obj) * 1000
	
	deviceTR_typeCode = selDeviceTR.typecode
	deviceTR_subId = selDeviceTR.abb_int_id
	deviceTR_subArea = selDeviceTR.sub_area
	
deviceTR_ScadaDef = deviceTR_tmNo + "_DTR-" +  deviceTR_trNo
insert into Device(obj,DID,DNAME,DFPOS,ABB_INT_ID,LI_KEY,LINE_END,SUB_AREA,XD_1,YD_1,XD_2,YD_2,DEVCAT,DT_KEY,PHASE,NORM_STATE,STATUS,DEVICESIZE,STATE,DESCRIPTIVE_LOC,ATO_KEY,PREFERRED,ANNOPOS_1,ANNOPOS_2,TAPSIDE,TAP_1,TAP_2,TAP_3,TAP_4,CONTROLLED,REQVOLTS,SENSING_PHASE,ASSET_ID,BREAKAMPS,ttype,SUB_ID,VLEVEL,SG_KEY1,DEVTABLETYPE) Values (deviceTR_obj,"TR_" + deviceTR_abbIntId,deviceTR_ScadaDef,deviceTR_abbIntId,deviceTR_abbIntId,0,1,deviceTR_subArea,deviceTR_X,deviceTR_Y,deviceTR_X,deviceTR_Y,_devcat,deviceTR_typeCode,111,111,111,0,1,0,0,0,3,6,0,0,0,0,0,deviceTR_abbIntId,0,0,deviceTR_abbIntId,0,2,deviceTR_subId,7,41,5)

fetch next from selDeviceTR
Next

deviceOA_normState = 111
deviceOA_Status = 111
_devcat = 4

Select * from OG_AYIRICI where abb_int_id<>0 into seldeviceOA
fetch first from seldeviceOA

for	ioa = 0 to tableinfo(seldeviceOA,8)

	deviceOA_alttip 	= seldeviceOA.alttip
	'deviceOA_gerilim 	= val(seldeviceOA.gerilim)
	deviceOA_gerilim = 34500
	deviceOA_akim = seldeviceOA.anma_akimi
	deviceOA_montajYeri = seldeviceOA.montaj_yeri
	deviceOA_kublajNo 	= seldeviceOA.kublaj_no
	deviceOA_tmNo 		= seldeviceOA.tm_no
	deviceOA_hucreNo 	= seldeviceOA.hucre_no
	deviceOA_abbIntId 	= seldeviceOA.abb_int_id
	deviceOA_typeCode 	= seldeviceOA.typecode
	deviceOA_baraNo 	= seldeviceOA.bara_no
	deviceOA_subId 	    = seldeviceOA.abb_int_id
	deviceOA_subArea 	= seldeviceOA.sub_Area
	
	deviceOA_obj = seldeviceOA.obj
	deviceOA_X = val(left$(str$(format$(centroidx(deviceOA_obj),"##.###")) ,instr(1,str$(centroidx(deviceOA_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceOA_obj),"##.###")) ,instr(1,str$(centroidx(deviceOA_obj)), "." )+1,4))
	deviceOA_Y = val(left$(str$(format$(centroidy(deviceOA_obj),"##.###")) ,instr(1,str$(centroidy(deviceOA_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceOA_obj),"##.###")) ,instr(1,str$(centroidy(deviceOA_obj)), "." )+1,4))
	
	'deviceOA_X = centroidx(deviceOA_obj) * 1000
	'deviceOA_Y = centroidy(deviceOA_obj) * 1000
	
		    if  deviceOA_alttip="BARA AYIRICI" or deviceOA_montajYeri = "BARA AYIRICI" or deviceOA_montajYeri = "TEIAS - BARA AYIRICI"  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kVH" +   + deviceOA_hucreNo + "_ISO_BUSBAR" + deviceOA_baraNo + "_SW"					
					
			elseif  deviceOA_alttip="TOPRAKLI AYIRICI"  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kV"  + "H" + deviceOA_hucreNo + "_GND_ISO_SW"
	
			elseif  deviceOA_montajYeri = "HAT AYIRICI" or deviceOA_montajYeri = "TEIAS - HAT AYIRICI"  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kVH" + deviceOA_hucreNo + "_ISO_LINE_SW"	
	
			elseif  deviceOA_alttip="" and deviceOA_montajYeri = "BARA AYIRICI"  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kVH" +   + deviceOA_hucreNo + "_ISO_BUSBAR" + deviceOA_baraNo + "_SW"						
			
			elseif  deviceOA_alttip="" and deviceOA_montajYeri = "HAT AYIRICI"  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kVH" + deviceOA_hucreNo + "_ISO_LINE_SW"	
						
			elseif  deviceOA_alttip="TOPRAKLI AYIRICI" and deviceOA_montajYeri = ""  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kVH"  + deviceOA_hucreNo + "_GND_ISO_SW"	
					deviceOA_normState = 0
					deviceOA_Status = 0
						
			elseif  deviceOA_alttip="KUBLAJ AYIRICI" and deviceOA_montajYeri = ""  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kVH"  + deviceOA_hucreNo + "_COUP_" + deviceOA_kublajNo + "_SW"
						
			elseif  deviceOA_alttip="" and deviceOA_montajYeri = "TEIAS - BARA AYIRICI"  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kVH"  + "HO" + deviceOA_hucreNo + "_ISO_BUSBAR" + deviceOA_baraNo + "_SW"								
						
			elseif  deviceOA_alttip="" and deviceOA_montajYeri = "TEIAS - HAT AYIRICI"  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kVH"  + "HO" + deviceOA_hucreNo + "_ISO_LINE_SW"
			
			elseif  deviceOA_alttip="TOPRAKLI AYIRICI" and deviceOA_montajYeri = "TEIAS"  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kV"  + "HO" + deviceOA_hucreNo + "_GND_ISO_SW"
					deviceOA_normState = 0
					deviceOA_Status = 0
			
			elseif  deviceOA_alttip="KUBLAJ AYIRICI" and deviceOA_montajYeri = "TEIAS"  then
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kV"  + "HO" + deviceOA_hucreNo + "_COUP-" +  deviceOA_kublajNo + "_SW"			
			
			else
					deviceOA_ScadaDef  = deviceOA_tmNo +"_" +  deviceOA_gerilim /1000 + "kVH" + deviceOA_hucreNo + "_ISO_LINE_SW"				
			end if	
			
'LI_END üzerinde tekrar durulsun

'anahtarlama			= seldeviceOA.anahtarlama
	anahtarlama			= seldeviceOA.normal_anahtarlama_durumu	
	Do Case anahtarlama
	case "ACIK"
		anahtarlama = "0"
	case "KAPALI"
		anahtarlama = "111"
	case else 
		anahtarlama = "111"
	end case

anahtarDurum = seldeviceOA.normal_anahtarlama_durumu
	
	Do Case anahtarDurum
	case "ACIK"
		anahtarDurum = 0
	case "KAPALI"
		anahtarDurum = 111
	case else 
		anahtarDurum = 111
	end case

	
insert into Device(obj,DID,DNAME,DFPOS,ABB_INT_ID,LI_KEY,LINE_END,SUB_AREA,XD_1,YD_1,XD_2,YD_2,DEVCAT,DT_KEY,PHASE,NORM_STATE,STATUS,DEVICESIZE,STATE,DESCRIPTIVE_LOC,ATO_KEY,PREFERRED,ANNOPOS_1,ANNOPOS_2,TAPSIDE,TAP_1,TAP_2,TAP_3,TAP_4,CONTROLLED,REQVOLTS,SENSING_PHASE,ASSET_ID,BREAKAMPS,ttype,SUB_ID,VLEVEL,SG_KEY1,GERILIM,AKIM,DEVTABLETYPE) Values (deviceOA_obj,"DE_" + deviceOA_abbIntId,deviceOA_ScadaDef,deviceOA_abbIntId,deviceOA_abbIntId,0,0,deviceOA_subArea,deviceOA_X,deviceOA_Y,deviceOA_X,deviceOA_Y,_devcat,deviceOA_typeCode,111,val(anahtarDurum),val(anahtarlama),0,1,deviceOA_montajYeri,0,0,0,0,0,0,0,0,0,deviceOA_abbIntId,0,0,deviceOA_abbIntId,0,3,deviceOA_subId,22,41,deviceOA_gerilim,deviceOA_akim,6)

fetch next from seldeviceOA
next


deviceAA_normState = 111
deviceAA_status = 111
_devcat = 4
update ag_ayirici set obj =buffer(obj, 32, 0.2, "cm")
update AG_KABLO_NOKTASI set obj =buffer(obj, 32, 0.2, "cm")
commit table AG_KABLO_NOKTASI
commit table ag_ayirici

Alter Table "AG_KABLO_BAGLANTISI" ( add AYIRICI_ID Integer ) Interactive
Add Column "AG_KABLO_BAGLANTISI" (AYIRICI_ID )From AG_AYIRICI Set To ABB_INT_ID Where intersects
Alter Table "AG_KABLO_NOKTASI" ( add AYIRICI_ID Integer ) Interactive
Add Column "AG_KABLO_NOKTASI" (AYIRICI_ID )From AG_KABLO_BAGLANTISI Set To AYIRICI_ID Where intersects
commit table AG_KABLO_BAGLANTISI
commit table AG_KABLO_NOKTASI

Select * from AG_AYIRICI where obj and abb_int_id<>0 into seldeviceAA
fetch first from seldeviceAA

for	iaa = 0 to tableinfo(seldeviceAA,8)

	deviceAA_tip 	= seldeviceAA.tip
	deviceAA_gerilim 	= val(seldeviceAA.gerilim)
	deviceAA_akim 	= val(seldeviceAA.anma_akimi)
	deviceAA_montajYeri = seldeviceAA.montaj_yeri
	deviceAA_tmNo 		= seldeviceAA.tm_no
	deviceAA_trNo 		= seldeviceAA.tr_no
	deviceAA_deparNo    = seldeviceAA.depar_no
	deviceAA_abbIntId   = seldeviceAA.abb_int_id
	deviceAA_typeCode   = seldeviceAA.typecode
	deviceAA_subId      = seldeviceAA.abb_int_id
	deviceAA_subArea = seldeviceAA.sub_area
	deviceAA_load = seldeviceAA.load
	deviceSA_LOADX	 = 0
	deviceSA_LOADY   = 0
	
	if deviceAA_load = 1 then
		select obj from AG_KABLO_NOKTASI where ayirici_id=deviceAA_abbIntId into sxL
		fetch first from sxL
		deviceAA_obj = sxL.obj
		'deviceAA_loadX =  val(left$(str$(format$(centroidx(deviceAA_obj),"##.###")) ,instr(1,str$(centroidx(deviceAA_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceAA_obj),"##.###")) ,instr(1,str$(centroidx(deviceAA_obj)), "." )+1,4))
		'deviceAA_loadY =  val(left$(str$(format$(centroidy(deviceAA_obj),"##.###")) ,instr(1,str$(centroidy(deviceAA_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceAA_obj),"##.###")) ,instr(1,str$(centroidy(deviceAA_obj)), "." )+1,4))
		deviceAA_loadX = centroidx(deviceAA_obj)* 1000
		deviceAA_loadY = centroidy(deviceAA_obj)* 1000
	end if
	
		deviceAA_obj = seldeviceAA.obj
		deviceAA_X =  val(left$(str$(format$(centroidx(deviceAA_obj),"##.###")) ,instr(1,str$(centroidx(deviceAA_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceAA_obj),"##.###")) ,instr(1,str$(centroidx(deviceAA_obj)), "." )+1,4))
		deviceAA_Y =  val(left$(str$(format$(centroidy(deviceAA_obj),"##.###")) ,instr(1,str$(centroidy(deviceAA_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceAA_obj),"##.###")) ,instr(1,str$(centroidy(deviceAA_obj)), "." )+1,4))
	
	'deviceAA_X = centroidx(deviceAA_obj) * 1000
	'deviceAA_Y = centroidy(deviceAA_obj) * 1000
	
			if  deviceAA_tip="NH BUSON" and deviceAA_montajYeri = "AG PANOSU"  then
					deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_DTR_FUSE_SW"
				_devcat = 18
						
			elseif  deviceAA_tip="SIGORTALI DIKEY YUK AYIRICI" and deviceAA_montajYeri = "AG PANOSU"  then
					deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_DTR_FUSE_SW"
				_devcat = 18
						
			elseif  deviceAA_tip="OTOMATIK SALTER" and deviceAA_montajYeri = "AG PANOSU"  then
					deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_DTR_CB_SW"			
			_devcat = 4
			elseif  deviceAA_tip="KOMPAKT SALTER (TM)" and deviceAA_montajYeri = "AG PANOSU"  then
					deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_DTR_CB_SW"			
			_devcat = 4
			elseif  deviceAA_tip="KOLLU ADI SALTER" and deviceAA_montajYeri = "AG PANOSU"  then
					deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_DTR_CB_SW"			
			_devcat = 4
			elseif  deviceAA_tip="OZENGILI SALTER" and deviceAA_montajYeri = "AG PANOSU"  then
					deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_DTR_ISO_SW"	
			_devcat = 4
			elseif  deviceAA_tip="KONTAKTOR" and deviceAA_montajYeri = "AG PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_DTR_ISO_SW"	
			_devcat = 4
			elseif  deviceAA_tip="SIGORTASIZ YUK AYIRICI" and deviceAA_montajYeri = "AG PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_DTR_LBS_SW"	
			_devcat = 4
			elseif  deviceAA_tip="NH BUSON" and deviceAA_montajYeri = "AYDINLATMA DEPARI"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_FUSE_SW"
			_devcat = 18
			
			elseif  deviceAA_tip="SIGORTALI DIKEY YUK AYIRICI" and deviceAA_montajYeri = "AYDINLATMA DEPARI"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_FUSE_SW"
			_devcat = 18
			
			elseif  deviceAA_tip="OTOMATIK SALTER" and deviceAA_montajYeri = "AYDINLATMA DEPARI"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_CB_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KOMPAKT SALTER (TM)" and deviceAA_montajYeri = "AYDINLATMA DEPARI"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_CB_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KOLLU ADI SALTER" and deviceAA_montajYeri = "AYDINLATMA DEPARI"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_CB_SW"
			_devcat = 4
			elseif  deviceAA_tip="OZENGILI SALTER" and deviceAA_montajYeri = "AYDINLATMA DEPARI"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_ISO_SW"
			_devcat = 4
			elseif  deviceAA_tip="KONTAKTOR" and deviceAA_montajYeri = "AYDINLATMA DEPARI"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_ISO_SW"
			_devcat = 4
			elseif  deviceAA_tip="SIGORTASIZ YUK AYIRICI" and deviceAA_montajYeri = "AYDINLATMA DEPARI"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_LBS_SW"
			_devcat = 4
			elseif  deviceAA_tip="NH BUSON" and deviceAA_montajYeri = "AYDINLATMA PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_FUSE_SW"
			_devcat = 18
						
			elseif  deviceAA_tip="SIGORTALI DIKEY YUK AYIRICI" and deviceAA_montajYeri = "AYDINLATMA PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceOK_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_FUSE_SW"
						_devcat = 18
						
			elseif  deviceAA_tip="OTOMATIK SALTER" and deviceAA_montajYeri = "AYDINLATMA PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_CB_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KOMPAKT SALTER (TM)" and deviceAA_montajYeri = "AYDINLATMA PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_CB_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KOLLU ADI SALTER" and deviceAA_montajYeri = "AYDINLATMA PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_CB_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="OZENGILI SALTER" and deviceAA_montajYeri = "AYDINLATMA PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_ISO_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KONTAKTOR" and deviceAA_montajYeri = "AYDINLATMA PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_ISO_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="SIGORTASIZ YUK AYIRICI" and deviceAA_montajYeri = "AYDINLATMA PANOSU"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_A-" + deviceAA_deparNo +"_LBS_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="NH BUSON" and deviceAA_montajYeri = "DEPAR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_D-" + deviceAA_deparNo +"_FUSE_SW"
			_devcat = 18
						
			elseif  deviceAA_tip="SIGORTALI DIKEY YUK AYIRICI" and deviceAA_montajYeri = "DEPAR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_D-" + deviceAA_deparNo +"_FUSE_SW"
			_devcat = 4
						
			elseif  deviceAA_tip="OTOMATIK SALTER" and deviceAA_montajYeri = "DEPAR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_D-" + deviceAA_deparNo +"_CB_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KOMPAKT SALTER (TM)" and deviceAA_montajYeri = "DEPAR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_D-" + deviceAA_deparNo +"_CB_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KOLLU ADI SALTER" and deviceAA_montajYeri = "DEPAR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_D-" + deviceAA_deparNo +"_CB_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="OZENGILI SALTER" and deviceAA_montajYeri = "DEPAR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_D-" + deviceAA_deparNo +"_ISO_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KONTAKTOR" and deviceAA_montajYeri = "DEPAR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_D-" + deviceAA_deparNo +"_ISO_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="SIGORTASIZ YUK AYIRICI" and deviceAA_montajYeri = "DEPAR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_D-" + deviceAA_deparNo +"_LBS_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="NH BUSON" and deviceAA_montajYeri = "KONDANSATOR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_CAP_FUSE-" + deviceAA_deparNo +"_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="SIGORTALI DIKEY YUK AYIRICI" and deviceAA_montajYeri = "KONDANSATOR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_CAP_FUSE-" + deviceAA_deparNo +"_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="OTOMATIK SALTER" and deviceAA_montajYeri = "KONDANSATOR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_CAP_CB-" + deviceAA_deparNo +"_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KOMPAKT SALTER (TM)" and deviceAA_montajYeri = "KONDANSATOR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_CAP_CB-" + deviceAA_deparNo +"_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KOLLU ADI SALTER" and deviceAA_montajYeri = "KONDANSATOR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_CAP_CB-" + deviceAA_deparNo +"_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="OZENGILI SALTER" and deviceAA_montajYeri = "KONDANSATOR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_CAP_ISO-" + deviceAA_deparNo +"_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="KONTAKTOR" and deviceAA_montajYeri = "KONDANSATOR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_CAP_ISO-" + deviceAA_deparNo +"_SW"
			_devcat = 4
			
			elseif  deviceAA_tip="SIGORTASIZ YUK AYIRICI" and deviceAA_montajYeri = "KONDANSATOR"  then
						deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_CAP_LBS-" + deviceAA_deparNo +"_SW"
			_devcat = 4
			
			else
					deviceAA_ScadaDef  = deviceAA_tmNo +"_" +  deviceAA_gerilim /1000 + "kVTR-" + deviceAA_trNo + "_DTR_FUSE_SW"		
					_devcat = 18
			end if			

'anahtarlama			= seldeviceAA.anahtarlama
	anahtarlama			= seldeviceAA.normal_anahtarlama_durumu	
	Do Case anahtarlama
	case "ACIK"
		anahtarlama = "0"
	case "KAPALI"
		anahtarlama = "111"
	case else 
		anahtarlama = "111"
	end case


anahtarDurum = seldeviceAA.normal_anahtarlama_durumu
	
	Do Case anahtarDurum
	case "ACIK"
		anahtarDurum = 0
	case "KAPALI"
		anahtarDurum = 111
	case else 
		anahtarDurum = 111
	end case

insert into Device(obj,DID,DNAME,DFPOS,ABB_INT_ID,LI_KEY,LINE_END,SUB_AREA,XD_1,YD_1,XD_2,YD_2,DEVCAT,DT_KEY,PHASE,NORM_STATE,STATUS,DEVICESIZE,STATE,DESCRIPTIVE_LOC,ATO_KEY,PREFERRED,ANNOPOS_1,ANNOPOS_2,TAPSIDE,TAP_1,TAP_2,TAP_3,TAP_4,CONTROLLED,REQVOLTS,SENSING_PHASE,ASSET_ID,BREAKAMPS,ttype,SUB_ID,VLEVEL,SG_KEY1,AA,AAL,GERILIM,AKIM,DEVTABLETYPE,LOAD_X,LOAD_Y) Values (deviceAA_obj,"SP_" + deviceAA_abbIntId,deviceAA_ScadaDef,deviceAA_abbIntId,deviceAA_abbIntId,0,0,deviceAA_subArea,deviceAA_X,deviceAA_Y,deviceAA_X,deviceAA_Y,_devcat,deviceAA_typeCode,111,val(anahtarDurum),val(anahtarlama),0,1,deviceAA_montajYeri,0,0,3,6,0,0,0,0,0,deviceAA_abbIntId,0,0,deviceAA_abbIntId,0,5,deviceAA_subId,7,41,1,deviceAA_load,deviceAA_gerilim,deviceAA_akim,7,deviceAA_loadX,deviceAA_loadY)
fetch next from seldeviceAA
next

deviceSA_normState = 111
deviceSA_status = 111
_devcat = 4

update SDK_ayirici set obj =buffer(obj, 32, 0.2, "cm")
update SDK_KABLO_NOKTASI set obj =buffer(obj, 32, 0.2, "cm")
commit table SDK_KABLO_NOKTASI
commit table SDK_ayirici

Alter Table "SDK_KABLO_BAGLANTISI" ( add AYIRICI_ID Integer ) Interactive
Add Column "SDK_KABLO_BAGLANTISI" (AYIRICI_ID )From SDK_AYIRICI Set To ABB_INT_ID Where intersects
Alter Table "SDK_KABLO_NOKTASI" ( add AYIRICI_ID Integer ) Interactive
Add Column "SDK_KABLO_NOKTASI" (AYIRICI_ID )From SDK_KABLO_BAGLANTISI Set To AYIRICI_ID Where intersects
commit table SDK_KABLO_BAGLANTISI
commit table SDK_KABLO_NOKTASI


select * from SDK_AYIRICI where obj and abb_int_id<>0 into selDeviceSA
fetch first from selDeviceSA

For isa = 0 To tableinfo(selDeviceSA,8)
	
	deviceSA_sdkNo = selDeviceSA.sdk_no
	deviceSA_sdkDeparNo = selDeviceSA.sdk_depar_no
	deviceSA_gerilim 	= val(seldeviceSA.gerilim)
	deviceSA_load = selDeviceSA.load
	deviceSA_akim 	= val(seldeviceSA.anma_akimi)
	deviceSA_abbIntId = selDeviceSA.abb_int_id
	deviceSA_LOADX	 = 0
	deviceSA_LOADY   = 0
	
	if deviceSA_load = 1 then
		select obj from SDK_KABLO_NOKTASI where ayirici_id=deviceSA_abbIntId into sxL1
	
		deviceSA_obj = sxL1.obj
		'deviceSA_LOADX =  val(left$(str$(format$(centroidx(deviceSA_obj),"##.###")) ,instr(1,str$(centroidx(deviceSA_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceSA_obj),"##.###")) ,instr(1,str$(centroidx(deviceSA_obj)), "." )+1,4))
		'deviceSA_LOADY =  val(left$(str$(format$(centroidy(deviceSA_obj),"##.###")) ,instr(1,str$(centroidy(deviceSA_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceSA_obj),"##.###")) ,instr(1,str$(centroidy(deviceSA_obj)), "." )+1,4))
		deviceSA_LOADX = centroidx(deviceSA_obj)*1000
		deviceSA_LOADY = centroidy(deviceSA_obj)*1000
	end if
		deviceSA_obj = seldeviceSA.obj
		deviceSA_X =  val(left$(str$(format$(centroidx(deviceSA_obj),"##.###")) ,instr(1,str$(centroidx(deviceSA_obj)) , "." )-1) + mid$(str$(format$(centroidx(deviceSA_obj),"##.###")) ,instr(1,str$(centroidx(deviceSA_obj)), "." )+1,4))
		deviceSA_Y =  val(left$(str$(format$(centroidy(deviceSA_obj),"##.###")) ,instr(1,str$(centroidy(deviceSA_obj)) , "." )-1) + mid$(str$(format$(centroidy(deviceSA_obj),"##.###")) ,instr(1,str$(centroidy(deviceSA_obj)), "." )+1,4))
			
	'deviceSA_X = centroidx(deviceSA_obj) * 1000
	'deviceSA_Y = centroidy(deviceSA_obj) * 1000
	
	deviceSA_typeCode = selDeviceSA.typecode
	deviceSA_subId = selDeviceSA.abb_int_id
	deviceSA_subArea = selDeviceSA.sub_area
	deviceSA_montajYeri = selDeviceSA.montaj_yeri

		if  deviceSA_montajYeri = "GIRIS"  then
					deviceSA_ScadaDef  = deviceSA_sdkNo +"_" +  deviceSA_gerilim /1000 + "kV_IN-" +   + deviceSA_sdkDeparNo + "_SDK_FUSE" 
			_devcat=4
		elseif  deviceSA_montajYeri = "CIKIS"  then
					deviceSA_ScadaDef  = deviceSA_sdkNo +"_" +  deviceSA_gerilim /1000 + "kV_OUT-" +   + deviceSA_sdkDeparNo + "_SDK_FUSE"			
		_devcat=4 
		elseif  deviceSA_montajYeri = "SDK DEPAR"  then
					deviceSA_ScadaDef  = deviceSA_sdkNo +"_" +  deviceSA_gerilim /1000 + "kV_D-" +   + deviceSA_sdkDeparNo + "_SDK_FUSE"			
		_devcat=18
		elseif  deviceSA_montajYeri = "SDK PANO"  then
					deviceSA_ScadaDef  = deviceSA_sdkNo +"_" +  deviceSA_gerilim /1000 + "kV_M-" +   + deviceSA_sdkDeparNo + "_SDK_FUSE"			
		_devcat=4
		else
					deviceSA_ScadaDef  = deviceSA_sdkNo +"_" +  deviceSA_gerilim /1000 + "kV_IN-" +   + deviceSA_sdkDeparNo + "_SDK_FUSE" 	
		_devcat=4
		end if	


anahtarDurum = seldeviceSA.normal_anahtarlama_durumu
	
	Do Case anahtarDurum
	case "ACIK"
		anahtarDurum ="0"
	case "KAPALI"
		anahtarDurum = "111"
	case else 
		anahtarDurum = "111"
	end case
	

'anahtarlama			= seldeviceSA.anahtarlama
	anahtarlama			= seldeviceSA.normal_anahtarlama_durumu	
	Do Case anahtarlama
	case "ACIK"
		anahtarlama = 000
	case "KAPALI"
		anahtarlama = 111
	case else 
		anahtarlama = 111
	end case

insert into Device(obj,DID,DNAME,DFPOS,ABB_INT_ID,LI_KEY,LINE_END,SUB_AREA,XD_1,YD_1,XD_2,YD_2,DEVCAT,DT_KEY,PHASE,NORM_STATE,STATUS,DEVICESIZE,STATE,DESCRIPTIVE_LOC,ATO_KEY,PREFERRED,ANNOPOS_1,ANNOPOS_2,TAPSIDE,TAP_1,TAP_2,TAP_3,TAP_4,CONTROLLED,REQVOLTS,SENSING_PHASE,ASSET_ID,BREAKAMPS,ttype,SUB_ID,VLEVEL,SG_KEY1,AA,AAL,GERILIM,AKIM,DEVTABLETYPE,LOAD_X,LOAD_Y) Values (deviceSA_obj,"SP_" + deviceSA_abbIntId,deviceSA_ScadaDef,deviceSA_abbIntId,deviceSA_abbIntId,0,1,deviceSA_subArea,deviceSA_X,deviceSA_Y,deviceSA_X,deviceSA_Y,_devcat,deviceSA_typeCode,111,val(anahtarDurum),val(anahtarlama),0,1,deviceSA_montajYeri,0,0,3,6,0,0,0,0,0,deviceSA_abbIntId,0,0,deviceSA_abbIntId,0,6,deviceSA_subID,7,41,1,1,deviceSA_gerilim,deviceSA_akim,8,deviceSA_LOADX,deviceSA_LOADY)

fetch next from selDeviceSA
Next

commit table device

End Sub

sub ExternalUpdateDevice
	
Add Column "DEVICE" (LI_KEY )From CNODE Set To LINE_ID Where intersects
commit table device

Add Column "DEVICE" (DFPOS )From CNODE Set To NFPOS Where intersects
commit table device

select * from device where dfpos=0 into seldf
update selDf set dfpos = 10000000 * Rnd(1)
commit table device

Add Column "DEVICE" (SUB_AREA )From yalova_ilce Set To Ilce_kod Where intersects
commit table device

select * from device where dfpos=0 into sel
update sel set obj = buffer(obj, 32, 0.2, "cm")
select * from device where dfpos=0 into sel2
Add Column "sel2" (DFPOS )From CNODE Set To NFPOS Where intersects
commit table device

update device set xd_1= centroidx(obj) * 1000
update device set yd_1= centroidy(obj) * 1000
update device set xd_2= centroidx(obj) * 1000
update device set yd_2= centroidy(obj) * 1000

commit table device
select * from device where abb_int_id=972114 into sx 
update sx set devcat= 19
commit table sx
update device set status=norm_state
commit table device

End Sub

Sub EDistrict

insert into DISTRICT(ID,NAME,REGION,OP_CENTER_ID) values(201,"YALOVA-M",54,71)
insert into DISTRICT(ID,NAME,REGION,OP_CENTER_ID) values(202,"ALTINOVA",54,71)
commit table District

End Sub

Sub EFeeder

'!********************BURA ACIKLMAA OLARAK KALSIN*************************!

'first node id node.csv de nid kýsmýnda yer almalýdýr.

'ag BAGLANTI NOKTAS- - OG BAGLANTI NOKTASI
'AG-OG BARA

if KolonMevcutMu("AG_KABLO_NOKTASI","AG_AYIRICI_ABB") =0 then
Alter Table "AG_KABLO_NOKTASI" ( add AG_AYIRICI_ABB Integer ) Interactive
end if
if KolonMevcutMu("AG_KABLO_NOKTASI","FIRST_LINE_ID") =0 then
Alter Table "AG_KABLO_NOKTASI" ( add FIRST_LINE_ID Integer ) Interactive
end if
if KolonMevcutMu("AG_KABLO_BAGLANTISI","BNDEF") =0 then
Alter Table "AG_KABLO_BAGLANTISI" ( add BNDEF Char(20) ) Interactive
end if

commit table AG_KABLO_NOKTASI
UPDATE AG_KABLO_NOKTASI set gerilim = 400
commit table AG_KABLO_NOKTASI

if KolonMevcutMu("AG_AYIRICI","LINE_ID") =0 then
Alter Table "AG_AYIRICI" ( add LINE_ID Integer,FIRST_NODE_ID Integer  ) Interactive
end if

if KolonMevcutMu("AG_AYIRICI","BNDEF") =0 then
Alter Table "AG_AYIRICI" ( add BNDEF char(20) ) Interactive
end if

'Add Column "AG_AYIRICI" (LINE_ID )From AG_BARA Set To ABB_INT_ID Where intersects
Add Column "AG_AYIRICI" (LINE_ID )From CONLINE Set To GROUP_ID Where intersects
Add Column "AG_AYIRICI" (FIRST_NODE_ID )From AG_AYIRICI Set To ABB_INT_ID Where intersects

commit table AG_AYIRICI

if KolonMevcutMu("AG_KABLO_BAGLANTISI","scada_fider_no") =0 then
Alter Table "AG_KABLO_BAGLANTISI" ( add scada_fider_no Integer ) Interactive
end if

'Add Column "AG_KABLO_BAGLANTISI" (scada_fider_no )From AG_KABLO_NOKTASI Set To SCADA_FIDER_NO Where tm_no = tm_no 
Add Column "AG_KABLO_BAGLANTISI" (scada_fider_no )From AG_KABLO_NOKTASI Set To SCADA_FIDER_NO Where intersects
commit table AG_KABLO_BAGLANTISI

Add Column "AG_KABLO_NOKTASI" (FIRST_LINE_ID )From AG_AYIRICI Set To LINE_ID Where intersects
Add Column "AG_KABLO_NOKTASI" (AG_AYIRICI_ABB )From AG_AYIRICI Set To FIRST_NODE_ID Where intersects
Add Column "AG_AYIRICI" (BNDEF )From AG_KABLO_BAGLANTISI Set To BNDEF Where intersects

commit table AG_KABLO_NOKTASI

Add Column "AG_KABLO_BAGLANTISI" (BNDEF )From AG_KABLO_NOKTASI Set To tm_no + "_" + val(gerilim) /1000  +"_" + scada_fider_no Where intersects
Add Column "AG_AYIRICI" (BNDEF )From AG_KABLO_BAGLANTISI Set To tm_no + "_" + 400 /1000  +"_" + scada_fider_no Where intersects
'Add Column "AG_AYIRICI" (BNDEF )From AG_KABLO_BAGLANTISI Set To tm_no + "_" + 400 /1000  +"_" + scada_fider_no Where tm_no = tm_no 
commit table AG_AYIRICI

commit table AG_KABLO_NOKTASI
'buraya hatlar ile kesisen baglantý noktalarý feeder içerisine alýnacaktýr.
'Select ag_kablo_noktasi.abb_int_id from AG_KABLO_NOKTASI, DAGITIM_HATTI where AG_KABLO_NOKTASI.Obj intersects DAGITIM_HATTI.Obj into selFeeder
Select ag_kablo_noktasi.abb_int_id from AG_KABLO_NOKTASI, CONLINE where AG_KABLO_NOKTASI.Obj intersects CONLINE.Obj into selFeeder
select * from ag_kablo_noktasi where abb_int_id in(select col1 from selFeeder) into selResultFeeder
select * from ag_ayirici where abb_int_id in(select ayirici_id from selResultFeeder) into selAGFeeder

insert into FEEDER(obj,ID,NAME,SITE,FIRST_NODE_ID,FIRST_LINE_ID,SUB_ID) select obj,abb_int_id,bndef, tm_no, "SP_" + FIRST_NODE_ID,"LK_" + LINE_ID, LINE_ID from selAGFeeder

commit table FEEDER

'/***********************OLMAZ ÝSE KALDIR**********************

'Alter Table "OG_AYIRICI" ( add LINE_ID Integer,FIRST_NODE_ID Integer  ) Interactive
'Alter Table "OG_AYIRICI" ( add BNDEF char(20) ) Interactive
'
'Add Column "OG_AYIRICI" (LINE_ID )From OG_BARA Set To ABB_INT_ID Where intersects
'Add Column "OG_AYIRICI" (FIRST_NODE_ID )From OG_AYIRICI Set To ABB_INT_ID Where intersects
'
'commit table OG_AYIRICI
'
''/************************************************************
'
''og kýsmý
'Alter Table "OG_KABLO_BAGLANTISI" ( add scada_fider_no Integer ) Interactive
'Alter Table "OG_KABLO_BAGLANTISI" ( add FIRST_LINE_ID Integer) Interactive
'
'Add Column "OG_KABLO_BAGLANTISI" (scada_fider_no )From OG_KABLO_NOKTASI Set To SCADA_FIDER_NO Where intersects
'commit table OG_KABLO_BAGLANTISI
'
'Alter Table "OG_KABLO_NOKTASI" ( add OG_AYIRICI_ABB Integer ) Interactive
'Add Column "OG_KABLO_NOKTASI" (FIRST_LINE_ID )From OG_AYIRICI Set To LINE_ID Where intersects
'Add Column "OG_KABLO_NOKTASI" (OG_AYIRICI_ABB )From OG_AYIRICI Set To FIRST_NODE_ID Where intersects
'Add Column "OG_AYIRICI" (BNDEF )From OG_KABLO_BAGLANTISI Set To BNDEF Where intersects
'
'Alter Table "OG_KABLO_BAGLANTISI" ( add BNDEF Char(20) ) Interactive
'Add Column "OG_KABLO_BAGLANTISI" (BNDEF )From OG_KABLO_NOKTASI Set To tm_no + "_" + val(gerilim) /1000  +"_" + scada_fider_no Where intersects
'Add Column "OG_AYIRICI" (BNDEF )From OG_KABLO_BAGLANTISI Set To tm_no + "_" + 400 /1000  +"_" + scada_fider_no Where intersects
'commit table OG_KABLO_BAGLANTISI
'
''direk trafolarda og bara yok buraya tekrar bakýlacaktýr.
'
'Select og_kablo_noktasi.abb_int_id from OG_KABLO_NOKTASI, ENERJI_NAKIL_HATTI where OG_KABLO_NOKTASI.Obj intersects ENERJI_NAKIL_HATTI.Obj into selFeeder
'select * from og_kablo_noktasi where abb_int_id in(select col1 from selFeeder) into selResultFeeder
'select * from og_ayirici where abb_int_id in(select ayirici_id from selResultFeeder) into selOGFeeder
'
'insert into FEEDER(obj,ID,NAME,SITE,FIRST_NODE_ID,FIRST_LINE_ID,SUB_ID) select obj,abb_int_id, BNDEF,tm_no, "SRC_" + sub_id + "_" + abb_int_id,  "LK_" + abb_int_id, sub_id from OG_KABLO_BAGLANTISI
'
'commit table FEEDER
'
'
'select * from feeder where first_node_id not in (select nid from node) into thereisnonidforfeeder
'Select * from line where abb_int_id in (select id from thereisnonidforfeeder) into selNonNode
'Add Column "thereisnonidforfeeder" (CNODEID )From selNonNode Set To NO_KEY_1 Where COL1 = COL1 
'
'Commit Table FEEDER Interactive
'Commit Table LINE Interactive
'
'select * from feeder where cnodeid<>0 into selResLine
'Commit Table selResLine As TargetPath + "\FIRST_POINT.TAB" TYPE NATIVE Charset "WindowsTurkish" Interactive
'Open Table TargetPath + "\FIRST_POINT.TAB" Interactive
'
'select node.nid,FIRST_POINT.first_node_id from node,FIRST_POINT where node.nfpos=FIRST_POINT.cnodeid into slK
'UPDATE SLk SET COL1=COL2
'COMMIT TABLE NODE


'2nci deneme noktasi

'Alter Table "OG_KABLO_NOKTASI" ( add OG_AYIRICI_ABB Integer ) Interactive
'Alter Table "OG_KABLO_NOKTASI" ( add FIRST_LINE_ID Integer ) Interactive
'
'Alter Table "OG_KABLO_BAGLANTISI" ( add BNDEF Char(20) ) Interactive
'
'commit table OG_KABLO_NOKTASI
'
'Alter Table "OG_AYIRICI" ( add LINE_ID Integer,FIRST_NODE_ID Integer  ) Interactive
'Alter Table "OG_AYIRICI" ( add BNDEF char(20) ) Interactive
'
'Add Column "OG_AYIRICI" (LINE_ID )From AG_BARA Set To ABB_INT_ID Where intersects
'Add Column "OG_AYIRICI" (FIRST_NODE_ID )From OG_AYIRICI Set To ABB_INT_ID Where intersects
'
'commit table OG_AYIRICI
'
''Alter Table "OG_KABLO_BAGLANTISI" ( add scada_fider_no Integer ) Interactive
'Add Column "OG_KABLO_BAGLANTISI" (scada_fider_no )From OG_KABLO_NOKTASI Set To SCADA_FIDER_NO Where intersects
'commit table OG_KABLO_BAGLANTISI
'
'Add Column "OG_KABLO_NOKTASI" (FIRST_LINE_ID )From OG_AYIRICI Set To LINE_ID Where intersects
'Add Column "OG_KABLO_NOKTASI" (OG_AYIRICI_ABB )From OG_AYIRICI Set To FIRST_NODE_ID Where intersects
'Add Column "OG_AYIRICI" (BNDEF )From OG_KABLO_BAGLANTISI Set To BNDEF Where intersects
'
'commit table OG_KABLO_NOKTASI
'
'Add Column "OG_KABLO_BAGLANTISI" (BNDEF )From OG_KABLO_NOKTASI Set To tm_no + "_" + val(gerilim) /1000  +"_" + scada_fider_no Where intersects
'Add Column "OG_AYIRICI" (BNDEF )From OG_KABLO_BAGLANTISI Set To tm_no + "_" + 400 /1000  +"_" + scada_fider_no Where intersects
''Add Column "OG_AYIRICI" (BNDEF )From OG_KABLO_BAGLANTISI Set To tm_no + "_" + 400 /1000  +"_" + scada_fider_no Where tm_no = tm_no 
'commit table OG_AYIRICI
'
'commit table OG_KABLO_NOKTASI
''buraya hatlar ile kesisen baglantý noktalarý feeder içerisine alýnacaktýr.
'Select Og_kablo_noktasi.abb_int_id from OG_KABLO_NOKTASI, ENERJI_NAKIL_HATTI where OG_KABLO_NOKTASI.Obj intersects ENERJI_NAKIL_HATTI.Obj into selFeeder
'select * from Og_kablo_noktasi where abb_int_id in(select col1 from selFeeder) into selResultFeeder
'select * from Og_ayirici where abb_int_id in(select ayirici_id from selResultFeeder) into selOGFeeder
'
'insert into FEEDER(obj,ID,NAME,SITE,FIRST_NODE_ID,FIRST_LINE_ID,SUB_ID) select obj,abb_int_id, BNDEF,tm_no, "SRC_" + sub_id + "_" + abb_int_id,  "LK_" + abb_int_id, sub_id from OG_KABLO_BAGLANTISI
'commit table FEEDER
'
'
'select * from feeder where first_node_id not in (select nid from node) into thereisnonidforfeeder
'Select * from line where abb_int_id in (select id from thereisnonidforfeeder) into selNonNode
'Add Column "thereisnonidforfeeder" (CNODEID )From selNonNode Set To NO_KEY_1 Where COL1 = COL1 
'
'Commit Table FEEDER Interactive
'Commit Table LINE Interactive
'
'select * from feeder where cnodeid<>0 into selResLine
'Commit Table selResLine As TargetPath + "\FIRST_POINT.TAB" TYPE NATIVE Charset "WindowsTurkish" Interactive
'Open Table TargetPath + "\FIRST_POINT.TAB" Interactive
'
'select node.nid,FIRST_POINT.first_node_id from node,FIRST_POINT where node.nfpos=FIRST_POINT.cnodeid into slK
'UPDATE SLk SET COL1=COL2
'COMMIT TABLE NODE


'/***********************OLMAZ ÝSE KALDIR**********************
if KolonMevcutMu("OG_AYIRICI","LINE_ID") =0 then
Alter Table "OG_AYIRICI" ( add LINE_ID Integer,FIRST_NODE_ID Integer  ) Interactive
end if

if KolonMevcutMu("OG_AYIRICI","BNDEF") =0 then
Alter Table "OG_AYIRICI" ( add BNDEF char(20) ) Interactive
end if

Add Column "OG_AYIRICI" (LINE_ID )From CONLINE Set To GROUP_ID Where intersects
Add Column "OG_AYIRICI" (FIRST_NODE_ID )From OG_AYIRICI Set To ABB_INT_ID Where intersects

commit table OG_AYIRICI

'/************************************************************

'og kýsmý
if KolonMevcutMu("OG_KABLO_BAGLANTISI","FIRST_LINE_ID") =0 then
Alter Table "OG_KABLO_BAGLANTISI" ( add FIRST_LINE_ID Integer) Interactive
end if

'Add Column "OG_KABLO_BAGLANTISI" (FIRST_LINE_ID )From OG_BARA Set To ABB_INT_ID Where intersects
'commit table OG_KABLO_BAGLANTISI
if KolonMevcutMu("OG_KABLO_BAGLANTISI","BNDEF") =0 then
Alter Table "OG_KABLO_BAGLANTISI" ( add BNDEF Char(20) ) Interactive
end if

Add Column "OG_KABLO_BAGLANTISI" (BNDEF )From OG_KABLO_NOKTASI Set To tm_no + "_" + val(gerilim) /1000  +"_" + scada_fider_no Where intersects
commit table OG_KABLO_BAGLANTISI

'Alter Table "OG_KABLO_BAGLANTISI" ( add SCADA_FIDER_NO Integer ) Interactive
'Add Column "OG_KABLO_BAGLANTISI" (SCADA_FIDER_NO )From OG_KABLO_NOKTASI Set To SCADA_FIDER_NO Where tm_no = tm_no 
Add Column "OG_KABLO_BAGLANTISI" (scada_fider_no )From OG_KABLO_NOKTASI Set To SCADA_FIDER_NO Where intersects
update OG_KABLO_BAGLANTISI set bndef= tm_no + "_" + val(gerilim) /1000  +"_" + scada_fider_no

'direk trafolarda og bara yok buraya tekrar bakýlacaktýr.

'Select og_kablo_noktasi.abb_int_id from oG_KABLO_NOKTASI, ENERJI_NAKIL_HATTI where OG_KABLO_NOKTASI.Obj intersects ENERJI_NAKIL_HATTI.Obj into selFeeder
Select og_kablo_noktasi.abb_int_id from oG_KABLO_NOKTASI, CONLINE where OG_KABLO_NOKTASI.Obj intersects CONLINE.Obj into selFeeder
select * from Og_kablo_noktasi where abb_int_id in(select col1 from selFeeder) into selResultFeeder
Commit Table selResultFeeder As TargetPath + "\ResultFeeder.TAB" TYPE NATIVE Charset "WindowsTurkish" Interactive
Open Table TargetPath + "\ResultFeeder.TAB" Interactive

Select OG_KABLO_BAGLANTISI.obj,OG_KABLO_BAGLANTISI.abb_int_id,OG_KABLO_BAGLANTISI.group_id,OG_KABLO_BAGLANTISI.bndef,OG_KABLO_BAGLANTISI.tm_no,OG_KABLO_BAGLANTISI.sub_id from OG_KABLO_BAGLANTISI,og_kablo_noktasi where OG_KABLO_BAGLANTISI.Obj  intersects OG_KABLO_NOKTASI.Obj into selXX

insert into FEEDER(obj,ID,NAME,SITE,FIRST_NODE_ID,FIRST_LINE_ID,SUB_ID) select obj,abb_int_id, BNDEF,tm_no, "SRC_" + sub_id + "_" + abb_int_id,  "LK_" + group_id, group_id from selXX
commit table FEEDER

select * from feeder where first_node_id not in (select nid from node) into thereisnonidforfeeder
Select * from line where abb_int_id in (select id from thereisnonidforfeeder) into selNonNode
Add Column "thereisnonidforfeeder" (CNODEID )From selNonNode Set To NO_KEY_1 Where COL1 = COL1 

Commit Table FEEDER Interactive
Commit Table LINE Interactive

select * from feeder where cnodeid<>0 into selResLine
Commit Table selResLine As TargetPath + "\FIRST_POINT.TAB" TYPE NATIVE Charset "WindowsTurkish" Interactive
Open Table TargetPath + "\FIRST_POINT.TAB" Interactive

select node.nid,FIRST_POINT.first_node_id from node,FIRST_POINT where node.nfpos=FIRST_POINT.cnodeid into slK
UPDATE SLk SET COL1=COL2
COMMIT TABLE NODE

End Sub

Sub ELine
'H_ENERJI_NAKIL_HATTI
'T_AG_KABLO_BAGLANTISI
'T_OG_KABLO_BAGLANTISI
'T_AG_BARA
'T_OG_BARA
'H_DAGITIM_HATTI(AG datasý var ise)
'K_SDK_BARA(AG datasý var ise)
'K_SDK_KABLO_BAGLANTISI(AG datasý var ise)


'node key kýsmý tekrar ele alýnmalýdýr. 0 olarak geçilmiþtir.

'T_OG_BARA
'[TM_NO]_[GERILIM]_BUSBAR[BARA_NO]

'T_OG_KABLO_BAGLANTISI
'[TM_NO]_[OBJECTID]_MV_CABLE_CONNECTION

'T_AG_BARA
'[TM_NO]_[GERILIM]TR-[TR_NO]_LVBUSBAR[BARA_NO]

'T_AG_KABLO_BAGLANTISI
'[TM_NO]_[OBJECTID]_LV_CABLE_CONNECTION

'K_SDK_BARA
'[SDK_NO]_[GERILIM]_SDK_BUSBAR[SDK_BARA_NO]

'K_SDK_KABLO_BAGLANTISI
'[SDK_NO]_[OBJECTID]_SDK_CABLE_CONNECTION

'H_DAGITIM_HATTI
'[TM1]_[TM2]_[GERILIM]_LV_LINE

'H_ENERJI_NAKIL_HATTI
'[TM1]_[TM2]_[GERILIM]_F[FIDER_NO]


'6645891_GND_LINE
'LD_8654080

'OG_BARA

select * from CONLINE where TTYPE=5 into selLineOB
fetch first from selLineOB

For iob = 1 To tableinfo(selLineOB,8)
	
	lineOB_tmNo = selLineOB.tm_no
	lineOB_baraNo = selLineOB.bara_no
	lineOB_gerilim 	= selLineOB.gerilim
	lineOB_abbIntId = selLineOB.abb_int_id
	lineOB_obj = selLineOB.obj
	lineOb_len = objectlen(lineOB_obj,"mm")
	lineOB_typeCode = selLineOB.typecode
	lineOB_subArea = selLineOB.sub_Area
	
lineOB_ScadaDef = lineOB_tmNo + "_" +  lineOB_gerilim /1000 + "kV_BUSBAR" +  lineOB_baraNo
insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) Values (lineOB_obj,lineOB_abbIntId,"BB_"+lineOB_abbIntId,lineOB_abbIntId,lineOB_ScadaDef,0,0,0,0,1230,lineOB_typeCode,12288,lineOB_subArea,1,lineOb_len,0,0,0,1)

fetch next from selLineOB
Next


'OG_KABLO_BAGLANTISI
select * from CONLINE where TTYPE=8 into selLineOKB
fetch first from selLineOKB

For iokb = 1 To tableinfo(selLineOKB,8)
	
	lineOKB_tmNo = selLineOKB.tm_no
	lineOKB_objectid = selLineOKB.objectid
	lineOKB_abbIntId = selLineOKB.abb_int_id
	lineOKB_obj = selLineOKB.obj
	lineOKB_len = objectlen(lineOKB_obj,"mm")
	lineOKB_typeCode = selLineOKB.typecode
	lineOKB_subArea = selLineOKB.sub_area
	
lineOKB_ScadaDef = lineOKB_tmNo + "_" + lineOKB_objectid +  "_MV_CABLE_CONNECTION"
insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) Values (lineOKB_obj,lineOKB_abbIntId,"LK_"+lineOKB_abbIntId,lineOKB_abbIntId,lineOKB_ScadaDef,0,0,0,0,1230,lineOKB_typeCode,12288,lineOKB_subArea,1,lineOKB_len,0,0,0,2)

fetch next from selLineOKB
Next


'AG_BARA
select * from CONLINE where TTYPE=6 into selLineAB
fetch first from selLineAB

For iab = 1 To tableinfo(selLineAB,8)
	
	lineAB_tmNo = selLineAB.tm_no
	lineAB_trNo = selLineAB.tr_no
	lineAB_baraNo = selLineAB.bara_no
	lineAB_gerilim 	= selLineAB.gerilim
	lineAB_abbIntId = selLineAB.abb_int_id
	lineAB_obj = selLineAB.obj
	lineAB_len = objectlen(lineAB_obj,"mm")
	lineAB_typeCode = selLineAB.typecode
	lineAB_subArea = selLineAB.sub_area
	
lineAB_ScadaDef = lineAB_tmNo + "_" +  lineAB_gerilim /1000 + "kV_TR-" + lineAB_trNo + "_LVBUSBAR"+  lineAB_baraNo
insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) Values (lineAB_obj,lineAB_abbIntId,"LK_"+lineAB_abbIntId,lineAB_abbIntId,lineAB_ScadaDef,0,0,0,0,1230,lineAB_typeCode,12288,lineAB_subArea,1,lineAB_len,0,0,0,3)

fetch next from selLineAB
Next

'AG_KABLO_BAGLANTISI
select * from CONLINE where TTYPE=9 into selLineAKB
fetch first from selLineAKB

For iakb = 1 To tableinfo(selLineAKB,8)
	
	lineAKB_tmNo	 = selLineAKB.tm_no
	lineAKB_objectid = selLineAKB.objectid
	lineAKB_abbIntId = selLineAKB.abb_int_id
	lineAKB_obj 	 = selLineAKB.obj
	lineAKB_len 	 = objectlen(lineAKB_obj,"mm")
	lineAKB_typeCode = selLineAKB.typecode
	lineAKB_subArea = selLineAKB.sub_Area
	
lineAKB_ScadaDef = lineAKB_tmNo + "_" + lineAKB_objectid +  "_LV_CABLE_CONNECTION"
insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) Values (lineAKB_obj,lineAKB_abbIntId,"LK_"+lineAKB_abbIntId,lineAKB_abbIntId,lineAKB_ScadaDef,0,0,0,0,1230,lineAKB_typeCode,12288,lineAKB_subArea,1,lineAKB_len,0,0,0,4)

fetch next from selLineAKB
Next

'K_SDK_BARA
select * from CONLINE where TTYPE=7 into selLineSB
fetch first from selLineSB

For isb = 1 To tableinfo(selLineSB,8)
	
	lineSB_sdkNo = selLineSB.sdk_no
	'lineSB_baraNo = selLineSB.sdk_bara_no
	lineSB_baraNo = selLineSB.bara_no
	lineSB_gerilim 	= selLineSB.gerilim
	lineSB_abbIntId = selLineSB.abb_int_id
	lineSB_obj = selLineSB.obj
	lineSB_len = objectlen(lineSB_obj,"mm")
	lineSB_typeCode = selLineSB.typecode
	lineSB_subArea = selLineSB.sub_area
	
lineSB_ScadaDef = lineSB_sdkNo + "_" +  lineSB_gerilim /1000 + "kV_SDK_BUSBAR" + lineSB_baraNo
insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) Values (lineSB_obj,lineSB_abbIntId,"BB_"+lineSB_abbIntId,lineSB_abbIntId,lineSB_ScadaDef,0,0,0,0,1230,lineSB_typeCode,12288,lineSB_subArea,1,lineSB_len,0,0,0,5)

fetch next from selLineSB
Next


'K_SDK_KABLO_BAGLANTISI
select * from CONLINE where TTYPE=10 into selLineSKB
fetch first from selLineSKB

For iskb = 1 To tableinfo(selLineSKB,8)
	
	lineSKB_sdkNo	 = selLineSKB.sdk_no
	lineSKB_objectid = selLineSKB.objectid
	lineSKB_abbIntId = selLineSKB.abb_int_id
	lineSKB_obj 	 = selLineSKB.obj
	lineSKB_len 	 = objectlen(lineSKB_obj,"mm")
	lineSKB_typeCode = selLineAKB.typecode
	lineSKB_subArea = selLineAKB.sub_area
	
lineSKB_ScadaDef = lineSKB_sdkNo + "_" + lineSKB_objectid +  "_SDK_CABLE_CONNECTION"
insert into Line(OBJ,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) Values (lineSKB_obj,lineSKB_abbIntId,"LK_"+lineSKB_abbIntId,lineSKB_abbIntId,lineSKB_ScadaDef,0,0,0,0,1230,2904,12288,lineSKB_subArea,1,lineSKB_len,0,0,0,6)

fetch next from selLineSKB
Next


'H_DAGITIM HATTI
select * from CONLINE where TTYPE=2 into selLineDH
fetch first from selLineDH

For iab = 1 To tableinfo(selLineDH,8)
	
	lineDH_tm1 = selLineDH.tm1
	lineDH_tm2 = selLineDH.tm2
	lineDH_gerilim 	= selLineDH.gerilim
	lineDH_abbIntId = selLineDH.abb_int_id
	lineDH_obj = selLineDH.obj
	lineDH_len = objectlen(lineDH_obj,"mm")
	lineDH_typeCode = selLineDH.typecode
	lineDH_subArea = selLineDH.sub_area
	lineDH_tip = selLineDH.tip
	
Do Case lineDH_tip
	case "HAVAI"
		lineDH_tip = 7 
	case else
		lineDH_tip = 8
end case
	
lineDH_ScadaDef = lineDH_tm1 + "_" + lineDH_tm2+ "_"  +  lineDH_gerilim /1000 + "kV" + "_LV_LINE"
insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) Values (lineDH_obj,lineDH_abbIntId,"LK_"+lineDH_abbIntId,lineDH_abbIntId,lineDH_ScadaDef,0,0,0,0,1230,lineDH_typeCode,12288,lineDH_subArea,1,lineDH_len,0,0,0,val(lineDH_tip))

fetch next from selLineDH
Next

'H_ENERJI_NAKIL_HATTI
'[TM1]_[TM2]_[GERILIM]_F[FIDER_NO]

select * from CONLINE where TTYPE=1 into selLineENH
fetch first from selLineENH

For ieh = 1 To tableinfo(selLineENH,8)
	
	lineENH_tm1 = selLineENH.tm1
	lineENH_tm2 = selLineENH.tm2
	lineENH_gerilim 	= selLineENH.gerilim
	lineENH_abbIntId = selLineENH.abb_int_id
	lineENH_obj = selLineENH.obj
	lineENH_len = objectlen(lineENH_obj,"mm")
	lineENH_typeCode = selLineENH.typecode
	lineENH_fiderNo = selLineENH.fiderno
	lineENH_subArea = selLineENH.sub_area

lineENH_ScadaDef = lineENH_tm1 + "_" + lineENH_tm2+ "_"  +  lineENH_gerilim /1000 + "kV_F" + lineENH_fiderNo
insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) Values (lineENH_obj,lineENH_abbIntId,"LK_"+lineENH_abbIntId,lineENH_abbIntId,lineENH_ScadaDef,0,0,0,0,1230,lineENH_typeCode,12288,lineENH_subArea,1,lineENH_len,0,0,0,9)

fetch next from selLineENH
Next

'select * from CONLINE where TTYPE=4 into selLineABH
'fetch first from selLineABH
'
'For ieh = 1 To tableinfo(selLineABH,8)
'	
'	lineABH_tmno = selLineABH.tm_no
'	lineABH_gerilim 	= val(selLineABH.gerilim)
'	lineABH_abbIntId = selLineABH.abb_int_id
'	lineABH_obj = selLineABH.obj
'	lineABH_len = objectlen(lineABH_obj,"mm")
'	lineABH_typeCode = selLineABH.typecode
'	'lineABH_fiderNo = selLineABH.fider_no
'	lineABH_subArea = selLineABH.sub_area
'
'lineABH_ScadaDef = lineABH_tmno + "_" + 400 /1000 + "kV_" + lineABH_abbIntId
'insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) Values (lineABH_obj,lineABH_abbIntId,"LK_"+lineABH_abbIntId,lineABH_abbIntId,lineABH_ScadaDef,0,0,0,0,1230,2613,12288,lineABH_subArea,1,lineABH_len,0,0,0,10)
'
'fetch next from selLineABH
'Next



'OG LOAD - suha - burada bir sýkýntý var buna bakýlacak - line.csv içerisinde LD ile baþlayan kýsmýlar neyi içeriyor - GND LINE neyi içeriyor.
'[OBJECTID]_END_MVLOAD

'select objectid, abb_int_id,obj,typecode,load,sub_area from OG_TECHIZAT where tip="OG LOAD" and load in(2,3) into selLineOL
'fetch first from selLineOL

'For iol = 0 To tableinfo(selLineOL,8)
	
'	lineOL_objectid = selLineOL.objectid
'	lineOL_abbIntId = selLineOL.abb_int_id
'	lineOL_obj      = selLineOL.obj	
'	lineOL_X        = centroidx(lineOL_obj)
'	lineOL_Y        = centroidy(lineOL_obj)
'	lineOL_typeCode = selLineOL.typecode
'	lineOL_load     = selLineOL.load
'	lineOL_subArea     = selLineOL.sub_Area
'	
'Do Case lineOL_load
'	case 2
'		lineOL_ScadaDef = lineOL_objectid + "_END_MVLOAD" 
'	case 3
'		lineOL_ScadaDef = lineOL_objectid + "_VERGE_MVLOAD" 
'end case

'insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID) Values (lineOL_obj,lineOL_abbIntId,"LD_"+lineOL_abbIntId,lineOL_abbIntId,"LD_"+lineOL_abbIntId,0,0,0,0,1230,lineOL_typeCode,12288,lineOL_subArea,1,10,0,0,0)

'fetch next from selLineOL
'Next

commit table LINE

insert into Line(obj,FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,	SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID,LINE_KIND) select obj,fpos,id,abb_int_id,name,no_key_1,no_key_2,pa_key_1,pa_key_2,phase_perm,line_type,bits,sub_area,state,length,annopos_1,annopos_2,asset_id,11 from gndline
commit table Line


Select * from cnode,node where CNODE.Obj intersects NODE.Obj into Selection
run menu command 311

insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,nfpos,nfpos,nfpos,nfpos,centroidx(obj),centroidy(obj),centroidx(obj),centroidy(obj),12288,1,41,202,1,7,nfpos,3,6,0 from selection
commit table node

Add Column "NODE" (SUB_AREA )From YALOVA_ILCE Set To Ilce_kod Where intersects
commit table node

'beg - end

Add Column "NODE" (NFPOS )From CNODE Set To NFPOS Where intersects
commit table node

set coordsys table LINE

select * from connectivity where terminal="B" into selB
Add Column "LINE" (NO_KEY_1 )From selB Set To NFPOS Where COL3 = COL1 
commit table LINE


select * from connectivity where terminal="E" into selE
Add Column "LINE" (NO_KEY_2 )From selE Set To NFPOS Where COL3 = COL1 
commit table line


select * from node where str$(obj) = "" into selUpp1
update selUpp1 set obj = createpoint(xn_1,yn_1)
commit table node

Add Column "LINE" (SUB_AREA )From YALOVA_ILCE Set To Ilce_kod Where intersects
commit table line


Select * from device,line where device.dfpos=line.no_key_1 into sel1
update sel1 set line_end=1
Select * from device,line where device.dfpos=line.no_key_2 into sel2
update sel2 set line_end=2
commit table device

'node larýn nname lerini güncellemek için.
Select NODE.NID,NODE.ABB_INT_ID,NODE.NNAME from node,line where NODE.nfpos =  LINE.no_key_2 and line.name like "%GND_LINE" into SLNODE
UPDATE SLNODE SET COL1=COL1 + "_GND_NODE",COL3=COL1 + "_GND_NODE"
commit table node

UPDATE LINE Set length= round(objectlen(obj,"cm"),1)
commit table LINE

End Sub

Sub ELoad

commit table load

Add Column "OG_TECHIZAT" (SUB_AREA )From yalova_ilce Set To Ilce_kod Where intersects
Add Column "AG_TECHIZAT" (SUB_AREA )From yalova_ilce Set To Ilce_kod Where intersects
commit table OG_TECHIZAT
commit table AG_TECHIZAT

select objectid, abb_int_id,obj,typecode,load,gerilim,hucre_no,nfpos,sub_area,tm_no,sub_id,anma_akimi from OG_TECHIZAT where tip="OG LOAD" and str$(obj)="Point" and abb_int_id<>0 and load=1 into selLineOL
fetch first from selLineOL

For iol = 1 To tableinfo(selLineOL,8)
	
	lineOL_objectid = selLineOL.objectid
	lineOL_abbIntId = selLineOL.abb_int_id
	lineOL_obj      = selLineOL.obj	
	lineOL_X        = val(left$(str$(format$(centroidx(lineOL_obj),"##.###")) ,instr(1,str$(centroidx(lineOL_obj)) , "." )-1) + mid$(str$(format$(centroidx(lineOL_obj),"##.###")) ,instr(1,str$(centroidx(lineOL_obj)), "." )+1,4))
	lineOL_Y        = val(left$(str$(format$(centroidy(lineOL_obj),"##.###")) ,instr(1,str$(centroidy(lineOL_obj)) , "." )-1) + mid$(str$(format$(centroidy(lineOL_obj),"##.###")) ,instr(1,str$(centroidy(lineOL_obj)), "." )+1,4))
	lineOL_typeCode = selLineOL.typecode
	lineOL_load     = selLineOL.load
	lineOL_nfPos     = selLineOL.NFPOS
	lineOL_gerilim  = val(selLineOL.gerilim)
	lineOL_hucreNo = selLineOL.hucre_no
	lineOL_subArea = selLineOL.sub_area
	lineOL_subId = selLineOL.abb_int_id
	lineOL_tmNo = selLineOL.tm_no
	lineOL_rating1 = sqr(3) *(lineOL_gerilim *  val(selLineOL.anma_akimi))/100
	
Do Case lineOL_load
	case 1
		lineOL_ScadaDef =lineOL_tmNo + "_" + lineOL_gerilim /1000 + "_H"+  lineOL_hucreNo + "_MVLOAD" 
	case 2
		lineOL_ScadaDef = lineOL_objectid + "_END_MVLOAD" 
	case 3
		lineOL_ScadaDef = lineOL_objectid + "_VERGE_MVLOAD" 
	case else
		lineOL_ScadaDef =lineOL_tmNo + "_" + lineOL_gerilim /1000 + "_H"+  lineOL_hucreNo + "_MVLOAD"
end case

insert into LOAD(obj,LOID,LONAME,ABB_INT_ID,LOFPOS,NO_KEY,SG_KEY,BITS,LOTYPE,RATING_1,RATING_2,RATING_3,RATING_4,BILLED_1,BILLED_2,BILLED_3,BILLED_4,PFACT_1,PFACT_2,PFACT_3,PFACT_4,PHASE,STATUS,STATE,DESCRIPTIVE_LOC,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SUB_AREA,COUNTPRIORITY,CUSTNO_1,sub_id) Values (lineOL_obj,"LOAD_" + lineOL_objectid,lineOL_ScadaDef,lineOL_abbIntId,lineOL_abbIntId,lineOL_nfpos,186,64,0,lineOL_rating1,lineOL_rating1/3,lineOL_rating1/3,lineOL_rating1/3,0,0,0,0,1,1,1,1,111,111,1,0,3,6,0,0,lineOL_subArea,0,0,lineOL_subId)
fetch next from selLineOL
next 
commit table LOAD



'select objectid, abb_int_id,obj,typecode,load,montaj_yeri,gerilim,sub_area,tm_no,sub_id from OG_TECHIZAT where tip="SIGORTA" and str$(obj)="Point" into selLineSig
'fetch first from selLineSig
'For iol = 1 To tableinfo(selLineSig,8)
'	
'	lineOL_objectid = selLineSig.objectid
'	lineOL_abbIntId = selLineSig.abb_int_id
'	lineOL_obj      = selLineSig.obj	
'	lineOL_X        = val(left$(str$(format$(centroidx(lineOL_obj),"##.###")) ,instr(1,str$(centroidx(lineOL_obj)) , "." )-1) + mid$(str$(format$(centroidx(lineOL_obj),"##.###")) ,instr(1,str$(centroidx(lineOL_obj)), "." )+1,4))
'	lineOL_Y        = val(left$(str$(format$(centroidy(lineOL_obj),"##.###")) ,instr(1,str$(centroidy(lineOL_obj)) , "." )-1) + mid$(str$(format$(centroidy(lineOL_obj),"##.###")) ,instr(1,str$(centroidy(lineOL_obj)), "." )+1,4))
'	lineOL_typeCode = selLineSig.typecode
'	lineOL_gerilim  = val(selLineOL.gerilim)
'	lineOL_hucreNo = selLineOL.hucre_no
'	lineOL_montajYeri=selLineSig.montaj_yeri
'	lineOL_subArea = selLineOL.sub_area
'	lineOL_subId = selLineOL.sub_id
'	lineOL_tmNo = selLineOL.tm_no
'	lineOL_rating1 = sqr(3) *(lineOL_gerilim *  val(selLineOL.anma_akimi))/100
'	
'if lineOL_montajYeri =  "TEIAS" then
'	'[TM_NO]_[GERILIM][HUCRE_ONEKI][HUCRE_NO]_FUSE_SW
'		lineOL_ScadaDef =lineOL_tmNo + "_" + lineOL_gerilim /1000 + "_H"+  lineOL_hucreNo + "_FUSE_SW"	
'else
'		lineOL_ScadaDef =lineOL_tmNo + "_" + lineOL_gerilim /1000 + "_H"+  lineOL_hucreNo + "_FUSE_SW"
'end if

'insert into LOAD(obj,LOID,LONAME,ABB_INT_ID,LOFPOS,NO_KEY,SG_KEY,BITS,LOTYPE,RATING_1,RATING_2,RATING_3,RATING_4,BILLED_1,BILLED_2,BILLED_3,BILLED_4,PFACT_1,PFACT_2,PFACT_3,PFACT_4,PHASE,STATUS,STATE,DESCRIPTIVE_LOC,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SUB_AREA,COUNTPRIORITY,CUSTNO_1,sub_id) Values (lineOL_obj,"LOAD_" + lineOL_objectid,lineOL_ScadaDef,lineOL_abbIntId,lineOL_abbIntId,0,186,64,0,lineOL_rating1,lineOL_rating1/3,lineOL_rating1/3,lineOL_rating1/3,0,0,0,0,1,1,1,1,111,111,1,0,3,6,0,0,lineOL_subArea,0,0,lineOL_subId)

'fetch next from selLineSig
'Next


if KolonMevcutMu("ag_kablo_noktasi","CUSTNO_1") =0 then
Alter Table "ag_kablo_noktasi" ( add CUSTNO_1 Integer ) Interactive
end if
commit table sdk_kablo_noktasi
if KolonMevcutMu("sdk_kablo_noktasi","CUSTNO_1") =0 then
Alter Table "sdk_kablo_noktasi" ( add CUSTNO_1 Integer ) Interactive
end if 

Select BAGLANTI_NOKTASI_ABB_INT_ID,SUM(ABONE_SAYISI) from KOFRA_RESULT where BAGLANTI_NOKTASI_TIPI = "AG" group by BAGLANTI_NOKTASI_ABB_INT_ID into SelAGL
Add Column "ag_kablo_noktasi" (CUSTNO_1 )From SelAGL Set To col2 Where abb_int_id =  BAGLANTI_NOKTASI_ABB_INT_ID
commit table ag_kablo_noktasi

select * from ag_kablo_noktasi where abb_int_id in(select baglanti_noktasi_abb_int_id from selAGL) into selAGLR
insert into LOAD(obj,LOID,LONAME,ABB_INT_ID,LOFPOS,NO_KEY,SG_KEY,BITS,LOTYPE,RATING_1,RATING_2,RATING_3,RATING_4,BILLED_1,BILLED_2,BILLED_3,BILLED_4,PFACT_1,PFACT_2,PFACT_3,PFACT_4,PHASE,STATUS,STATE,DESCRIPTIVE_LOC,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SUB_AREA,COUNTPRIORITY,CUSTNO_1,sub_id,ayirici_id) select obj, "LOAD_" + ayirici_id, "0", abb_int_id,0, 0,186,64,0,1109,370,370,370,0,0,0,0,1,1,1,1,111,111,1,"",3,6,0,0,sub_area,0,CUSTNO_1,abb_int_id,ayirici_id from selAGLR


Select BAGLANTI_NOKTASI_ABB_INT_ID,SUM(ABONE_SAYISI) from KOFRA_RESULT where BAGLANTI_NOKTASI_TIPI = "SDK" group by BAGLANTI_NOKTASI_ABB_INT_ID into SelSDKL
Add Column "sdk_kablo_noktasi" (CUSTNO_1 )From SelSDKL Set To col2 Where abb_int_id =  BAGLANTI_NOKTASI_ABB_INT_ID
commit table sdk_kablo_noktasi

select * from sdk_kablo_noktasi where abb_int_id in(select baglanti_noktasi_abb_int_id from SelSDKL) into selSDKLR
insert into LOAD(obj,LOID,LONAME,ABB_INT_ID,LOFPOS,NO_KEY,SG_KEY,BITS,LOTYPE,RATING_1,RATING_2,RATING_3,RATING_4,BILLED_1,BILLED_2,BILLED_3,BILLED_4,PFACT_1,PFACT_2,PFACT_3,PFACT_4,PHASE,STATUS,STATE,DESCRIPTIVE_LOC,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SUB_AREA,COUNTPRIORITY,CUSTNO_1,sub_id,ayirici_id) select obj, "LOAD_" + ayirici_id, "0", abb_int_id,0, 0,186,64,0,1109,370,370,370,0,0,0,0,1,1,1,1,111,111,1,"",3,6,0,0,sub_area,0,CUSTNO_1,abb_int_id,ayirici_id from selSDKLR


'her cýkýsta load olmalýdýr - hatlar silindikten sonra load olmayan kýsýmlara load oluþturulacaktýr.
select * from device where (aa=1 and aal=1) and (load_x<>0 and load_y<>0) and abb_int_id not in( select ayirici_id from load) into selNoLoad 
select * from selNoLoad group by load_x,load_y into selXX
insert into LOAD(obj,LOID,LONAME,ABB_INT_ID,LOFPOS,NO_KEY,SG_KEY,BITS,LOTYPE,RATING_1,RATING_2,RATING_3,RATING_4,BILLED_1,BILLED_2,BILLED_3,BILLED_4,PFACT_1,PFACT_2,PFACT_3,PFACT_4,PHASE,STATUS,STATE,DESCRIPTIVE_LOC,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SUB_AREA,COUNTPRIORITY,CUSTNO_1,sub_id) select createpoint(LOAD_X/1000,LOAD_Y/1000), "LOAD_" + ABB_INT_ID, Dname, abb_int_id,abb_int_id, dfpos,186,64,0,1109,370,370,370,0,0,0,0,1,1,1,1,111,111,1,"",3,6,0,0,sub_area,0,0,abb_int_id from selXX
commit table load

update LOAD set obj= buffer(obj,32,1,"cm")
commit table LOAD

Select * from load where LONAME="0" into selLVL
Add Column "selLVL" (LONAME)From DEVICE Set To DNAME Where AYIRICI_ID = ABB_INT_ID
commit table load

Select * from load where lofpos=0 into selLPOS
Add Column "selLPOS" (LOFPOS)From DEVICE Set To DFPOS Where AYIRICI_ID = ABB_INT_ID
commit table load

Add Column "LOAD" (no_key )From CNODE Set To NFPOS Where intersects
commit table load

'update load set RATING_1 = sqr(3)*(gerilim*akim)
'update load set RATING_2 = RATING_1/3
'update load set RATING_3 = RATING_1/3
'update load set RATING_4 = RATING_1/3

'commit table LOAD

Select load.abb_int_id from load,line where load.obj intersects line.obj and line_kind=8 into seldline
Select * from load where abb_int_id in (select col1 from seldline) into seldeleteload
delete from seldeleteload
commit table load

'olmaz ise burayý aç
update NODE set XN_1= centroidx(obj) * 1000
update NODE set YN_1= centroidy(obj) * 1000
update NODE set XN_2= centroidx(obj) * 1000
update NODE set YN_2= centroidy(obj) * 1000
commit table load

Select LOAD.LONAME,node.nid from load,node where load.obj intersects node.obj and load.loname like "%mvload%" into sl2
Update sl2 set col2=col1
Commit table node

'mvload larýn vlevel larý 7 olarak gönderildiði gözlemlendi sorun olmamasý adýna 22 olarak güncellendi
Select vlevel from node where nid like "%_MVLOAD" into selMvLoad
Update selMvLoad set col1=22
Commit table node

End Sub

Sub EMPoint
'LINE ON, NO_KEY kolonlarý doldurulmalýdýr. þu anda 0 olarak geçilmiþtir, tekrar kontrol edilecektir.

'714671_34,5kV_H01_MPOINT
select * from analizor where gerilim like "34%" into selM34
update selM34 set gerilim = 34500

select * from analizor where gerilim like "0%" into selM4
update selM4 set gerilim = 400
commit table mpoint

insert into MPoint(MPFPOS,MPID,ABB_INT_ID,MPNAME,XD_1,YD_1,XD_2,YD_2,STATE,SG_KEY,ANNOPOS_1,ANNOPOS_2,LINE_ON,NO_KEY,LA_EXCLUDED,LA_MEAS_USED) select abb_int_id, "MP_" + abb_int_id, abb_int_id, tm_no + "_" +val(gerilim)/1000 + "kV_" + hucre_no + "_MPOINT", val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)),val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)),1,10,3,6,0,0,1,0 from analizor
commit table MPoint

update mpoint set obj= buffer(obj,32,6,"cm")
commit table mpoint
Add Column "MPOINT" (LINE_ON )From LINE Set To FPOS Where intersects
Add Column "MPOINT" (NO_KEY )From NODE Set To NFPOS Where intersects
commit table MPOINT

update MPOINT set xd_1= centroidx(obj) * 1000
update MPOINT set yd_1= centroidy(obj) * 1000
update MPOINT set xd_2= centroidx(obj) * 1000
update MPOINT set yd_2= centroidy(obj) * 1000

commit table MPOINT

select * from MPOINT where line_on=0 into selm
delete from selm
commit table MPOINT

End Sub

Sub ENode
	
'CON TYPE ogrenýlecek
'Defines the connection code for the load: 1 = Wye
'connected load, 2 = Delta connected load. [*, BLF, UBLF]

'voltage level güncelllenmesi gerekiyor. - insert den sonra
'sub id - area kavramlarý her tarafta ayný olmasý lazým - insert den sonra güncellenmesi gerekiyor.

'insert device - tüm katmanlar sýra ile eklenmmelidir.
'point tipli katmanlar node olarak eklenecektir.

'update node set obj =buffer(obj, 32, 0.5, "cm")

select * from device where abb_int_id=0 into seldeviceABB 
delete from seldeviceABB
commit table seldeviceABB

select * from device where sg_key1=41 and aal=0   into selSG
select * from device where sg_key1=55 and aal=0  into selSGFuse
select * from device where sg_key1=15 and aal=0  into selSGS
select * from device where sg_key1=16 and aal=0 into selSGSE
select * from device where sg_key1=1  and aal=0  into selSGTR
select * from device where sg_key1=41 and  aal=1  into selAAX

insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,dfpos,DID,ABB_INT_ID,DNAME,XD_1,YD_1,XD_2,YD_2,12288,1,sg_key1,sub_area,1,vlevel,sub_id,3,6,0 from selSG
insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,dfpos,DID,ABB_INT_ID,DNAME,XD_1,YD_1,XD_2,YD_2,12288,1,sg_key1,sub_area,1,vlevel,sub_id,3,6,0 from selSGFuse
insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,dfpos,DID,ABB_INT_ID,DNAME,XD_1,YD_1,XD_2,YD_2,12288,1,sg_key1,sub_area,1,vlevel,sub_id,3,6,0 from selSGS
insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,dfpos,DID,ABB_INT_ID,DNAME,XD_1,YD_1,XD_2,YD_2,12288,1,sg_key1,sub_area,1,vlevel,sub_id,3,6,0 from selSGSE
insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,dfpos,DID,ABB_INT_ID,DNAME,XD_1,YD_1,XD_2,YD_2,12288,1,sg_key1,sub_area,1,vlevel,sub_id,3,6,0 from selSGTR
insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,dfpos,DID,ABB_INT_ID,DNAME,XD_1,YD_1,XD_2,YD_2,12288,1,sg_key1,sub_area,1,vlevel,sub_id,3,6,0 from selAAX

commit table NODE

'if KolonMevcutMu("AG_KABLO_NOKTASI","NFPOS") =0 then
Alter Table "AG_KABLO_NOKTASI" ( add NFPOS Integer ) Interactive
'end if

Add Column "AG_KABLO_NOKTASI" (NFPOS )From CNODE Set To NFPOS Where intersects
commit table AG_KABLO_NOKTASI

insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj, NFPOS,"SRC_"+ abb_int_id + "_" + objectid, ABB_INT_ID, "BN_LV_"+ objectid,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)) ,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)),12288,1,41,sub_area,1,7,abb_int_id,3,6,0 from AG_KABLO_NOKTASI
commit table NODE

'Alter Table "OG_KABLO_NOKTASI" ( add NFPOS Integer ) Interactive
Add Column "OG_KABLO_NOKTASI" (NFPOS )From CNODE Set To NFPOS Where intersects
commit table OG_KABLO_NOKTASI

insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj, NFPOS,"SRC_"+ abb_int_id + "_" + objectid, ABB_INT_ID, "BN_MV_"+ objectid,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)) ,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)),12288,1,41,sub_area,1,22,abb_int_id,3,6,0 from OG_KABLO_NOKTASI
commit table NODE

'Alter Table "SDK_KABLO_NOKTASI" ( add NFPOS Integer ) Interactive
Add Column "SDK_KABLO_NOKTASI" (NFPOS )From CNODE Set To NFPOS Where intersects

insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj, NFPOS,"SRC_"+ abb_int_id + "_" + objectid, ABB_INT_ID, "BN_SDK_"+ objectid,val(left$(str$(centroidx(obj)) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(centroidx(obj)) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(centroidy(obj)) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(centroidy(obj)) ,instr(1,str$(centroidy(obj)), "." )+1,4)) ,val(left$(str$(centroidx(obj)) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(centroidx(obj)) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(centroidy(obj)) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(centroidy(obj)) ,instr(1,str$(centroidy(obj)), "." )+1,4)),12288,1,41,sub_area,1,7,abb_int_id,3,6,0 from SDK_KABLO_NOKTASI
commit table NODE

'Alter Table "OG_KAYNAK" ( add NFPOS Integer ) Interactive
Add Column "OG_KAYNAK" (NFPOS )From CNODE Set To NFPOS Where intersects

'[TM_NO]_[GERILIM]_SOURCE-[KAYNAK_NO]
select * from OG_KAYNAK where gerilim like "154%" into selResSource
insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj, NFPOS,"SRC_"+ abb_int_id + "_" + abb_int_id, ABB_INT_ID, tm_no + "_" + (154000/1000) + "kV_SOURCE-"+ kaynak_no,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)) ,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)),12288,1,41,sub_area,1,25,abb_int_id,3,6,0 from selResSource
commit table NODE


'Alter Table "LOAD" ( add NFPOS Integer ) Interactive
Add Column "LOAD" (NO_KEY )From CNODE Set To NFPOS Where intersects
commit table LOAD
select * from LOAD where str$(obj) <> "Point" into slDelete
delete from slDelete
commit table LOAD
PACK TABLE LOAD

insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,NO_KEY,"SP_" + ABB_INT_ID,ABB_INT_ID,LONAME,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)) ,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)),12288,1,64,sub_area,1,22,abb_int_id,0,0,0 from LOAD
commit table node

Add Column "NODE" (SUB_AREA )From YALOVA_ILCE Set To Ilce_kod Where intersects
commit table node

'burasý baþka problemlere yol açabilir. Exportlar alýnsýn sonra problem olmadýgýna kanaat getirilsin ondan sonra duruma göre kaldýrýlmasý ve durmasýna karar verilsin.
'select * from feeder where first_node_id not in (select nid from node) into thereisnonidforfeeder
'insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,id,first_node_id,id,NAME,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)) ,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)),12288,1,41,202,1,22,234,3,6,0 from thereisnonidforfeeder
'commit table NODE

update NODE set XN_1= centroidx(obj) * 1000
update NODE set YN_1= centroidy(obj) * 1000
update NODE set XN_2= centroidx(obj) * 1000
update NODE set YN_2= centroidy(obj) * 1000

commit table NODE

'insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) select obj,abb_int_id,MPID, ABB_INT_ID, MPNAME,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)) ,val(left$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)) , "." )-1) + mid$(str$(format$(centroidx(obj),"##.###")) ,instr(1,str$(centroidx(obj)), "." )+1,4)),val(left$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)) , "." )-1) + mid$(str$(format$(centroidy(obj),"##.###")) ,instr(1,str$(centroidy(obj)), "." )+1,4)),12288,1,41,202,1,7,500,3,6,0 from mpoint
'commit table node

select max(nfpos) from node into selMax
maxNfpos = selMax.col1
select * from node where nfpos=0 into selEmpty
update selEmpty  set nfpos = maxNfpos + rowid
commit table node

update node set SG_KEY_1=41
commit table node

End Sub

Sub EPath2
	'set coordsys table LINE
	'select * from LINE WHERE OBJ and str$(obj) = "polyline" INTO SELLINE 
	
	set coordsys table CONLINE
	select * from CONLINE WHERE OBJ and str$(obj) = "polyline" INTO SELLINE 
	
	Fetch first from SELLINE
	objectcount = tableinfo(SELLINE ,8)
	
	for i=1 to tableinfo(SELLINE ,8)	
		if LINE.rowid mod 1000 = 0 then
			print LINE.rowid 
		End If
		
		cnodeNfpos = cnodeNfpos + 1		
		HatObj 		= SELLINE.obj
		_lineabbId 	= SELLINE.abb_int_id
		'_lineabbId 	= SELLINE.group_id
		
		'_linetype = LINE.ttype
		
		Do Case ObjectInfo(HatObj, OBJ_INFO_TYPE)
			Case OBJ_TYPE_LINE
				p1 = createpoint(objectgeography(HatObj,1),objectgeography(HatObj,2))
				p2 = createpoint(objectgeography(HatObj,3),objectgeography(HatObj,4))
		
			'Select * from path where obj intersects p1 into selPathConnLine noselect
			'if tableinfo(selPathConnLine,8) = 0 then
				'insert into PATH(OBJ,PAFPOS,NEXTP,XDIFF,YDIFF,SUB_AREA,LINE_ID) values(p1,cnodeNfpos,0, val(left$(str$(format$(centroidx(p1),"##.###")) ,instr(1,str$(centroidx(p1)) , "." )-1) + mid$(str$(format$(centroidx(p1),"##.###")) ,instr(1,str$(centroidx(p1)), "." )+1,4)),val(left$(str$(format$(centroidy(p1),"##.###")) ,instr(1,str$(centroidy(p1)) , "." )-1) + mid$(str$(format$(centroidy(p1),"##.###")) ,instr(1,str$(centroidy(p1)), "." )+1,4)),201,_lineabbId)
				'cnodeNfpos = cnodeNfpos + 1
				'insert into PATH(OBJ,PAFPOS,NEXTP,XDIFF,YDIFF,SUB_AREA,LINE_ID) values(p2,cnodeNfpos,0, val(left$(str$(format$(centroidx(p2),"##.###")) ,instr(1,str$(centroidx(p2)) , "." )-1) + mid$(str$(format$(centroidx(p2),"##.###")) ,instr(1,str$(centroidx(p2)), "." )+1,4)),val(left$(str$(format$(centroidy(p2),"##.###")) ,instr(1,str$(centroidy(p2)) , "." )-1) + mid$(str$(format$(centroidy(p2),"##.###")) ,instr(1,str$(centroidy(p2)), "." )+1,4)),201,_lineabbId)
			'else
				'xxx= selPathConnLine.pafpos
					'insert into PATH(OBJ,PAFPOS,NEXTP,XDIFF,YDIFF,SUB_AREA,LINE_ID) values(p1,xxx,0, val(left$(str$(format$(centroidx(p1),"##.###")) ,instr(1,str$(centroidx(p1)) , "." )-1) + mid$(str$(format$(centroidx(p1),"##.###")) ,instr(1,str$(centroidx(p1)), "." )+1,4)),val(left$(str$(format$(centroidy(p1),"##.###")) ,instr(1,str$(centroidy(p1)) , "." )-1) + mid$(str$(format$(centroidy(p1),"##.###")) ,instr(1,str$(centroidy(p1)), "." )+1,4)),201,_lineabbId)					
			'end if
			Case OBJ_TYPE_PLINE
				if ObjectInfo(HatObj, OBJ_INFO_NPolygons) > 1 then
					print "Desteklenmeyen veri tipi(Combine Object) bulundu. GROUP_ID : " + CONLINE.GROUP_ID
					onerror goto hataObj
				end if
				nodeNum = ObjectInfo(HatObj, OBJ_INFO_NPOLYGONS+1) 
				
					For j = 2 To nodeNum
					p1 = createpoint(objectnodex(HatObj,1,j),objectnodey(HatObj,1,j))
					'Select * from path where obj intersects p1 into selPathConnPLine noselect
						'if tableinfo(selPathConnPLine,8) = 0 then
							'insert into PATH(OBJ,PAFPOS,NEXTP,XDIFF,YDIFF,SUB_AREA,LINE_ID) values(p1,cnodeNfpos,0, val(left$(str$(format$(centroidx(p1),"##.###")) ,instr(1,str$(centroidx(p1)) , "." )-1) + mid$(str$(format$(centroidx(p1),"##.###")) ,instr(1,str$(centroidx(p1)), "." )+1,4)),val(left$(str$(format$(centroidy(p1),"##.###")) ,instr(1,str$(centroidy(p1)) , "." )-1) + mid$(str$(format$(centroidy(p1),"##.###")) ,instr(1,str$(centroidy(p1)), "." )+1,4)),201,_lineabbId)					
						'else 
						'xxx= selPathConnPLine.pafpos
						sifirla = cnodeNfpos
						if j = nodeNum then
							sifirla=0 
						End If						
							insert into PATH(OBJ,PAFPOS,NEXTP,XDIFF,YDIFF,SUB_AREA,LINE_ID) values(p1,cnodeNfpos,sifirla, val(left$(str$(format$(centroidx(p1),"##.###")) ,instr(1,str$(centroidx(p1)) , "." )-1) + mid$(str$(format$(centroidx(p1),"##.###")) ,instr(1,str$(centroidx(p1)), "." )+1,4)),val(left$(str$(format$(centroidy(p1),"##.###")) ,instr(1,str$(centroidy(p1)) , "." )-1) + mid$(str$(format$(centroidy(p1),"##.###")) ,instr(1,str$(centroidy(p1)), "." )+1,4)),201,_lineabbId)					
						cnodeNfpos = cnodeNfpos + 1	
						'end if
					Next					
			Case Else
				print "Data içerisinde topolojiye uygun olmayan veriler var. Combine obje olmasý muhtemeldir."
					onerror goto hataObj
		End Case
		
	hataObj : Fetch next from SELLINE
	cnodeNfpos = cnodeNfpos+1
	
	Next	
	
	COMMIT TABLE LINE
	
	select LINE_ID FROM PATH GROUP BY LINE_ID order by line_id into selRexx
	fetch first from selRexx
	for	j =0 to tableinfo(selRexx,8)
		_linePathId = selRexx.line_id
		'print _linePathId
		cmd_string = "Select * from PATH where LINE_ID=" + _linePathId + " order by pafpos into Selx"
		
		Run Command cmd_string
		'print cmd_string
		fetch first from Selx
		
		For i = 0 To tableinfo(Selx,8)
			_id = Selx.pafpos
				fetch next from Selx
		
		_nextp = Selx.pafpos
		select * from Selx where pafpos = _id into sup
			update sup set nextp = _nextp 
		 
				fetch prev from selx
				fetch next from selx
		Next	
	fetch next from selRexx
	Next
	
Add Column "LINE" (PA_KEY_1 )From PATH Set To PAFPOS Where ABB_INT_ID = LINE_ID 
Add Column "PATH" (SUB_AREA )From yalova_ilce Set To Ilce_kod Where intersects
commit table line
commit table path

update PATH set XDIFF= centroidx(obj) * 1000
update PATH set YDIFF= centroidy(obj) * 1000

commit table PATH

select * from line where str$(obj) = "polyline" into spp
update spp set pa_key_1 = pa_key_1 -1 
commit table spp

select * from LINE WHERE OBJ and str$(obj) = "Line" INTO SELde
update selde set pa_key_1 = 0
commit table LINE

End Sub

Sub ERegion

insert into REGION(ID,NAME) Select ilce_kod,ilce from yalova_ilce
commit table REGION

End Sub

Sub ESite
	
select * from LGC_MERKEZ where abb_int_id <> 0 into selSite
fetch first from selSite
For is = 1 To tableinfo(selSite,8)
	site_tmNo = selSite.tm_no
	site_tmAdi = selsite.tm_adi
	site_abbIntId = selSite.abb_int_id
	site_type = selSite.tip
		
	Do Case site_type
		case "TRP"
			vLevel_site = 7
		case "DAGITIM TRAFO MERKEZI","KOK"
			vLevel_site = 22
		case "TEIAS INDIRICI"
			vLevel_site = 25
		case else
			vLevel_site = 22
	end case	
	
	site_obj = selSite.obj	
	'insert into elektrik_lgc_merkez (obj) values(createpoint(centroidx(c),(centroidy(c)-0.1)))
	'node 'a 10 cm düþüðünü verelim
	newX = centroidx(site_obj) * 1000
	newY = centroidy(site_obj) * 1000
	nodeNewY = (centroidy(site_obj) - 0.1) * 1000
	
	site_X = ObjectGeography(selSite.obj, 1)*1000  'MinX
	site_Y = ObjectGeography(selSite.obj, 4)*1000  'MaxY
	site_typeCode = selSite.typecode
	siteIl=selSite.il_adi
	siteIlce=selSite.ilce_adi
	siteMahalle=selSite.mahalle_adi
	'siteABB = selSite.abb_int_id
	site_obj= createpoint(site_X/1000, site_Y/1000)

SITE_W=Round(ObjectGeography(selSite.obj, 3)*1000-ObjectGeography(selSite.obj, 1)*1000,1)
SITE_H=Round(ObjectGeography(selSite.obj, 4)*1000-ObjectGeography(selSite.obj, 2)*1000,1)
insert into SITE(obj,SIID,SINAME,ABB_INT_ID,SIFPOS,NO_KEY,SG_KEY,XSITE,YSITE,SITEW,SITEH,SSITE_ANG,GXSITE,GYSITE,GSITEW,GSITEH,GSITE_ANG,ADDRESS,STATE,ANNOPOS_1,ANNOPOS_2) values(site_obj,site_tmNo,site_tmAdi,site_abbIntId,site_abbIntId,site_abbIntId,999,newX,newY,SITE_W,SITE_H,0, newX,newY,SITE_W,SITE_H,0, siteIl + "-" +siteIlce + "-" + siteMahalle,1,3,6)
insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) values(site_obj,site_abbIntId,"TR_" +site_abbIntId,site_abbIntId,site_tmNo + "_" +site_tmAdi,newX,nodeNewY,newX,nodeNewY,12288,1,41,202,1,vLevel_site,site_abbIntId,3,6,0)
fetch next from selSite
Next
commit table Site

select * from LGC_SDK where abb_int_id <> 0 and obj into selSiteQ
fetch first from selSiteQ
For is = 1 To tableinfo(selSiteQ,8)
site_tmNo = selSiteQ.tm_no
site_abbIntId = selSiteQ.abb_int_id
site_obj = selSiteQ.obj	

	newX = centroidx(site_obj) * 1000
	newY = centroidy(site_obj) * 1000
	nodeNewY = (centroidy(site_obj) - 0.1) * 1000
	
site_X = ObjectGeography(selSiteQ.obj, 1)*1000  'MinX
site_Y = ObjectGeography(selSiteQ.obj, 4)*1000  'MaxY
site_typeCode = selSiteQ.typecode
siteIl=selSiteQ.il_adi
siteIlce=selSiteQ.ilce_adi
siteMahalle=selSiteQ.mahalle_adi
site_obj= createpoint(site_X/1000, site_Y/1000)

SITE_W=Round(ObjectGeography(selSiteQ.obj, 3)*1000-ObjectGeography(selSiteQ.obj, 1)*1000,1)
SITE_H=Round(ObjectGeography(selSiteQ.obj, 4)*1000-ObjectGeography(selSiteQ.obj, 2)*1000,1)
insert into SITE(obj,SIID,SINAME,ABB_INT_ID,SIFPOS,NO_KEY,SG_KEY,XSITE,YSITE,SITEW,SITEH,SSITE_ANG,GXSITE,GYSITE,GSITEW,GSITEH,GSITE_ANG,ADDRESS,STATE,ANNOPOS_1,ANNOPOS_2) values(site_obj,site_abbIntId,site_abbIntId,site_abbIntId,site_abbIntId,site_abbIntId,999,newX,newY,SITE_W,SITE_H,0, newX,newY,SITE_W,SITE_H,0, siteIl + "-" +siteIlce + "-" + siteMahalle,1,6,12)
insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) values(site_obj,site_abbIntId,site_abbIntId,site_abbIntId,site_tmAdi,newX,nodeNewY,newX,nodeNewY,12288,1,41,202,1,7,site_abbIntId,6,12,0)
fetch next from selSiteQ
Next
commit table Site

	
Add Column "SITE" (SUB_AREA )From yalova_ilce Set To Ilce_kod Where intersects
commit table SITE


End Sub

Sub ESource
		
	insert into SOURCE(obj,SOID,SONAME,SOFPOS,ABB_INT_ID,NO_KEY,VLEVEL,STYPE,SCOLIND,SG_KEY,STATE,STATUS,KWGEN,MAXKVAR,MINKVAR,MAXCAP,EMERGCAP,POSSEQR,POSSEQX,ZEROSEQR,ZEROSEQX,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SVPU_T,SVPU_A,SVPU_B,SVPU_C,NOMPHANG,NOMPHANG_A,NOMPHANG_B,NOMPHANG_C,NOMPHANG_L,NOMPHANG_L_A,NOMPHANG_L_B,NOMPHANG_L_C) select obj,"VRT_BN_MV_" + OBJECTID,tm_no + "_" + (34500/1000) + "_"+ scada_fider_no,abb_int_id, abb_int_id,nfpos,22,0,scada_fider_no+5,0,1,111,0,0,0,0,0,0,0,0,0,3,6,3,3,1,1,1,1,0,0,-120,120,0,0,-120,120 from OG_KABLO_NOKTASI
	commit table SOURCE
	
	select * from OG_KAYNAK where gerilim like "154%" into selResSource
	insert into SOURCE(obj,SOID,SONAME,SOFPOS,ABB_INT_ID,NO_KEY,VLEVEL,STYPE,SCOLIND,SG_KEY,STATE,STATUS,KWGEN,MAXKVAR,MINKVAR,MAXCAP,EMERGCAP,POSSEQR,POSSEQX,ZEROSEQR,ZEROSEQX,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SVPU_T,SVPU_A,SVPU_B,SVPU_C,NOMPHANG,NOMPHANG_A,NOMPHANG_B,NOMPHANG_C,NOMPHANG_L,NOMPHANG_L_A,NOMPHANG_L_B,NOMPHANG_L_C)select obj,tm_no + "_154kV_SOURCE-" + kaynak_no,tm_no + "_154kV_SOURCE-" + kaynak_no,abb_int_id, abb_int_id,nfpos,25,1,(kaynak_no+5),36,1,111,0,0,0,0,0,0,0,0,0,3,6,3,3,1,1,1,1,0,0,-120,120,0,0,-120,120 from OG_KAYNAK
	commit table SOURCE
	
	
	Alter Table "AG_KABLO_NOKTASI" ( add DEVICE_NFPOS Integer ) Interactive
	Add Column "AG_KABLO_NOKTASI" (DEVICE_NFPOS )From DEVICE Set To DFPOS Where AYIRICI_ID = ABB_INT_ID 
	commit table AG_KABLO_NOKTASI

	insert into SOURCE(obj,SOID,SONAME,SOFPOS,ABB_INT_ID,NO_KEY,VLEVEL,STYPE,SCOLIND,SG_KEY,STATE,STATUS,KWGEN,MAXKVAR,MINKVAR,MAXCAP,EMERGCAP,POSSEQR,POSSEQX,ZEROSEQR,ZEROSEQX,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SVPU_T,SVPU_A,SVPU_B,SVPU_C,NOMPHANG,NOMPHANG_A,NOMPHANG_B,NOMPHANG_C,NOMPHANG_L,NOMPHANG_L_A,NOMPHANG_L_B,NOMPHANG_L_C) select obj,"VRT_BN_LV_" + abb_int_id,tm_no + "_" + (400/1000) + "kV_"+ scada_fider_no,abb_int_id, abb_int_id,DEVICE_NFPOS,7,0,scada_fider_no + 5,0,1,111,0,0,0,0,0,0,0,0,0,3,6,3,3,1,1,1,1,0,0,-120,120,0,0,-120,120 from AG_KABLO_NOKTASI
	commit table SOURCE
		
	'Add Column "SOURCE" (no_key )From CNODE Set To NFPOS Where intersects
	'commit table SOURCE
	
	select * from source where no_key=0 into selZeroSource
	Add Column "selZeroSource" (NO_KEY )From NODE Set To NFPOS Where intersects
	commit table selZeroSource

	select * from source where abb_int_id=1010597 into selSou
	update selSou set stype=1
	commit table selSou
	
End Sub

Sub ESubstation
	
dim str as string

insert into substation(id,name,district,sub_id) select tm_no,tm_adi,sub_area,tm_no from lgc_merkez
insert into substation(id,name,district,sub_id) select abb_int_id,abb_int_id,sub_area,tm_no from lgc_sdk
commit table substation

select name,count(*) from substation group by name into selName
select * from selName where col2>1 into selRes

if tableinfo(selRes,8)>0 then
fetch first from selRes
	subName = selName.col1

str = 	"select name,id from substation where name like """ + subName + "%"" into selSup"
run command str
update selSup set col1=col2
commit table substation
end if

End Sub

Sub CreateABBTable
'kofra result içerisinde duplicate olan kofra numaralarýný sil
	
Commit Table abone As TargetPath + "abone.TAB" TYPE NATIVE Charset "WindowsTurkish"
Commit Table KOFRA_RESULT As TargetPath + "KOFRA_RESULT.TAB" TYPE NATIVE Charset "WindowsTurkish"
Commit Table GROUP_RESULT As TargetPath + "GROUP_RESULT.TAB" TYPE NATIVE Charset "WindowsTurkish"
Commit Table Elektrik_T_TRANSFORMATOR_INDIR As TargetPath + "TRF_INDIRICI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_TRANSFORMATOR_DAGIT As TargetPath + "TRF_DAGITIM.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_RTU As TargetPath + "RTU.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_REAKTOR As TargetPath + "REAKTOR.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_OG_YARDIMCI_TECHIZA As TargetPath + "OG_YARDIMCI_TECHIZAT.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_OG_TECHIZAT As TargetPath + "OG_TECHIZAT.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_OG_KESICI As TargetPath + "OG_KESICI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_OG_KAYNAK As TargetPath + "OG_KAYNAK.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_OG_AYIRICI As TargetPath + "OG_AYIRICI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_ANALIZOR As TargetPath + "ANALIZOR.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_AG_TECHIZAT As TargetPath + "AG_TECHIZAT.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_AG_AYIRICI As TargetPath + "AG_AYIRICI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_K_SDK_AYIRICI As TargetPath + "SDK_AYIRICI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_K_SDK As TargetPath + "SDK.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_K_KOFRA As TargetPath + "KOFRA.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_OG_KABLO_BAGLANTISI As TargetPath + "OG_KABLO_BAGLANTISI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_OG_BARA As TargetPath + "OG_BARA.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_AG_KABLO_BAGLANTISI As TargetPath + "AG_KABLO_BAGLANTISI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_AG_BARA As TargetPath + "AG_BARA.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_K_SDK_KABLO_BAGLANTIS As TargetPath + "SDK_KABLO_BAGLANTISI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_K_SDK_BARA As TargetPath + "SDK_BARA.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_H_ENERJI_NAKIL_HATTI As TargetPath + "ENERJI_NAKIL_HATTI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_H_DAGITIM_HATTI As TargetPath + "DAGITIM_HATTI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_H_ABONE_BAGLANTI_HATT As TargetPath + "ABONE_HATTI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_H_AYDINLATMA_HATTI As TargetPath + "AYDINLATMA_HATTI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_MERKEZ_BINA As TargetPath + "MERKEZ_BINA.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_HUCRE As TargetPath + "HUCRE.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_LGC_SDK As TargetPath + "LGC_SDK.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_LGC_MERKEZ As TargetPath + "LGC_MERKEZ.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_K_SAYAC As TargetPath + "SAYAC.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
'Commit Table Elektrik_T_KONDANSATOR_GRUBU As TargetPath + "KONDANSATOR.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_AG_BAGLANTI_NOKTASI As TargetPath + "AG_KABLO_NOKTASI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_T_OG_BAGLANTI_NOKTASI As TargetPath + "OG_KABLO_NOKTASI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_K_SDK_BAGLANTI_NOKTAS As TargetPath + "SDK_KABLO_NOKTASI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table Elektrik_D_DIREK_AYIRICI As TargetPath + "DIREK_AYIRICI.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
Commit Table YALOVA_ILCE As TargetPath + "YALOVA_ILCE.TAB" TYPE NATIVE Charset "WindowsTurkish" CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)
																										 
close all interactive 

if TableControl("abone") = 0 then
		Open Table TargetPath + "abone.TAB" Interactive
end if

if TableControl("KOFRA_RESULT") = 0 then
		Open Table TargetPath + "KOFRA_RESULT.TAB" Interactive
end if

if TableControl("GROUP_RESULT") = 0 then
		Open Table TargetPath + "GROUP_RESULT.TAB" Interactive
end if
	
if TableControl("TRF_INDIRICI") = 0 then
		Open Table TargetPath + "TRF_INDIRICI.TAB" Interactive
end if

if TableControl("TRF_DAGITIM") = 0 then
		Open Table TargetPath + "TRF_DAGITIM.TAB" Interactive
end if

if TableControl("RTU") = 0 then
		Open Table TargetPath + "RTU.TAB" Interactive
end if

if TableControl("REAKTOR") = 0 then
		Open Table TargetPath + "REAKTOR.TAB" Interactive
end if

if TableControl("OG_YARDIMCI_TECHIZAT") = 0 then
		Open Table TargetPath + "OG_YARDIMCI_TECHIZAT.TAB" Interactive
end if

if TableControl("OG_TECHIZAT") = 0 then
		Open Table TargetPath + "OG_TECHIZAT.TAB" Interactive
end if

if TableControl("OG_KESICI") = 0 then
		Open Table TargetPath + "OG_KESICI.TAB" Interactive
end if

if TableControl("OG_KAYNAK") = 0 then
		Open Table TargetPath + "OG_KAYNAK.TAB" Interactive
end if

if TableControl("OG_AYIRICI") = 0 then
		Open Table TargetPath + "OG_AYIRICI.TAB" Interactive
end if

if TableControl("ANALIZOR") = 0 then
		Open Table TargetPath + "ANALIZOR.TAB" Interactive
end if

if TableControl("AG_TECHIZAT") = 0 then
		Open Table TargetPath + "AG_TECHIZAT.TAB" Interactive
end if

if TableControl("AG_AYIRICI") = 0 then
		Open Table TargetPath + "AG_AYIRICI.TAB" Interactive
end if

if TableControl("SDK_AYIRICI") = 0 then
		Open Table TargetPath + "SDK_AYIRICI.TAB" Interactive
end if

if TableControl("SDK") = 0 then
		Open Table TargetPath + "SDK.TAB" Interactive
end if

if TableControl("ENERJI_NAKIL_HATTI") = 0 then
		Open Table TargetPath + "ENERJI_NAKIL_HATTI.TAB" Interactive
end if

if TableControl("OG_KABLO_BAGLANTISI") = 0 then
		Open Table TargetPath + "OG_KABLO_BAGLANTISI.TAB" Interactive
end if

if TableControl("OG_BARA") = 0 then
		Open Table TargetPath + "OG_BARA.TAB" Interactive
end if

if TableControl("AG_KABLO_BAGLANTISI") = 0 then
		Open Table TargetPath + "AG_KABLO_BAGLANTISI.TAB" Interactive
end if

if TableControl("AG_BARA") = 0 then
		Open Table TargetPath + "AG_BARA.TAB" Interactive
end if

if TableControl("SDK_KABLO_BAGLANTISI") = 0 then
		Open Table TargetPath + "SDK_KABLO_BAGLANTISI.TAB" Interactive
end if

if TableControl("SDK_BARA") = 0 then
		Open Table TargetPath + "SDK_BARA.TAB" Interactive
end if

if TableControl("DAGITIM_HATTI") = 0 then
		Open Table TargetPath + "DAGITIM_HATTI.TAB" Interactive
end if

if TableControl("ABONE_HATTI") = 0 then
		Open Table TargetPath + "ABONE_HATTI.TAB" Interactive
end if

if TableControl("AYDINLATMA_HATTI") = 0 then
		Open Table TargetPath + "AYDINLATMA_HATTI.TAB" Interactive
end if

if TableControl("MERKEZ_BINA") = 0 then
		Open Table TargetPath + "MERKEZ_BINA.TAB" Interactive
end if

if TableControl("HUCRE") = 0 then
		Open Table TargetPath + "HUCRE.TAB" Interactive
end if

if TableControl("LGC_SDK") = 0 then
		Open Table TargetPath + "LGC_SDK.TAB" Interactive
end if

if TableControl("LGC_MERKEZ") = 0 then
		Open Table TargetPath + "LGC_MERKEZ.TAB" Interactive
end if

if TableControl("RTU") = 0 then
		Open Table TargetPath + "RTU.TAB" Interactive
end if

if TableControl("SAYAC") = 0 then
		Open Table TargetPath + "SAYAC.TAB" Interactive
end if

if TableControl("KOFRA") = 0 then
		Open Table TargetPath + "KOFRA.TAB" Interactive
end if

if TableControl("OG_KABLO_NOKTASI") = 0 then
		Open Table TargetPath + "OG_KABLO_NOKTASI.TAB" Interactive
end if

if TableControl("AG_KABLO_NOKTASI") = 0 then
		Open Table TargetPath + "AG_KABLO_NOKTASI.TAB" Interactive
end if

if TableControl("SDK_KABLO_NOKTASI") = 0 then
		Open Table TargetPath + "SDK_KABLO_NOKTASI.TAB" Interactive
	end if

if TableControl("DIREK_AYIRICI") = 0 then
		Open Table TargetPath + "DIREK_AYIRICI.TAB" Interactive
end if

if TableControl("AG_TECHIZAT") = 0 then
		Open Table TargetPath + "AG_TECHIZAT.TAB" Interactive
end if

if TableControl("YALOVA_ILCE") = 0 then
		Open Table TargetPath + "YALOVA_ILCE.TAB" Interactive
end if

'if TableControl("KONDANSATOR") = 0 then
'		Open Table TargetPath + "KONDANSATOR.TAB" Interactive
'end if

'Create table for ABB
Create Table "DEVICE" (DID Char(40),DNAME Char(45),DFPOS Integer,ABB_INT_ID Integer,LI_KEY Integer,LINE_END decimal(3,0),SUB_AREA Integer,XD_1 Integer,YD_1 Integer,XD_2 Integer,YD_2 Integer, DEVCAT decimal(3,0), DT_KEY Integer, PHASE Integer, NORM_STATE Integer, STATUS Integer, DEVICESIZE decimal(8,2),STATE Integer,DESCRIPTIVE_LOC char(100),ATO_KEY Integer, PREFERRED decimal(1,0), ANNOPOS_1 Integer, ANNOPOS_2 Integer,TAPSIDE Integer,TAP_1 Integer, TAP_2 Integer,TAP_3 Integer,TAP_4 Integer,CONTROLLED Integer,REQVOLTS decimal(5,4), SENSING_PHASE char(2),ASSET_ID char(40),BREAKAMPS decimal(6,2),TTYPE Integer,CNODEID Integer,SUB_ID Integer,VLEVEL Integer,SG_KEY1 Integer, AA Integer,AAL Integer,GERILIM Integer, AKIM Integer, DEVTABLETYPE Integer,LOAD_X Integer, LOAD_Y Integer) file TargetPath + "DEVICE.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For DEVICE CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "ACCOUNT" (ACCNO Char(20), NAME Char(44), AREA Integer,LOC Char(40), PHONE Integer, SSN Integer, RANK Integer, CLASS Integer, RATE Integer, KVA Integer, KWH Integer,DISC date,ADDR1 Char(40), BAL Integer, NOTE Char(40), ADDR2 Char(44), ADDR3 Char(30),ADDR4 Char(30),ZIP Integer,SECT Integer,BREAK Integer,NODE Integer,SAREA Integer,CITY Char(30),POLE Char(30), SERV Char(240),STATE Char(2),CNTY Char(40),XCOOR Integer,YCOOR Integer,XFMER Integer, DELPT Integer, FEED Integer,SUBS Integer,DISTR Integer,PHASE char(4), LMS Integer, HEAT Integer,AIR Integer,LO_KEY Integer,NOTE2 Char(50), PRIORITY char(8), XFMR_ID Char(40),METER_LOC Char(16),METER_NO Char(16),BILL_ACCNO Char(20),METER_CYCLE	Integer, DIRECTIONS Char(50),	NAME2 Char(30),	AREA2 Integer,	PHONE2 Integer,	METER_ROUTE Char(2),	SERV_ST Char(44),	CONTACT Char(30),	HOUSE_NO Char(10),	STREET Char(60),	HOUSE_NO2 Char(10),	MAX_LOAD Char(6),	MTRNO1 Char(16),	MTRNO2 Char(16),	MTRNO3 Char(16),	MTRIND1 Char(3),	MTRNO4 Char(16),	MTRNO5 Char(16),	MTRIND2 Char(3),	MTRIND3 Char(3),	MTRIND4 Char(3),	MTRIND5 Char(3),	MTRSIZE1 Char(12),	MTRSIZE2 Char(12),	MTRSIZE3 Char(12),	MTRSIZE4 Char(12),	MTRSIZE5 Char(12),	MTRTYPE1 Char(3),	MTRTYPE2 Char(3),	MTRTYPE3 Char(3),	MTRLOC1 Char(3),	MTRTYPE4 Char(3),	MTRTYPE5 Char(3),	MTRLOC2 Char(3),	MTRLOC3 Char(3),	LASTVISITINFO Char(30),	MTRLOC4 Char(3),	MTRLOC5 Char(3),	FERGUSON_PAGE_NO Char(6),	FERGUSON_GRID_NO Char(6),	CIRCUIT Char(6),	MTRGRIDX1 Char(10),	MTRGRIDX2 Char(10),	MTRGRIDX3 Char(10),	MTRGRIDX4 Char(10),	MTRGRIDX5 Char(10),	MTRGRIDY1 Char(10),	MTRGRIDY2 Char(10),	MTRGRIDY3 Char(10),	MTRGRIDY4 Char(10),	MTRGRIDY5 Char(10),	SLAB1 Char(12),	SLAB2 Char(12),	SUBDIVNAME Char(40),	SUBSTATIONNO Char(5),	XFMRMRSIZEIND Char(6),	UGCONDUITSIZE Char(6),	GIS_X_COORD char(10),	GIS_Y_COORD char(10),	MTRNO1TRANSFORMER Char(20),	MTRNO2TRANSFORMER Char(20),	MTRNO3TRANSFORMER Char(20),	MTRNO4TRANSFORMER Char(20),	ARCH_DONE Char(1),	MTRNO5TRANSFORMER Char(20),	SERVICE_CLASS Integer,	ARCH_DATE Date,	AMI_STATUS_CODE Integer,	AMI_STATUS_TIMESTAMP date,	TIME_MOD date,	AMR_ENABLED Char(1),	TOWN Char(40),	REGION Char(40),	RATE_DESC Char(45),	TAX_DISTRICT Char(40),	TOWN_CODE Char(40),	PRIORITY_NO Integer,	CAUTION_CUSTOMER Char(20),CNODEID Integer) file TargetPath + "ACCOUNT.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For ACCOUNT CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "AFFECTED_SUBID" (SUB_ID Integer) file TargetPath + "AFFECTED_SUBID.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For AFFECTED_SUBID CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "CAPACITOR" (CAID Char(40), CANAME Char(40),	CAFPOS Integer,	ABB_INT_ID Integer,	NO_KEY Integer,	DT_KEY Integer,	RATING_1 Decimal(8,2),	RATING_2 Decimal(8,2),	RATING_3 Decimal(8,2),	RATING_4 Decimal(8,2),	DESCRIPTIVE_LOC Char(60),	PH3PRES Integer,	BITS Integer,	STATE Integer,	STATUS Integer,	ANNO_POS_1 Integer,	ANNO_POS_2 Integer,	SYM_POS_1 Integer,	SYM_POS_2 Integer,	REGULATING Integer,	REG_MODE Integer,	REG_NODE_KEY Integer,	REG_LINE_XFRM_KEY Integer,	REG_Q_COMP_TYPE Integer,	REG_V_SENS_PHASE Char(2),	REG_Q_SENS_PHASE Char(1),	REG_LINE_END decimal(1,0),	V_ON_LIMIT Decimal(6,4),	V_OFF_LIMIT Decimal(6,4),	Q_ON_LIMIT Decimal(10,4),	Q_OFF_LIMIT Decimal(10,4),CNODEID Integer) file TargetPath + "CAPACITOR.TAB" TYPE NATIVE Charset "WindowsTurkish" 
Create Map For CAPACITOR CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "DISTRICT" (ID Integer,IN_SYSTEM Char(10),	NAME Char(20),	OP_CENTER_ID Integer,	OVER_X Char(10),	OVER_Y Char(10),	PRINTER_ID Integer,	PRINT_CMD Char(10),	REGION Integer,	REMARK1 Char(20),	REMARK2 Char(20),	REMARK3 Char(20),	REMARK4 Char(20)) file TargetPath + "DISTRICT.TAB" TYPE NATIVE Charset "WindowsTurkish" 
Create Map For DISTRICT CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "FEEDER" (ID Integer,NAME Char (20), SITE Integer, FIRST_NODE_ID Char(20), FIRST_LINE_ID Char(20), SUB_ID Integer,CNODEID Integer  ) file TargetPath + "FEEDER.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For FEEDER CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "SUBSTATION" (ID Integer,NAME Char (14), DISTRICT Integer, BOTTOM Char(20), SUB_ID Integer, MANUAL_ENTRY Char(10), AMR_FLAG Char(10)) file TargetPath + "SUBSTATION.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For SUBSTATION CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "LINE" (FPOS Integer,	ID Char(40),	ABB_INT_ID Integer,	NAME Char(40),	NO_KEY_1 Integer,	NO_KEY_2 Integer,	PA_KEY_1 Integer,	PA_KEY_2 Integer,	PHASE_PERM Integer,	LINE_TYPE Integer,	BITS Integer,	SUB_AREA Integer,	STATE Decimal(3,0),	LENGTH decimal(12,3),	ANNOPOS_1 Integer,	ANNOPOS_2 Integer,	ASSET_ID char(40),CNODEID Integer,LINE_KIND Integer) file TargetPath + "LINE.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For LINE CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "GNDLINE" (FPOS Integer,	ID Char(40),	ABB_INT_ID Integer,	NAME Char(40),	NO_KEY_1 Integer,	NO_KEY_2 Integer,	PA_KEY_1 Integer,	PA_KEY_2 Integer,	PHASE_PERM Integer,	LINE_TYPE Integer,	BITS Integer,	SUB_AREA Integer,	STATE Decimal(3,0),	LENGTH decimal(10,3),	ANNOPOS_1 Integer,	ANNOPOS_2 Integer,	ASSET_ID char(40),CNODEID Integer) file TargetPath + "GNDLINE.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For GNDLINE CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "LOAD" (LOID Char(20),	LONAME Char(40),	ABB_INT_ID Integer,	LOFPOS Integer,	NO_KEY Integer,	SG_KEY Integer,	BITS Integer,	LOTYPE Integer,	RATING_1 Integer,	RATING_2 Integer,	RATING_3 Integer,	RATING_4 Integer,	BILLED_1 Integer,	BILLED_2 Integer,	BILLED_3 Integer,	BILLED_4 Integer,	PFACT_1 Integer,	PFACT_2 Integer,	PFACT_3 Integer,	PFACT_4 Integer,	PHASE Integer,	STATUS Integer,	STATE Integer,	DESCRIPTIVE_LOC Char(20),	ANNOPOS_1 Integer,	ANNOPOS_2 Integer,	SYM_POS_1 Integer,	SYM_POS_2 Integer,	SUB_AREA Integer,	COUNTPRIORITY Integer,	CUSTNO_1 Integer, CNODEID Integer,SUB_ID Integer,GERILIM Integer, AKIM Integer,AYIRICI_ID Integer) file TargetPath + "LOAD.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For LOAD CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "MPOINT" (MPFPOS Integer,	MPID Char(40),	ABB_INT_ID Integer,	MPNAME Char(30),	XD_1 Integer,	YD_1 Integer, 	XD_2 Integer,	YD_2 Integer,	STATE Integer,	SG_KEY Integer,	ANNOPOS_1 Integer,	ANNOPOS_2 Integer,	LINE_ON Integer,	NO_KEY Integer,	LA_EXCLUDED Integer,	LA_MEAS_USED Integer,CNODEID Integer) file TargetPath + "MPOINT.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For MPOINT CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "NODE" (NFPOS Integer,	NID Char(40),	ABB_INT_ID Integer,	NNAME Char(40),	XN_1 Integer,	YN_1 Integer,	XN_2 Integer,	YN_2 Integer,	NBITS Integer,	CON_TYPE decimal(1,0),	SG_KEY_1 decimal(3,0),	SUB_AREA decimal(4,0),	STATE decimal(3,0),	VLEVEL decimal(3,0),	SUB_ID Integer,	NANNOPOS_1 decimal(2,0),	NANNOPOS_2 decimal(2,0),	SECONDARY decimal(1,0)) file TargetPath + "NODE.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For NODE CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "PATH" (PAFPOS Integer,	NEXTP Integer,	XDIFF Integer,	YDIFF Integer,	SUB_AREA Integer, LINE_ID Integer) file TargetPath + "PATH.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For PATH CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "SITE" (SIID Integer,	SINAME Char(40),	ABB_INT_ID Integer,	SIFPOS Integer,	NO_KEY Integer,	SG_KEY Integer,	XSITE Integer,	YSITE Integer,	SITEW Integer,	SITEH Integer,	SSITE_ANG Integer,	GXSITE Integer,	GYSITE Integer,	GSITEW Integer,	GSITEH Integer,	GSITE_ANG Integer,	ADDRESS Char(50),	STATE Integer,	ANNOPOS_1 Integer,	ANNOPOS_2 Integer,CNODEID Integer) file TargetPath + "SITE.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For SITE CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "SOURCE" ( SOID Char(40),	SONAME Char(40),	SOFPOS Integer,	ABB_INT_ID Integer,	NO_KEY Integer,	VLEVEL decimal(3,0),	STYPE decimal(3,0),	SCOLIND decimal(3,0),	SG_KEY Integer,	STATE decimal(3,0),	STATUS decimal(3,0),	KWGEN decimal(8,2),	MAXKVAR decimal(8,2),	MINKVAR decimal(8,2),	MAXCAP decimal(8,2),	EMERGCAP decimal(6,2),	POSSEQR decimal(8,4),	POSSEQX decimal(8,4),	ZEROSEQR decimal(8,4),	ZEROSEQX decimal(8,4),	ANNOPOS_1 decimal(3,0),	ANNOPOS_2 decimal(3,0),	SYM_POS_1 decimal(3,0),	SYM_POS_2 decimal(3,0),	SVPU_T decimal(6,4),	 SVPU_A decimal(6,4), SVPU_B decimal(6,4),	SVPU_C decimal(6,4),	NOMPHANG decimal(6,2),	NOMPHANG_A decimal(6,2),	NOMPHANG_B integer,	NOMPHANG_C decimal(6,2),	NOMPHANG_L decimal(6,2),	NOMPHANG_L_A decimal(6,2),	NOMPHANG_L_B integer,	NOMPHANG_L_C decimal(6,2),CNODEID Integer) file TargetPath + "SOURCE.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For SOURCE CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

'basar table
Create Table "CNODE" (LINE_ID Integer, GIS_ID Char(22), Terminal char(1), Group_Id Integer, ttype Integer,NFPOS Integer,SECONDARYs Integer,DEVICE_ID Integer,NO_KEY1 Integer, NO_KEY2 Integer) file TargetPath + "CNODE.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For CNODE CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "CNODEPATH" (NFPOS Integer,LINE_ID Integer,Terminal char(1), Group_Id Integer, TTYPE Integer) file TargetPath + "CNODEPATH.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For CNODEPATH CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "CONNECTIVITY" (LINE_ID Integer, Terminal char(1), Group_Id Integer, NFPOS Integer) file TargetPath + "CONNECTIVITY.TAB" TYPE NATIVE Charset "WindowsTurkish"

Create Table "CONLINE" (ID Integer,ABB_INT_ID Integer,group_id Integer,ttype Integer,TM_NO Integer,TM1 Integer,TM2 Integer,GERILIM Integer,TYPECODE Integer,TR_NO Integer,FIDERNO Integer,SDK_NO Integer, BARA_NO Char(10), SUB_AREA Integer, OBJECTID Integer, TIP Char(20)) file TargetPath + "CONLINE.TAB" TYPE NATIVE Charset "WindowsTurkish"
Create Map For CONLINE CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

Create Table "REGION" (ID Integer,NAME CHAR(14)) file TargetPath + "REGION.TAB" TYPE NATIVE Charset "WindowsTurkish"
'Create Map For CONLINE CoordSys Earth Projection 3, 104, "m", 27.5, 40, 39.3333333333, 40.6666666667, 1000000, 0 Bounds (1153626.19283, 73853.46113) (1169216.23488, 82589.90907)

End Sub

Sub CreateCnode
	
	call GetDateTime
	set coordsys table enerji_nakil_hatti
	'Open File TargetPath + "CSV/" +"Nfpos.txt" for append As #2 CharSet "WindowsTurkish"
	
	'load için silinecek datalar
	'select * from dagitim_hatti where id not in(select id from group_result group by id) into selDeleteLoad
	'delete from selDeleteLoad
	'commit table selDeleteLoad
	
	Create Object As Union From  enerji_nakil_hatti Into Table CONLINE Group by GROUP_ID Data ID=ID,TM1=TM1,TM2=TM2,GERILIM=GERILIM,ABB_INT_ID=GROUP_ID,TYPECODE=TYPECODE,FIDERNO=FIDER_NO,SUB_AREA=SUB_AREA,GROUP_ID=GROUP_ID, TTYPE=1
	Create Object As Union From  dagitim_hatti Into Table CONLINE Group by GROUP_ID Data ID=ID, TM1=TM1,TM2=TM2,GERILIM=GERILIM,ABB_INT_ID=GROUP_ID,TYPECODE=TYPECODE,TIP=TIP,SUB_AREA=SUB_AREA,GROUP_ID=GROUP_ID, TTYPE=2
	'Create Object As Union From  abone_hatti Into Table CONLINE Group by GROUP_ID Data ID=ID, TM_NO=TM_NO,GERILIM=GERILIM,ABB_INT_ID=GROUP_ID,TYPECODE=TYPECODE,SUB_AREA=SUB_AREA,GROUP_ID=GROUP_ID, TTYPE=4
	Create Object As Union From  og_bara Into Table CONLINE Group by GROUP_ID Data ID=ID, TM_NO=TM_NO, BARA_NO=BARA_NO,GERILIM=GERILIM,ABB_INT_ID=GROUP_ID,TYPECODE=TYPECODE,SUB_AREA=SUB_AREA,GROUP_ID=GROUP_ID, TTYPE=5	
	Create Object As Union From  ag_bara Into Table CONLINE Group by GROUP_ID Data ID=ID, TM_NO=TM_NO, TR_NO=TR_NO,BARA_NO=BARA_NO,GERILIM=GERILIM,ABB_INT_ID=GROUP_ID,TYPECODE=TYPECODE,SUB_AREA=SUB_AREA,GROUP_ID=GROUP_ID, TTYPE=6	
	Create Object As Union From  sdk_bara Into Table CONLINE Group by GROUP_ID Data ID=ID, SDK_NO=SDK_NO,BARA_NO=SDK_BARA_NO,GERILIM=GERILIM,ABB_INT_ID=GROUP_ID,TYPECODE=TYPECODE,SUB_AREA=SUB_AREA,GROUP_ID=GROUP_ID, TTYPE=7	
	'Create Object As Union From  aydinlatma_hatti Into Table CONLINE Group by GROUP_ID Data ID=ABB_INT_ID,GROUP_ID=GROUP_ID, TTYPE=7
	Create Object As Union From  og_kablo_baglantisi Into Table CONLINE Group by GROUP_ID Data ID=ID, TM_NO=TM_NO,OBJECTID=OBJECTID,ABB_INT_ID=GROUP_ID,TYPECODE=TYPECODE,SUB_AREA=SUB_AREA,GROUP_ID=GROUP_ID, TTYPE=8
	Create Object As Union From  ag_kablo_baglantisi Into Table CONLINE Group by GROUP_ID Data ID=ID, TM_NO=TM_NO,OBJECTID=OBJECTID,ABB_INT_ID=GROUP_ID,TYPECODE=TYPECODE,SUB_AREA=SUB_AREA,GROUP_ID=GROUP_ID, TTYPE=9
	Create Object As Union From  sdk_kablo_baglantisi Into Table CONLINE Group by GROUP_ID Data ID=ID, TM_NO=TM_NO,OBJECTID=OBJECTID,ABB_INT_ID=GROUP_ID,TYPECODE=TYPECODE,GROUP_ID=GROUP_ID, TTYPE=10
	
	insert into CONLINE(obj,ABB_INT_ID,group_id,ttype,id) select obj,fpos,fpos,11,fpos from GNDLINE
	
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,1 from enerji_nakil_hatti
'	select obj,abb_int_id,group_id,2 from dagitim_hatti where tip = "HAVAI" into selHavai
'	select obj,abb_int_id,group_id,2 from dagitim_hatti where tip <> "HAVAI" into selOther
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,2 from selHavai
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,3 from selOther
'	'insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,3 from abone_hatti
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,4 from og_bara
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,5 from ag_bara
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,6 from sdk_bara
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,7 from aydinlatma_hatti
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,8 from og_kablo_baglantisi
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,9 from ag_kablo_baglantisi
'	insert into CONLINE(obj,id,group_id,ttype) select obj,abb_int_id,group_id,10 from sdk_kablo_baglantisi
'	insert into CONLINE(obj,id,group_id,ttype) select obj,fpos,fpos,11 from GNDLINE
	
	commit table CONLINE
	
	print "Connectivity Baþlangýç -" + completeTime
	fetch first from CONLINE

	objectcount = tableinfo(CONLINE ,8)
	kalan=objectcount

	for icn=1 to tableinfo(CONLINE ,8)		
		cnodeNfpos = cnodeNfpos + 1
		if CONLINE.rowid mod 1000 = 0 then
		print CONLINE.rowid		
	End If
		HatObj 		= CONLINE.obj
		lineGroupId = CONLINE.group_id
		'_lineabbId 	= CONLINE.id
		_lineabbId 	= CONLINE.group_id
		_linetype   = CONLINE.ttype
		'rndvar = 10000000 * Rnd(1)
		
		NFTime = FormatTime$(curdatetime(),"HHmmssfff")
		NFTime = round(val(NFTime) * (10 * Rnd(1)),1)
		rndvar = NFTime
		
		'print #2, NFTime	
		'rndvar =   Round(GetReallyRandomNumber(),1)
		'print rndvar
		Do Case ObjectInfo(HatObj, OBJ_INFO_TYPE)
			Case OBJ_TYPE_LINE
				p1 = createpoint(objectgeography(HatObj,1),objectgeography(HatObj,2))
				p2 = createpoint(objectgeography(HatObj,3),objectgeography(HatObj,4))

			Case OBJ_TYPE_PLINE
				if ObjectInfo(HatObj, OBJ_INFO_NPolygons) > 1 then
					print "Desteklenmeyen veri tipi(Combine Object) bulundu. GROUP_ID : " + CONLINE.GROUP_ID
					onerror goto hataObj
				end if
				nodeNum = ObjectInfo(HatObj, OBJ_INFO_NPOLYGONS+1) 
				p1 = createpoint(objectnodex(HatObj,1,1),objectnodey(HatObj,1,1))
				p2 = createpoint(objectnodex(HatObj,1,nodenum),objectnodey(HatObj,1,nodenum))
				
			Case Else
				print "Data içerisinde topolojiye uygun olmayan veriler var. Combine obje olmasý muhtemeldir."
					onerror goto hataObj
		End Case		
		
		p1 = buffer(p1, 32, 0.2, "cm")
		p2 = buffer(p2, 32, 0.2, "cm")
		
		'HAT BEGIN KISMI
		Select * from CNODE where obj intersects p1 into selConn noselect
		
		if tableinfo(selConn,8) = 0 then
			_cnodeObj  = p1
			
			xnewId = str$(centroidx(_cnodeObj))
			if instr(1,xnewId , "." ) <> 0 then
				xnewId  = left$(xnewId ,instr(1,xnewId , "." )-1) + mid$(xnewId ,instr(1,xnewId , "." )+1,1)
				'xnewId = mid$(xnewId ,instr(1,xnewId , "." )+1,1)
			End If
		    ynewId = str$(centroidy(_cnodeObj))
		    If instr(1,ynewId , "." ) <> 0 then		    
				ynewId = left$(ynewId ,instr(1,ynewId , "." )-1) + mid$(ynewId ,instr(1,ynewId , "." )+1,1)		
				'ynewId = mid$(ynewId ,instr(1,ynewId , "." )+1,1)
			End if 
			
			cnodeNewId =  str$(xnewId)   + _lineabbId + + str$(ynewId)
					
			NodeGisId  = Left$(ZeroCnodeId, 20-Len(str$(cnodeNewId))) + cnodeNewId
		    NodeGisId  = left$(NodeGisId,20)
		    			
			insert into CNODE(OBJ, LINE_ID,GIS_ID,GROUP_ID,TERMINAL,TTYPE,SECONDARYs,nfpos) values(p1,_lineabbId,NodeGisId,lineGroupId,"B",_linetype,0,rndvar)
			'insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) values(p1,rndvar,_lineabbId,rndvar,rndvar,centroidx(p1),centroidy(p1),centroidx(p1),centroidy(p1),12288,1,41,202,1,7,1000,3,6,0) 
			insert into CONNECTIVITY(LINE_ID, Terminal, Group_Id,NFPOS) values(_lineabbId, "B", lineGroupId,rndvar)			
		else
			fetch first from selConn
			NodeGisId = selConn.nfpos
			'insert into CONNECTIVITY(LINE_ID, Terminal, Group_Id,NFPOS) values(_lineabbId, "B", lineGroupId,val(right$(NodeGisId,9)))
			insert into CONNECTIVITY(LINE_ID, Terminal, Group_Id,NFPOS) values(_lineabbId, "B", lineGroupId,NodeGisId)
		End if
		
		'HAT END KISMI
		Select * from CNODE where obj intersects p2 into selConn noselect
		'rndvar = 10000000 * Rnd(1)
		'rndvar =   Round(GetReallyRandomNumber(),1)
		NFTime = FormatTime$(curdatetime(),"HHmmssfff")
		NFTime = round(val(NFTime) * (10 * Rnd(1)),1)
		rndvar = NFTime
		
		if tableinfo(selConn,8) = 0 then
			_cnodeObj2  = p2
			
			cnodeNfpos = cnodeNfpos + 1
			xnewId = str$(format$(centroidx(_cnodeObj2),"##.###"))
			if instr(1,xnewId , "." ) <> 0 then
				xnewId  = left$(xnewId ,instr(1,xnewId , "." )-1) + mid$(xnewId ,instr(1,xnewId , "." )+1,1)
				'xnewId = mid$(xnewId ,instr(1,xnewId , "." )+1,1)
			End If
		    ynewId = str$(format$(centroidy(_cnodeObj2),"##.###"))
		    if instr(1,ynewId , "." ) <> 0 then		    
				ynewId = left$(ynewId ,instr(1,ynewId , "." )-1) + mid$(ynewId ,instr(1,ynewId , "." )+1,1)
				'ynewId = mid$(ynewId ,instr(1,ynewId , "." )+1,1)
			end if 
			
			cnodeNewId =  str$(ynewId)  + _lineabbId + str$(xnewId)
					
			NodeGisId = left$(NodeGisId,2)		    
		    NodeGisId = Left$(ZeroCnodeId, 20-Len(str$(cnodeNewId))) + cnodeNewId
			
			'insert into CNODE(OBJ, LINE_ID,GIS_ID,GROUP_ID,TERMINAL,TTYPE,SECONDARYs,nfpos) values(p2,_lineabbId,NodeGisId,lineGroupId,"E",_linetype,1,val(right$(NodeGisId,9)))
			insert into CNODE(OBJ, LINE_ID,GIS_ID,GROUP_ID,TERMINAL,TTYPE,SECONDARYs,nfpos) values(p2,_lineabbId,NodeGisId,lineGroupId,"E",_linetype,1,rndvar)
			'insert into NODE(obj,NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY) values(p2,rndvar,_lineabbId,rndvar,rndvar,centroidx(p2),centroidy(p2),centroidx(p2),centroidy(p2),12288,1,41,202,1,7,1000,3,6,1)
			'insert into CONNECTIVITY(LINE_ID, Terminal, Group_Id,NFPOS) values(_lineabbId, "E", lineGroupId,val(right$(NodeGisId,9)))
			insert into CONNECTIVITY(LINE_ID, Terminal, Group_Id,NFPOS) values(_lineabbId, "E", lineGroupId,rndvar)
		else
			fetch first from selConn
			NodeGisId = selConn.nfpos
			if NodeGisId="0" then
				rndvar=selConn.nfpos
			End If
			'insert into CONNECTIVITY(LINE_ID, Terminal, Group_Id,NFPOS) values(_lineabbId, "E", lineGroupId,val(right$(NodeGisId,9)))
			insert into CONNECTIVITY(LINE_ID, Terminal, Group_Id,NFPOS) values(_lineabbId, "E", lineGroupId,NodeGisId)			
		end if
	hataObj:
	Fetch next from CONLINE
	cnodeNfpos = cnodeNfpos+1
	kalan = kalan-1
	Next	
	'update cnode set nfpos = no_key1
'update cnode set nfpos = rowid
commit table cnode

print "Connectivity Bitiþ -" + completeTime
Commit table cnode

select * from cnode where nfpos=0 into selcnode
update selcnode set nfpos = 10000000 * Rnd(1)
commit table cnode

Add Column "DEVICE" (DFPOS )From CNODE Set To NFPOS Where intersects
commit table DEVICE

'Alter Table "AG_KABLO_NOKTASI" ( add NFPOS Integer ) Interactive
Add Column "AG_KABLO_NOKTASI" (NFPOS )From CNODE Set To NFPOS Where intersects
commit table AG_KABLO_NOKTASI

Alter Table "OG_KABLO_NOKTASI" ( add NFPOS Integer ) Interactive
Add Column "OG_KABLO_NOKTASI" (NFPOS )From CNODE Set To NFPOS Where intersects
commit table OG_KABLO_NOKTASI

Alter Table "SDK_KABLO_NOKTASI" ( add NFPOS Integer ) Interactive
Add Column "SDK_KABLO_NOKTASI" (NFPOS )From CNODE Set To NFPOS Where intersects
commit table SDK_KABLO_NOKTASI

Alter Table "OG_KAYNAK" ( add NFPOS Integer ) Interactive
Add Column "OG_KAYNAK" (NFPOS )From CNODE Set To NFPOS Where intersects
commit table OG_KAYNAK
 
Alter Table "OG_TECHIZAT" ( add NFPOS Integer ) Interactive
Add Column  "OG_TECHIZAT" (NFPOS )From CNODE Set To NFPOS Where intersects
commit table OG_TECHIZAT

End Sub

Function TableControl(byval tabloAdi as string) as logical
	TableControl = 0
	dim ind as integer
	dim tAdi as string
	ind=1
	for ind = 1 to NumTables()
		tAdi=TableInfo(ind, 1)
		if tAdi = tabloAdi then
			TableControl = 1
			goto cikis
		end if
	next
	cikis:
end Function

Function ExportCsv(byval dosyaAdi as string, byval headerText as string) as logical
		
	Open File TargetPath + "CSV/" + dosyaAdi + ".csv" for append As #1 CharSet "WindowsTurkish"

	ExportCsv = 1
	dim lineText as string
	dim colName as string
	dim ind as integer
	
	print #1, headerText

	fetch first from selExport
	do while not eot(selExport)
		lineText = selExport.COL1
		for ind = 2 to Tableinfo(selExport, 4)
			lineText = lineText + ";" + selExport.col(ind)
		next
		print #1, lineText
		fetch next from selExport
	loop
	
	Close File #1

End Function

Sub CreateCsvFiles

call GetDateTime
	print "CreateCsvFiles- Baþlatýldý " + completeTime
	
	If FileExists(TargetPath + "CSV\DEVICE.csv") Then 
		Kill TargetPath + "CSV\DEVICE.csv"
	End If 

	If FileExists(TargetPath + "CSV\LINE.csv") Then 
		Kill TargetPath + "CSV\LINE.csv"
	End If 
	
	If FileExists(TargetPath + "CSV\NODE.csv") Then 
		Kill TargetPath + "CSV\NODE.csv"
	End If 

	If FileExists(TargetPath + "CSV\SITE.csv") Then 
			Kill TargetPath + "CSV\SITE.csv"
		End If 
	
	If FileExists(TargetPath + "CSV\LOAD.csv") Then 
			Kill TargetPath + "CSV\LOAD.csv"
		End If 
	
	If FileExists(TargetPath + "CSV\DISTRICT.csv") Then 
			Kill TargetPath + "CSV\DISTRICT.csv"
	End If 
	
	If FileExists(TargetPath + "CSV\CAPACITOR.csv") Then 
			Kill TargetPath + "CSV\CAPACITOR.csv"
		End If 
	
	If FileExists(TargetPath + "CSV\AFFECTED_SUBID.csv") Then
			Kill TargetPath + "CSV\AFFECTED_SUBID.csv"
		End If 
	
	If FileExists(TargetPath + "CSV\FEEDER.csv") Then
			Kill TargetPath + "CSV\FEEDER.csv"
		End If 
	
	If FileExists(TargetPath + "CSV\MPOINT.csv") Then
			Kill TargetPath + "CSV\MPOINT.csv"
		End If 

	If FileExists(TargetPath + "CSV\ACCOUNT.csv") Then
			Kill TargetPath + "CSV\ACCOUNT.csv"
		End If 

	If FileExists(TargetPath + "CSV\SOURCE.csv") Then
			Kill TargetPath + "CSV\SOURCE.csv"
		End If 

	If FileExists(TargetPath + "CSV\REGION.csv") Then
			Kill TargetPath + "CSV\REGION.csv"
		End If 
 
 	If FileExists(TargetPath + "CSV\SUBSTATION.csv") Then
			Kill TargetPath + "CSV\SUBSTATION.csv"
		End If 
 
If FileExists(TargetPath + "CSV\PATH.csv") Then
			Kill TargetPath + "CSV\PATH.csv"
		End If 

TextHeader = "DID;DNAME;DFPOS;ABB_INT_ID;LI_KEY;LINE_END;SUB_AREA;XD_1;YD_1;XD_2;YD_2;DEVCAT;DT_KEY;PHASE;NORM_STATE;STATUS;DEVICESIZE;STATE;DESCRIPTIVE_LOC;ATO_KEY;PREFERRED;ANNOPOS_1;ANNOPOS_2;TAPSIDE;TAP_1;TAP_2;TAP_3;TAP_4;CONTROLLED;REQVOLTS;SENSING_PHASE;ASSET_ID;BREAKAMPS"
	select DID,DNAME,DFPOS,ABB_INT_ID,LI_KEY,LINE_END,SUB_AREA,XD_1,YD_1,XD_2,YD_2,DEVCAT,DT_KEY,PHASE,NORM_STATE,STATUS,DEVICESIZE,STATE,DESCRIPTIVE_LOC,ATO_KEY,PREFERRED,ANNOPOS_1,ANNOPOS_2,TAPSIDE,TAP_1,TAP_2,TAP_3,TAP_4,CONTROLLED,REQVOLTS,SENSING_PHASE,ASSET_ID,BREAKAMPS from DEVICE into selExport noselect
	bDummy = ExportCsv("DEVICE", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-DEVICE-Tamamlandý " + completeTime

TextHeader = "FPOS;ID;ABB_INT_ID;NAME;NO_KEY_1;NO_KEY_2;PA_KEY_1;PA_KEY_2;PHASE_PERM;LINE_TYPE;BITS;SUB_AREA;STATE;LENGTH;ANNOPOS_1;ANNOPOS_2;ASSET_ID"
	select FPOS,ID,ABB_INT_ID,NAME,NO_KEY_1,NO_KEY_2,PA_KEY_1,PA_KEY_2,PHASE_PERM,LINE_TYPE,BITS,SUB_AREA,STATE,LENGTH,ANNOPOS_1,ANNOPOS_2,ASSET_ID from LINE into selExport noselect
	bDummy = ExportCsv("LINE", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-LINE-Tamamlandý " + completeTime

TextHeader = "NFPOS;NID;ABB_INT_ID;NNAME;XN_1;YN_1;XN_2;YN_2;NBITS;CON_TYPE;SG_KEY_1;SUB_AREA;STATE;VLEVEL;SUB_ID;NANNOPOS_1;NANNOPOS_2;SECONDARY"
	select NFPOS,NID,ABB_INT_ID,NNAME,XN_1,YN_1,XN_2,YN_2,NBITS,CON_TYPE,SG_KEY_1,SUB_AREA,STATE,VLEVEL,SUB_ID,NANNOPOS_1,NANNOPOS_2,SECONDARY from NODE into selExport noselect
	bDummy = ExportCsv("NODE", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-NODE-Tamamlandý " + completeTime

TextHeader = "SIID;SINAME;ABB_INT_ID;SIFPOS;NO_KEY;SG_KEY;XSITE;YSITE;SITEW;SITEH;SSITE_ANG;GXSITE;GYSITE;GSITEW;GSITEH;GSITE_ANG;ADDRESS;STATE;ANNOPOS_1;ANNOPOS_2"
	select SIID,SINAME,ABB_INT_ID,SIFPOS,NO_KEY,SG_KEY,XSITE,YSITE,SITEW,SITEH,SSITE_ANG,GXSITE,GYSITE,GSITEW,GSITEH,GSITE_ANG,ADDRESS,STATE,ANNOPOS_1,ANNOPOS_2 from SITE into selExport noselect
	bDummy = ExportCsv("SITE", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-SITE-Tamamlandý " + completeTime

TextHeader = "LOID;LONAME;ABB_INT_ID;LOFPOS;NO_KEY;SG_KEY;BITS;LOTYPE;RATING_1;RATING_2;RATING_3;RATING_4;BILLED_1;BILLED_2;BILLED_3;BILLED_4;PFACT_1;PFACT_2;PFACT_3;PFACT_4;PHASE;STATUS;STATE;DESCRIPTIVE_LOC;ANNOPOS_1;ANNOPOS_2;SYM_POS_1;SYM_POS_2;SUB_AREA;COUNTPRIORITY;CUSTNO_1"
	select LOID,LONAME,ABB_INT_ID,LOFPOS,NO_KEY,SG_KEY,BITS,LOTYPE,RATING_1,RATING_2,RATING_3,RATING_4,BILLED_1,BILLED_2,BILLED_3,BILLED_4,PFACT_1,PFACT_2,PFACT_3,PFACT_4,PHASE,STATUS,STATE,DESCRIPTIVE_LOC,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SUB_AREA,COUNTPRIORITY,CUSTNO_1 from LOAD into selExport noselect
	bDummy = ExportCsv("LOAD", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-LOAD-Tamamlandý " + completeTime	

TextHeader = "CAID;CANAME;CAFPOS;ABB_INT_ID;NO_KEY;DT_KEY;RATING_1;RATING_2;RATING_3;RATING_4;DESCRIPTIVE_LOC;PH3PRES;BITS;STATE;STATUS;ANNO_POS_1;ANNO_POS_2;SYM_POS_1;SYM_POS_2;REGULATING;REG_MODE;REG_NODE_KEY;REG_LINE_XFRM_KEY;REG_Q_COMP_TYPE;REG_V_SENS_PHASE;REG_Q_SENS_PHASE;REG_LINE_END;V_ON_LIMIT;V_OFF_LIMIT;Q_ON_LIMIT;Q_OFF_LIMIT"
	select CAID,CANAME,CAFPOS,ABB_INT_ID,NO_KEY,DT_KEY,RATING_1,RATING_2,RATING_3,RATING_4,DESCRIPTIVE_LOC,PH3PRES,BITS,STATE,STATUS,ANNO_POS_1,ANNO_POS_2,SYM_POS_1,SYM_POS_2,REGULATING,REG_MODE,REG_NODE_KEY,REG_LINE_XFRM_KEY,REG_Q_COMP_TYPE,REG_V_SENS_PHASE,REG_Q_SENS_PHASE,REG_LINE_END,V_ON_LIMIT,V_OFF_LIMIT,Q_ON_LIMIT,Q_OFF_LIMIT from CAPACITOR into selExport noselect
	bDummy = ExportCsv("CAPACITOR", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-CAPACITOR-Tamamlandý " + completeTime	

TextHeader = "ID;IN_SYSTEM;NAME;OP_CENTER_ID;OVER_X;OVER_Y;PRINTER_ID;PRINT_CMD;REGION;REMARK1;REMARK2;REMARK3;REMARK4"
	select ID,IN_SYSTEM,NAME,OP_CENTER_ID,OVER_X,OVER_Y,PRINTER_ID,PRINT_CMD,REGION,REMARK1,REMARK2,REMARK3,REMARK4  from DISTRICT into selExport noselect
	bDummy = ExportCsv("DISTRICT", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-DISTRICT-Tamamlandý " + completeTime	

TextHeader = "ACCNO;NAME;AREA;LOC;PHONE;SSN;RANK;CLASS;RATE;KVA;KWH;DISC;ADDR1;BAL;NOTE;ADDR2;ADDR3;ADDR4;ZIP;SECT;BREAK;NODE;SAREA;CITY;POLE;SERV;STATE;CNTY;XCOOR;YCOOR;XFMER;DELPT;FEED;SUBS;DISTR;PHASE;LMS;HEAT;AIR;LO_KEY;NOTE2;PRIORITY;XFMR_ID;METER_LOC;METER_NO;BILL_ACCNO;METER_CYCLE;DIRECTIONS;NAME2;AREA2;PHONE2;METER_ROUTE;SERV_ST;CONTACT;HOUSE_NO;STREET;HOUSE_NO2;MAX_LOAD;MTRNO1;MTRNO2;MTRNO3;MTRIND1;MTRNO4;MTRNO5;MTRIND2;MTRIND3;MTRIND4;MTRIND5;MTRSIZE1;MTRSIZE2;MTRSIZE3;MTRSIZE4;MTRSIZE5;MTRTYPE1;MTRTYPE2;MTRTYPE3;MTRLOC1;MTRTYPE4;MTRTYPE5;MTRLOC2;MTRLOC3;LASTVISITINFO;MTRLOC4;MTRLOC5;FERGUSON_PAGE_NO;FERGUSON_GRID_NO;CIRCUIT;MTRGRIDX1;MTRGRIDX2;MTRGRIDX3;MTRGRIDX4;MTRGRIDX5;MTRGRIDY1;MTRGRIDY2;MTRGRIDY3;MTRGRIDY4;MTRGRIDY5;SLAB1;SLAB2;SUBDIVNAME;SUBSTATIONNO;XFMRMRSIZEIND;UGCONDUITSIZE;GIS_X_COORD;GIS_Y_COORD;MTRNO1TRANSFORMER;MTRNO2TRANSFORMER;MTRNO3TRANSFORMER;MTRNO4TRANSFORMER;ARCH_DONE;MTRNO5TRANSFORMER;SERVICE_CLASS;ARCH_DATE;AMI_STATUS_CODE;AMI_STATUS_TIMESTAMP;TIME_MOD;AMR_ENABLED;TOWN;REGION;RATE_DESC;TAX_DISTRICT;TOWN_CODE;PRIORITY_NO;CAUTION_CUSTOMER"
	select ACCNO,NAME,AREA,LOC,PHONE,SSN,RANK,CLASS,RATE,KVA,KWH,DISC,ADDR1,BAL,NOTE,ADDR2,ADDR3,ADDR4,ZIP,SECT,BREAK,NODE,SAREA,CITY,POLE,SERV,STATE,CNTY,XCOOR,YCOOR,XFMER,DELPT,FEED,SUBS,DISTR,PHASE,LMS,HEAT,AIR,LO_KEY,NOTE2,PRIORITY,XFMR_ID,METER_LOC,METER_NO,BILL_ACCNO,METER_CYCLE,DIRECTIONS,NAME2,AREA2,PHONE2,METER_ROUTE,SERV_ST,CONTACT,HOUSE_NO,STREET,HOUSE_NO2,MAX_LOAD,MTRNO1,MTRNO2,MTRNO3,MTRIND1,MTRNO4,MTRNO5,MTRIND2,MTRIND3,MTRIND4,MTRIND5,MTRSIZE1,MTRSIZE2,MTRSIZE3,MTRSIZE4,MTRSIZE5,MTRTYPE1,MTRTYPE2,MTRTYPE3,MTRLOC1,MTRTYPE4,MTRTYPE5,MTRLOC2,MTRLOC3,LASTVISITINFO,MTRLOC4,MTRLOC5,FERGUSON_PAGE_NO,FERGUSON_GRID_NO,CIRCUIT,MTRGRIDX1,MTRGRIDX2,MTRGRIDX3,MTRGRIDX4,MTRGRIDX5,MTRGRIDY1,MTRGRIDY2,MTRGRIDY3,MTRGRIDY4,MTRGRIDY5,SLAB1,SLAB2,SUBDIVNAME,SUBSTATIONNO,XFMRMRSIZEIND,UGCONDUITSIZE,GIS_X_COORD,GIS_Y_COORD,MTRNO1TRANSFORMER,MTRNO2TRANSFORMER,MTRNO3TRANSFORMER,MTRNO4TRANSFORMER,ARCH_DONE,MTRNO5TRANSFORMER,SERVICE_CLASS,ARCH_DATE,AMI_STATUS_CODE,AMI_STATUS_TIMESTAMP,TIME_MOD,AMR_ENABLED,TOWN,REGION,RATE_DESC,TAX_DISTRICT,TOWN_CODE,PRIORITY_NO,CAUTION_CUSTOMER  from ACCOUNT into selExport noselect
	bDummy = ExportCsv("ACCOUNT", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-ACCOUNT-Tamamlandý " + completeTime	

TextHeader = "SUB_ID"
	select SUB_ID from AFFECTED_SUBID where sub_id>0 group by sub_id into selExport noselect
	bDummy = ExportCsv("AFFECTED_SUBID", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-AFFECTED_SUBID-Tamamlandý " + completeTime
	
TextHeader = "ID;NAME;SITE;FIRST_NODE_ID;FIRST_LINE_ID;SUB_ID"
	select ID,NAME,SITE,FIRST_NODE_ID,FIRST_LINE_ID,SUB_ID from FEEDER into selExport noselect
	bDummy = ExportCsv("FEEDER", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-FEEDER-Tamamlandý " + completeTime
	
TextHeader = "MPFPOS;MPID;ABB_INT_ID;MPNAME;XD_1;YD_1;XD_2;YD_2;STATE;SG_KEY;ANNOPOS_1;ANNOPOS_2;LINE_ON;NO_KEY;LA_EXCLUDED;LA_MEAS_USED"
	select MPFPOS,MPID,ABB_INT_ID,MPNAME,XD_1,YD_1,XD_2,YD_2,STATE,SG_KEY,ANNOPOS_1,ANNOPOS_2,LINE_ON,NO_KEY,LA_EXCLUDED,LA_MEAS_USED from MPOINT into selExport noselect
	bDummy = ExportCsv("MPOINT", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-MPOINT-Tamamlandý " + completeTime

TextHeader = "SOID;SONAME;SOFPOS;ABB_INT_ID;NO_KEY;VLEVEL;STYPE;SCOLIND;SG_KEY;STATE;STATUS;KWGEN;MAXKVAR;MINKVAR;MAXCAP;EMERGCAP;POSSEQR;POSSEQX;ZEROSEQR;ZEROSEQX;ANNOPOS_1;ANNOPOS_2;SYM_POS_1;SYM_POS_2;SVPU_T;SVPU_A;SVPU_B;SVPU_C;NOMPHANG;NOMPHANG_A;NOMPHANG_B;NOMPHANG_C;NOMPHANG_L;NOMPHANG_L_A;NOMPHANG_L_B;NOMPHANG_L_C"
	select SOID,SONAME,SOFPOS,ABB_INT_ID,NO_KEY,VLEVEL,STYPE,SCOLIND,SG_KEY,STATE,STATUS,KWGEN,MAXKVAR,MINKVAR,MAXCAP,EMERGCAP,POSSEQR,POSSEQX,ZEROSEQR,ZEROSEQX,ANNOPOS_1,ANNOPOS_2,SYM_POS_1,SYM_POS_2,SVPU_T,SVPU_A,SVPU_B,SVPU_C,NOMPHANG,NOMPHANG_A,NOMPHANG_B,NOMPHANG_C,NOMPHANG_L,NOMPHANG_L_A,NOMPHANG_L_B,NOMPHANG_L_C from SOURCE into selExport noselect
	bDummy = ExportCsv("SOURCE", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-SOURCE-Tamamlandý " + completeTime

TextHeader = "ID;NAME"
	select ID,NAME  from REGION into selExport noselect
	bDummy = ExportCsv("REGION", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-REGION-Tamamlandý " + completeTime	

TextHeader = "ID;NAME;DISTRICT;BOTTOM;SUB_ID;MANUAL_ENTRY;AMR_FLAG"
	select ID,NAME,DISTRICT,BOTTOM,SUB_ID,MANUAL_ENTRY,AMR_FLAG  from SUBSTATION into selExport noselect
	bDummy = ExportCsv("SUBSTATION", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-SUBSTATION-Tamamlandý " + completeTime	

TextHeader = "PAFPOS;NEXTP;XDIFF;YDIFF;SUB_AREA"
	select PAFPOS,NEXTP,XDIFF,YDIFF,SUB_AREA from PATH into selExport noselect
	bDummy = ExportCsv("PATH", TextHeader)
	call GetDateTime
	print "CreateCsvFiles-PATH-Tamamlandý " + completeTime	
	
End Sub

Sub GroundLine
	
	select * from device where dname like "%GND_ISO_SW" into selGND
	fetch first from selGND
	For i = 1 To tableinfo(selGND,8)
		gndobj= selGND.obj
		'rndvar = 1000000 * Rnd(1)
		NFTime = FormatTime$(curdatetime(),"HHmmssfff")
		NFTime = round(val(NFTime) * (10 * Rnd(1)),1)
		rndvar = NFTime
		'rndvar =   Round(GetReallyRandomNumber(),1)
		gndobjT = createpoint(centroidx(gndobj) + 0.02, centroidy(gndobj))

		insert into GNDLINE(obj,fpos,id,abb_int_id,name,phase_perm,line_type,bits,sub_area,state,length,annopos_1,annopos_2,asset_id) values(createline(centroidx(gndobj), centroidy(gndobj), centroidx(gndobjT) , centroidy(gndobjT)),rndvar,rndvar + "_GND_LINE",rndvar,rndvar+"_GND_LINE",1230,27999,12288,202,1,objectlen(gndobjT,"mm"),0,0,rndvar)
				
	fetch next from selGND
	Next
	commit table GNDLINE
End Sub

Function RemoveSpecialChars(byval str as string) as String
    Dim chr, newChr, out, nicechars,strVal as String
    Dim i, l,iCharPos as Integer

    'nicechars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
    nicechars = "ABCÇDEFGHIÝJKLMNOÖPQRSÞTUÜVWXYZabcçdefgðhýijklmnoöpqrsþtuüvwxyz0123456789./ "
    
    l = Len(str)

    For i = 1 to l
       chr = Mid$(str, i, 1)  
      
       iCharPos = inStr(1, nicechars, chr)
        If iCharPos > 0 Then
        	if lcase$(chr)=" " then
        		newChr=" "
        	End If
        	if lcase$(chr)="." then
        		newChr="."
        	End If
        	if lcase$(chr)="/" then
        		newChr="/"
        	End If
        	if lcase$(chr)="a" then
        		newChr="A"
        	End If
        	if lcase$(chr)="b" then
        		newChr="B"
        	End If
        	if lcase$(chr)="c" then
        		newChr="C"
        	End If
        	if lcase$(chr)="ç" then
        		newChr="C"
        	End If
        	if lcase$(chr)="d" then
        		newChr="D"
        	End If
        	if lcase$(chr)="e" then
        		newChr="E"
        	End If
        	if lcase$(chr)="f" then
        		newChr="F"
        	End If
        	if lcase$(chr)="g" then
        		newChr="G"
        	End If
        	if lcase$(chr)="ð" then
        		newChr="G"
        	End If
        	if lcase$(chr)="h" then
        		newChr="H"
        	End If
        	if lcase$(chr)="ý" then
        		newChr="I"
        	End If
        	if lcase$(chr)="i" then
        		newChr="I"
        	End If
        	if chr="Ý" then
        		newChr="I"
        	End If
        	if lcase$(chr)="j" then
        		newChr="J"
        	End If
        	if lcase$(chr)="k" then
        		newChr="K"
        	End If
        	if lcase$(chr)="l" then
        		newChr="L"
        	End If
        	if lcase$(chr)="m" then
        		newChr="M"
        	End If
        	if lcase$(chr)="n" then
        		newChr="N"
        	End If
        	if lcase$(chr)="o" then
        		newChr="O"
        	End If
        	if lcase$(chr)="ö" then
        		newChr="O"
        	End If
        	if lcase$(chr)="p" then
        		newChr="P"
        	End If
        	if lcase$(chr)="r" then
        		newChr="R"
        	End If
        	if lcase$(chr)="s" then
        		newChr="S"
        	End If
        	if lcase$(chr)="þ" then
        		newChr="S"
        	End If
        	if lcase$(chr)="t" then
        		newChr="T"
        	End If
        	if lcase$(chr)="u" then
        		newChr="U"
        	End If
        	if lcase$(chr)="ü" then
        		newChr="U"
        	End If
        	if lcase$(chr)="v" then
        		newChr="V"
        	End If
        	if lcase$(chr)="y" then
        		newChr="Y"
        	End If
        	if lcase$(chr)="z" then
        		newChr="Z"
        	End If
        	if lcase$(chr)="1" then
        		newChr="1"
        	End If
        		if chr="2" then
        		newChr="2"
        	End If
        		if chr="3" then
        		newChr="3"
        	End If
        		if chr="4" then
        		newChr="4"
        	End If
        		if chr="5" then
        		newChr="5"
        	End If
        		if chr="6" then
        		newChr="6"
        	End If
        		if chr="7" then
        		newChr="7"
        	End If
        		if chr="8" then
        		newChr="8"
        	End If
        		if chr="9" then
        		newChr="9"
        	End If
        		if chr="0" then
        		newChr="0"
        	End If
        	else 
        	newChr="*"
        	strVal = ReplaceCharAtPosition(chr, iCharPos-1, newChr)        	
        End If
        out = out + newChr
   
    Next

    RemoveSpecialChars = out
End Function

Function ReplaceCharAtPosition(ByVal sValue As String, ByVal iPosition As Integer, ByVal sReplaceWith As String) As String

OnError Goto CatchEx

if iPosition = 0 then 
	goto Done
End If
   Dim sBegin As String

   Dim sEnd As String

   sBegin = Left$(sValue, iPosition - 1)

   sEnd = Right$(sValue, Len(sValue) - iPosition)

   ReplaceCharAtPosition = sBegin & sReplaceWith & sEnd

Done:

   Exit Function

CatchEx:

   Note Error$()

   Resume Done

End Function

sub convertChar
	print "Turkce karakterler çevriliyor " 
	 select name from account order by name into selacc 
	    Fetch first from selacc
	    For i = 0 To tableinfo(selacc,8)
	    	_rowid=selacc.rowid
	    	newEngChr = RemoveSpecialChars(lcase$(selacc.name))
	    	update selacc set name=newEngChr where rowid=_rowid
	    	Fetch Next from selacc
	    Next
print "Ingilizce karakter tanýmlamasý bitti. " 
commit table account

End Sub

Sub CloseSel
For i = 1 To mapperinfo(frontwindow(),9) 
		_tablename =  LayerInfo( frontwindow(), i, 1 )
		pos = InStr(1, _tablename, "sel")
		
	 if pos>0 then
	 	close table _tablename
	 	onerror goto hata
	 End If
hata:	Next
End Sub

'control
'select * from site where no_key not in (select nfpos from node) into thereisnonodeforsite
'browse * from thereisnonodeforsite
'
'select * from account where xfmr_id not in (select loid from load) into therisnoloadidforaccount
'browse * from therisnoloadidforaccount
'
'select * from account where distr not in (select id from district) into thereisnodistrictidforaccount
'browse * from thereisnodistrictidforaccount
'
'select * from account where feed not in (select id from feeder) into thereisnoidfeederidforaccount
'browse * from thereisnoidfeederidforaccount
'
'select * from mpoint where no_key not in (select nfpos from node) into thereisnonodeformpoint
'browse * from thereisnonodeformpoint
'
'select * from mpoint where line_on not in (select fpos from line) into therisnolineformpoint
'browse * from therisnolineformpoint
'
'select * from feeder where first_node_id not in (select nid from node) into thereisnonidforfeeder
'browse * from thereisnonidforfeeder
'
'select * from feeder where first_line_id not in (select id from line) into thereisnolineidforfeeder
'browse * from thereisnolineidforfeeder
'
'select * from source where no_key not in (select nfpos from node) into threisnonokeyforsource
'browse * from threisnonokeyforsource
'
'select * from load where no_key not in (select nfpos from node) into threisnonokeyforload
'browse * from threisnonokeyforload
'
'select * from device where li_key not in (select fpos from line) into threisnolikeyfordevice
'browse * from threisnolikeyfordevice
'
'select * from device where line_end <> 1 and line_end <> 2 into  lineendisnot1or2
'browse * from lineendisnot1or2
'
'select nextp from path where pafpos <> 0 and pafpos not in (select pafpos from path) into pathnextpnotinpafpos
'browse * from pathnextpnotinpafpos
'
'select * from line where no_key_1 not in (select nfpos from node) into nokey1notinnfpos
'browse * from nokey1notinnfpos
'
'select * from line where pa_key_1 not in (select pafpos from path) and pa_key_1 <> 0 into pakey1notinpafpos
'browse * from pakey1notinpafpos
'
'select * from node where sub_id not in (select sub_id from affected_subid) into nosubidinaffectedsubid
'browse * from nosubidinaffectedsubid

Function SearchReplace(ByVal strInput as String, ByVal strReplace as String, ByVal strReplacement as String) as String

Dim iPos as Integer
Dim strOut as String
Dim i as Integer

   iPos = InStr(1, strInput, strReplace)
   If iPos < 1 then            '// nothing to replace, return original string
       SearchReplace = strInput
       Exit Function
   End If

   While iPos > 0              '// loop until nothing left to replace
       If iPos > 1 then
           strOut = Left$(strInput, iPos - 1)
       End if
       strOut = strOut & strReplacement
       If iPos + Len(strReplace) - 1 < Len(strInput) then
           strOut = strOut & Mid$(strInput, iPos + Len(strReplace), Len(strInput) - (iPos + Len(strReplace)) + 1)
       End If

       strInput = strOut
       iPos = InStr(iPos + 1, strInput, strReplace)
   Wend

   SearchReplace = strOut

End Function

Function CheckPassword(ByVal checkPassword as String) as Logical
	
Dim storedHash as String

	'// read stored password hash from store file
	Open File PASS_STORE for Input as #2
	Input #2, storedHash
	Close File #2
	
	'// check password against stored hash and return result
	CheckPassword = ValidatePassword(checkPassword, storedHash)
	
End Function

Type POINTAPI
   x As Integer
   y As Integer
End Type

Declare Function GetCursorPos Lib "user32" (lpPoint As POINTAPI) As Integer
Dim CursorLocation As POINTAPI 
Declare Function GetCPUusage() as Integer
Declare Function GetSystemTimes Lib "kernel32.dll" (idleTime As Integer, kernelTime As Integer, userTime As Integer) As Logical 

Type GUID
   Data1 As Integer   
   Data2 As Integer
   Data3 As Integer
   Data4 As Integer
End Type
Declare Function CoCreateGuid Lib "OLE32.DLL" (pGuid As GUID) As Integer

Dim iRange as Integer
Dim iProgress as Integer
Dim sIdle, sKernel, sUser As Integer 
Dim bRandom1 as Logical
Dim bRandom2 as Logical
Dim bUseCPU as Logical

Declare Sub WaitInMilliseconds(byVal iMilliseconds as Integer)

Sub GenerateUID

   Dim strUID as String
   'strUID = GetUID(8) & "-" & GetUID(4) & "-" & GetUID(4) & "-" & GetUID(8) 'example of GUID
   strUID = GetStringUID(15) 
   Print strUID

   iProgress = iProgress + 1
   If iProgress > iRange then
      ProgressBar = -1
   Else
      ProgressBar = iProgress
   End If
End Sub
'----------------------------------------------------------------
Function GetStringUID(ByVal iStrLength as Integer) as String
OnError Goto CatchEx 

   Dim i as Integer
   Dim iRandNum as Float

   Dim strUID as String

   Do while i < iStrLength
      iRandNum = Round(GetReallyRandomNumber(),1)

      If iRandNum > 47 and iRandNum < 58 then
         strUID = strUID & Chr$(iRandNum)
         i = i + 1
      End If 
      If iRandNum > 64 and iRandNum < 91 then
         strUID = strUID & Chr$(iRandNum)
         i = i + 1
      End If 
   Loop

   GetStringUID = strUID
Done:
   Exit Function
CatchEx:
   Resume Done 
End Function
'----------------------------------------------------------------
Function GetReallyRandomNumber() as Float
OnError Goto CatchEx 

   Dim i as Integer
   Dim iResult as Integer
   Dim iCPU as Float
   Dim uID as GUID
   Dim iRandomNumber as Float

   iResult = CoCreateGuid(uID)
   iResult = GetCursorPos(CursorLocation)
   
   If CursorLocation.x = 0 then
      CursorLocation.x = 0.5
   End If 
   If Cursorlocation.y = 0 then
      Cursorlocation.y = 0.5
   End If
   If bUseCPU then 
      iCPU = GetCPUusage()
      bUseCPU = false
    Else
      iCPU = Rnd(Val(FormatTime$(CurTime(), "fff")))
      bUseCPU = true
   End If 
   If iCPU = 0 Then
      iCPU = Val(FormatTime$(CurTime(), "fff"))
   End If
   If bRandom1 then
      iRandomNumber = (Rnd(iCPU) * uID.Data1) * Val(FormatTime$(CurTime(), "fff"))/100 
      bRandom1 = false
   Else
      iRandomNumber = (CursorLocation.x / Cursorlocation.y) * iCPU * rnd(uID.Data2)
      bRandom1 = true
   End If 
   If NOT bRandom2 then
      iRandomNumber = (Rnd(iRandomNumber) * iCPU) * Val(FormatTime$(CurTime(), "fff"))/100 
      bRandom1 = true
   Else
      iRandomNumber = Rnd(iRandomNumber)* uID.Data3
      bRandom2 = false
   End If
   If iRandomNumber < 0.01 then
      iRandomNumber = iRandomNumber * 1000
   End If 
   If iRandomNumber < 1 then
      iRandomNumber = iRandomNumber * 100
   ElseIf iRandomNumber > 100 then
      iRandomNumber = iRandomNumber / 100
   ElseIf iRandomNumber > 1000 then
      iRandomNumber = iRandomNumber / 1000
   End If
   If iRandomNumber < 1 then
      iRandomNumber = iRandomNumber * 100
   End If
   If iRandomNumber = 0 then 
      Dim bResult as Logical
      bResult = GetSystemTimes (sIdle, sKernel, sUser)
      iRandomNumber = Rnd(Val(FormatTime$(CurTime(), "fff"))) * 100 * uID.Data4
   End If
   
   GetReallyRandomNumber = iRandomNumber

Done:
   Exit Function
CatchEx:
   GetReallyRandomNumber = 1
   Resume Done 
End Function
'----------------------------------------------------------------
Function GetCPUusage() as Integer OnError Goto CatchEx

   Dim eIdle, eKernel, eUser As Integer 
   Dim cIdle, cKernel, cUser As Integer 
   Dim systemTime As Integer
   Dim totalCpuUsage As Integer

   Dim bResult as Logical
   bResult = GetSystemTimes(eIdle, eKernel, eUser) 
   
   cIdle = (eIdle - sIdle) 
   cKernel = (eKernel - sKernel) 
   cUser = (eUser - sUser) 
   
   systemTime = (cKernel + cUser) 
   
   totalCpuUsage = (systemTime - cIdle) * (100) / (systemTime)
   
   GetCPUusage = totalCpuUsage

Done:
   Exit Function
CatchEx:
   Resume Done
End Function
'----------------------------------------------------------------
Sub WaitInMilliseconds(byVal iMilliseconds as Integer)
OnError Goto CatchEx
   Dim iEndTime as Integer
   iEndTime = Val(FormatTime$(CurTime(), "hhmmssfff")) + iMilliseconds

   Do while Val(FormatTime$(CurTime(), "hhmmssfff")) < iEndTime
      'Nothing
   Loop
Done:
   Exit Sub
CatchEx:
   Resume Done
End Sub

'group_id için switch dosyasyý oluþturulmalýdýr.baglantý noktalarý da switch gibi davranmalýdýr
'group_id verildikten sonra ana tabloda update iþlemi yapabilmek için - parçalanan hatlara unique id verilmelidir
'cunku hatlar parcalandýktan sonra abb_int_id ler unique likten çýkmaktadýr.
'abb_int_id olarak group_id verilmiþtir.


Function KolonMevcutMu(Byval tablename_ as string,Byval colname_ as string ) as logical

dim i as integer 
dim result as logical
for i=1 to TableInfo(tablename_,4)
if (colname_=ColumnInfo(tablename_,"COL"+i,1)) then
result=1
exit for
End If
Next
KolonMevcutMu=result


End Function